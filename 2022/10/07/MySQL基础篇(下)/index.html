<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MySQL基础篇(下) | Dreamer Blog</title><meta name="keywords" content="导航,分享"><meta name="author" content="Dreamer Blog"><meta name="copyright" content="Dreamer Blog"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQL 约束约束(constraint)概述为什么需要约束 – 为了保证数据的完整性​    数据完整性（Data Integrity）是指数据的精确性（Accuracy）和可靠性（Reliability）。它是防止数据库中 存在不符合语义规定的数据和防止因错误信息的输入输出造成无效操作或错误信息而提出的。 ​    为了保证数据的完整性，SQL 规范以约束的方式对 表数据进行额外的条件限制">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL基础篇(下)">
<meta property="og:url" content="http://dreamerlearner.github.io/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/index.html">
<meta property="og:site_name" content="Dreamer Blog">
<meta property="og:description" content="MySQL 约束约束(constraint)概述为什么需要约束 – 为了保证数据的完整性​    数据完整性（Data Integrity）是指数据的精确性（Accuracy）和可靠性（Reliability）。它是防止数据库中 存在不符合语义规定的数据和防止因错误信息的输入输出造成无效操作或错误信息而提出的。 ​    为了保证数据的完整性，SQL 规范以约束的方式对 表数据进行额外的条件限制">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://dreamerlearner.github.io/img/responsive-web-site-screenshot.jpg">
<meta property="article:published_time" content="2022-10-07T04:41:28.000Z">
<meta property="article:modified_time" content="2022-10-07T04:45:41.217Z">
<meta property="article:author" content="Dreamer Blog">
<meta property="article:tag" content="导航">
<meta property="article:tag" content="分享">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://dreamerlearner.github.io/img/responsive-web-site-screenshot.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://dreamerlearner.github.io/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL基础篇(下)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-07 12:45:41'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><div class="aplayer no-destroy" data-id="60198" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/responsive-web-site-screenshot.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Dreamer Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 目录</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL基础篇(下)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-10-07T04:41:28.000Z" title="Created 2022-10-07 12:41:28">2022-10-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-10-07T04:45:41.217Z" title="Updated 2022-10-07 12:45:41">2022-10-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL%E5%AD%A6%E4%B9%A0/">MySQL学习</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL%E5%AD%A6%E4%B9%A0/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87/">MySQL基础篇</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL基础篇(下)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MySQL-约束"><a href="#MySQL-约束" class="headerlink" title="MySQL 约束"></a>MySQL 约束</h1><h2 id="约束-constraint-概述"><a href="#约束-constraint-概述" class="headerlink" title="约束(constraint)概述"></a><strong>约束(constraint)概述</strong></h2><h3 id="为什么需要约束-–-为了保证数据的完整性"><a href="#为什么需要约束-–-为了保证数据的完整性" class="headerlink" title="为什么需要约束 – 为了保证数据的完整性"></a><strong>为什么需要约束 –</strong> <strong>为了保证数据的完整性</strong></h3><p>​    <strong>数据完整性</strong>（Data Integrity）是指数据的精确性（Accuracy）和可靠性（Reliability）。它是防止数据库中 存在不符合语义规定的数据和防止因错误信息的输入输出造成无效操作或错误信息而提出的。</p>
<p>​    为了保证数据的完整性，SQL 规范以约束的方式对 <strong>表数据进行额外的条件限制</strong> 。从以下四个方面考虑：</p>
<p>​    实体完整性（Entity Integrity ） ：例如，同一个表中，不能存在两条完全相同无法区分的记录</p>
<p>​    域完整性（Domain Integrity ） ：例如：年龄范围 0-120 ，性别范围 “ 男 &#x2F; 女 ”</p>
<p>​    引用完整性（Referential Integrity ） ：例如：员工所在部门，在部门表中要能找到这个部门</p>
<p>​    用户自定义完整性（User - defined Integrity ） ：例如：用户名唯一、密码不能为空等，本部门经理的工资不得高于本部门职工的平均工资的5 倍。</p>
<h3 id="什么是约束-–-对表中字段的限制"><a href="#什么是约束-–-对表中字段的限制" class="headerlink" title="什么是约束 – 对表中字段的限制"></a>什么是约束 – 对表中字段的限制</h3><p>​    约束是表级的强制规定。</p>
<p>​    可以在 <strong>创建表时规定约束（通过</strong> <strong>CREATE TABLE</strong> <strong>语句）</strong> ，或者在 <strong>表创建之后通过</strong> <strong>ALTER TABLE</strong> <strong>语句规定</strong></p>
<p><strong>约束</strong> 。</p>
<p>​    </p>
<h3 id="约束的分类"><a href="#约束的分类" class="headerlink" title="约束的分类"></a><strong>约束的分类</strong></h3><p><strong>根据约束数据列的限制，</strong> 约束可分为：</p>
<p>​    <strong>单列约束</strong> ：每个约束只约束一列</p>
<p>​    <strong>多列约束</strong> ：每个约束可约束多列数据</p>
<p><strong>根据约束的作用范围</strong> ，约束可分为：</p>
<p>​    <strong>列级约束</strong> ：只能作用在一个列上，跟在列的定义后面</p>
<p>​    <strong>表级约束</strong> ：可以作用在多个列上，不与列一起，而是单独定义</p>
<table>
<thead>
<tr>
<th></th>
<th><em><strong>*位置*</strong></em></th>
<th><em><strong>*支持的约束类型*</strong></em></th>
<th><em><strong>*是否可以起约束名*</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em><strong>*列级约束：*</strong></em></td>
<td>列的后面</td>
<td>语法都支持，但外键没有效果</td>
<td>不可以</td>
</tr>
<tr>
<td><em><strong>*表级约束：*</strong></em></td>
<td>所有列的下面</td>
<td>默认和非空不支持，其他支持</td>
<td>可以（主键没有效果）</td>
</tr>
</tbody></table>
<p><strong>根据约束起的作用</strong> ，约束可分为：</p>
<p>​    <strong>1. NOT NULL 非空约束，规定某个字段不能为空</strong></p>
<p>​    <strong>2. UNIQUE 唯一约束</strong>，<strong>规定某个字段在整个表中是唯一的</strong></p>
<p>​    <strong>3. PRIMARY KEY 主键(非空且唯一)约束</strong></p>
<p>​    <strong>4. FOREIGN KEY 外键约束</strong></p>
<p>​    <strong>5. CHECK 检查约束</strong></p>
<p>​    <strong>6. DEFAULT 默认值约束</strong></p>
<p><em>*<em>*注意： MySQL不支持*</em>*<em>check*</em>*<em>约束，但可以使用*</em>*<em>check*</em>*<em>约束，而没有任何效果*</em>*</em></p>
<p>查看某个表已有的约束 ：</p>
<p>​    # information_schema数据库名（系统库）</p>
<p>​    # table_constraints表名称（专门存储各个表的约束）</p>
<p>​    <em>*<em>*SELECT*</em> ***</em>* *<em>FROM*</em> *<em>information_schema*</em>*<em>.table_constraints*</em>**</p>
<p>​    <em>*<em>*WHERE table_name*</em> **&#x3D;*</em> *<em>‘*</em>*<em>表名称*</em>*<em>‘*</em>*<em>;*</em>**</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/2022100712384373.png" alt="img"></p>
<h2 id="非空约束（NOT-NULL）"><a href="#非空约束（NOT-NULL）" class="headerlink" title="非空约束（NOT NULL）"></a><strong>非空约束（NOT NULL）</strong></h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a><strong>作用</strong></h3><p>​    <strong>限定某个字段&#x2F;</strong> <em><strong>*某列的值不允许为空*</strong></em></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/2022100712384385.png" alt="img"></p>
<h3 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a><strong>关键字</strong></h3><p>​    <strong>NOT NULL</strong></p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a><strong>特点</strong></h3><p>​    <em>*<em>*1. 默认，所有的类型的值都可以是NULL*</em>*<em>，包括*</em>*<em>INT*</em>*<em>、*</em>*<em>FLOAT*</em>*<em>等数据类型*</em>*</em></p>
<p>​    <em><strong>*2. 非空约束只能出现在表对象的列上，只能某个列单独限定非空，不能组合非空*</strong></em></p>
<p>​        <em><strong>*（只有列级约束，没有表级约束）*</strong></em></p>
<p>​    <em><strong>*3. 一个表可以有很多列都分别限定了非空*</strong></em></p>
<p>​    <em>*<em>*4. 空字符串’’*</em>*<em>不等于*</em>*<em>NULL*</em>*<em>，*</em>*<em>0*</em>*<em>也不等于*</em>*<em>NULL*</em>*</em></p>
<h3 id="添加非空约束"><a href="#添加非空约束" class="headerlink" title="添加非空约束"></a><strong>添加非空约束</strong></h3><h4 id="在CREATE-TABLE-时添加非空约束"><a href="#在CREATE-TABLE-时添加非空约束" class="headerlink" title="在CREATE TABLE 时添加非空约束"></a>在CREATE TABLE 时添加非空约束</h4><p><strong>语法格式：</strong></p>
<p>​    <strong>CREATE TABLE</strong> <em><strong>*表名称(*</strong></em></p>
<p>​        <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​        <em><strong>*字段名 数据类型** **NOT NULL,*</strong></em></p>
<p>​        <em><strong>*字段名 数据类型** **NOT NULL*</strong></em></p>
<p>​    <em><strong>*);*</strong></em></p>
<p><em><strong>*举例：*</strong></em></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123843123.png" alt="img"></p>
<p> <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123844125.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123844127.png" alt="img"></p>
<h4 id="在ALTER-TABLE-时添加非空约束"><a href="#在ALTER-TABLE-时添加非空约束" class="headerlink" title="在ALTER TABLE 时添加非空约束"></a>在ALTER TABLE 时添加非空约束</h4><p> <strong>语法格式：</strong></p>
<p>​    <em>*<em>*alter table*</em> *<em>表名称*</em> *<em>modify*</em> *<em>字段名 数据类型*</em> *<em>not*</em> *<em>null*</em>**;*</em>**</p>
<p>​    </p>
<p><em><strong>*举例：*</strong></em></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123844141.png" alt="img"></p>
<h3 id="删除非空约束"><a href="#删除非空约束" class="headerlink" title="删除非空约束"></a><strong>删除非空约束</strong></h3><p><strong>语法格式：</strong>   </p>
<p>​    <strong>1.alter table</strong> <em>*<em>*表名称*</em> *<em>modify*</em> *<em>字段名 数据类型*</em> *<em>NULL*</em>**;*</em> *<em>#*</em>*<em>去掉*</em>*<em>not null*</em>*<em>，相当于修改某个非注解字段，该字段允 许为空*</em>**</p>
<p>​    <em>*<em>*2.alter table*</em> *<em>表名称*</em> *<em>modify*</em> *<em>字段名 数据类型*</em>**;*</em> *<em>#*</em>*<em>去掉*</em>*<em>not null*</em>*<em>，相当于修改某个非注解字段，该字段允许为空*</em>**</p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123844155.png" alt="img"></p>
<h2 id="唯一性约束-UNIQUE-或-UNIQUE-KEY"><a href="#唯一性约束-UNIQUE-或-UNIQUE-KEY" class="headerlink" title="唯一性约束(UNIQUE 或 UNIQUE KEY)"></a><strong>唯一性约束(UNIQUE 或 UNIQUE KEY)</strong></h2><h3 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a><strong>作用</strong></h3><p>​    <strong>用来限制某个字段&#x2F;</strong> <em><strong>*某列的值不能重复。*</strong></em></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123845165.png" alt="img"></p>
<h3 id="关键字-1"><a href="#关键字-1" class="headerlink" title="关键字"></a>关键字</h3><p>​    <em><strong>*UNIQUE*</strong></em></p>
<h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a><strong>特点</strong></h3><p>​    <strong>1.同一个表可以有多个唯一约束。</strong></p>
<p>​    <em><strong>*2.唯一约束可以是某一个列的值唯一，也可以多个列组合的值唯一。*</strong></em></p>
<p>​    <em><strong>*3.唯一性约束允许列值为空。并且允许存在多个NULL值。*</strong></em></p>
<p>​    <em><strong>*4.在创建唯一约束的时候，如果不给唯一约束命名，就默认和列名相同。*</strong></em></p>
<p>​    <em><strong>*5.MySQL会给唯一约束的列上默认创建一个唯一索引。*</strong></em></p>
<h3 id="添加唯一约束"><a href="#添加唯一约束" class="headerlink" title="添加唯一约束"></a><strong>添加唯一约束</strong></h3><h4 id="在CREATE-TABLE-时添加唯一约束"><a href="#在CREATE-TABLE-时添加唯一约束" class="headerlink" title="在CREATE TABLE 时添加唯一约束"></a>在CREATE TABLE 时添加唯一约束</h4><p><strong>语法格式：</strong></p>
<p>​    <strong>1.列级约束</strong></p>
<p>​    <strong>create table</strong> <em>*<em>*表名称*</em>**(*</em>**</p>
<p>​    <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​    <em>*<em>*字段名 数据类型*</em> *<em>unique*</em>**,*</em>**</p>
<p>​    <em>*<em>*字段名 数据类型*</em> *<em>unique key*</em>**,*</em>**</p>
<p>​    <em><strong>*字段名 数据类型*</strong></em></p>
<p>​    <em><strong>*);*</strong></em></p>
<p>​    <em><strong>*2.表级约束*</strong></em></p>
<p>​    <strong>create table</strong> <em>*<em>*表名称*</em>**(*</em>**</p>
<p>​    <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​    <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​    <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​    <em>*<em>*[*</em>*<em>constraint*</em> *<em>约束名*</em>**]*</em> *<em>unique key*</em>*<em>(*</em>*<em>字段名*</em>*<em>)*</em>**</p>
<p>​    <em><strong>*);*</strong></em></p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123845221.png" alt="img"></p>
<p> <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123845223.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123845225.png" alt="img"></p>
<h4 id="在ALTER-TABLE-时添加唯一约束"><a href="#在ALTER-TABLE-时添加唯一约束" class="headerlink" title="在ALTER TABLE 时添加唯一约束"></a>在ALTER TABLE 时添加唯一约束</h4><p><strong>语法格式：</strong></p>
<p>​    <strong>1. *<em>alter table*</em> *<em>表名称*</em></strong></p>
<p>​      <em>*<em>*add*</em> **[*</em>*<em>constraint*</em> *<em>约束名*</em>*<em>]*</em> *<em>unique key*</em>*<em>(*</em>*<em>字段列表*</em>*<em>);*</em>**</p>
<p>​    <em><strong>*2.** *<em>alter table*</em> **表名称*</strong></em></p>
<p>​      <em>*<em>*modify*</em> *<em>字段名 字段类型*</em> *<em>unique*</em>**;*</em>**</p>
<p>注：字段列表中如果是一个字段，表示该列的值唯一。如果是两个或更多个字段，那么复合唯一，即多个字段的组合是唯一的</p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123846245.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123846247.png" alt="img"></p>
<h4 id="添加复合唯一性约束"><a href="#添加复合唯一性约束" class="headerlink" title="添加复合唯一性约束"></a>添加复合唯一性约束</h4><p><em><strong>*语法格式：*</strong></em></p>
<p>​    <em><strong>*1.在 create table 时添加复合唯一约束*</strong></em></p>
<p>​        <em>*<em>*create table*</em> *<em>表名称*</em>**(*</em>**</p>
<p>​        <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​        <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​        <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​         <em>*<em>*[*</em>*<em>constraint*</em> *<em>约束名*</em>**]*</em> *<em>unique key*</em>*<em>(*</em>*<em>字段列表*</em>*<em>)*</em>**</p>
<p>​        <em><strong>*);*</strong></em></p>
<p>​    <em><strong>*2. 在 alter table 时添加复合唯一约束*</strong></em></p>
<p>​        <em><strong>*alter table** **表名称*</strong></em></p>
<p>​        <em>*<em>*add*</em> **[*</em>*<em>constraint*</em> *<em>约束名*</em>*<em>]*</em> *<em>unique key*</em>*<em>(*</em>*<em>字段列表*</em>*<em>);*</em>**</p>
<p>​    <strong>字段列表中写的是多个字段名，多个字段名用逗号分隔，表示那么是复合唯一，即多</strong></p>
<p><em><strong>*个字段的组合是唯一的*</strong></em></p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123846281.png" alt="img"></p>
<p> <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123847283.png" alt="img"></p>
<p> <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123847285.png" alt="img"></p>
<p><strong>删除唯一约束</strong></p>
<p>​    <strong>1.添加唯一性约束的列上也会自动创建唯一索引。</strong></p>
<p>​    <em><strong>*2.删除唯一约束只能通过删除唯一索引的方式删除。*</strong></em></p>
<p>​    <em><strong>*3.删除时需要指定唯一索引名，唯一索引名就和唯一约束名一样。*</strong></em></p>
<p>​    <em><strong>*4.如果创建唯一约束时未指定名称，如果是单列，就默认和列名相同；*</strong></em></p>
<p>​      <em><strong>*如果是组合列，那么默认和() 中排在第一个的列名相同。*</strong></em></p>
<p>​      <em><strong>*也可以是自定义唯一性约束名。*</strong></em></p>
<p><strong>语法格式：</strong></p>
<p>​    <strong>ALTER TABLE USER</strong></p>
<p>​    <em>*<em>*DROP INDEX*</em> *<em>约束名*</em>**;*</em>**</p>
<p><strong>查看表从索引：</strong></p>
<p>​    <strong>show index from 表名称</strong> <em><strong>*;*</strong></em></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123847315.png" alt="img"></p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123848321.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123848323.png" alt="img"></p>
<h2 id="PRIMARY-KEY-约束（主键约束）"><a href="#PRIMARY-KEY-约束（主键约束）" class="headerlink" title="PRIMARY KEY 约束（主键约束）"></a><strong>PRIMARY KEY 约束（主键约束）</strong></h2><h3 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a><strong>作用</strong></h3><p>​    <strong>用来唯一标识表中的一行记录。</strong></p>
<h3 id="关键字-2"><a href="#关键字-2" class="headerlink" title="关键字"></a><strong>关键字</strong></h3><p>​    <strong>primary key</strong></p>
<h3 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a><strong>特点</strong></h3><p>​    <em>*<em>*主键约束相当于*</em>*<em>唯一约束*</em>**+*</em>*<em>非空约束的组合*</em>*<em>，主键约束列不允许重复，也不允许出现空值。*</em>**</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123849341.png" alt="img"></p>
<p>​    \1. 一个表最多只能有一个主键约束，建立主键约束可以在列级别创建，也可以在表级别上创建。</p>
<p>​    \2. 主键约束对应着表中的一列或者多列（复合主键）</p>
<p>​    \3. 如果是多列组合的复合主键约束，那么这些列都不允许为空值，并且组合的值不允许重复。</p>
<p>​    <strong>4. MySQL的主键名总是</strong> <strong>PRIMARY</strong> ，就算自己命名了主键约束名也没用。</p>
<p>​    \5. 当创建主键约束时，系统默认会在所在的列或列组合上建立对应的 <strong>主键索引</strong> （能够根据主键查询的，就根据主键查询，效率更高）。如果删除主键约束了，主键约束对应的索引就自动删除了。</p>
<p>​    \6. 需要注意的一点是，不要修改主键字段的值。因为主键是数据记录的唯一标识，如果修改了主键的值，就有可能会破坏数据的完整性</p>
<h3 id="添加主键约束"><a href="#添加主键约束" class="headerlink" title="添加主键约束"></a><strong>添加主键约束</strong></h3><h4 id="在CREATE-TABLE-时添加主键约束"><a href="#在CREATE-TABLE-时添加主键约束" class="headerlink" title="在CREATE TABLE 时添加主键约束"></a>在CREATE TABLE 时添加主键约束</h4><p><strong>语法格式：</strong></p>
<p>​    <strong>1.列级模式</strong></p>
<p>​        <em>*<em>*create table*</em> *<em>表名称*</em>**(*</em>**</p>
<p>​        <em>*<em>*字段名 数据类型*</em> *<em>primary key*</em>**,*</em> *<em>#*</em>*<em>列级模式*</em>**</p>
<p>​        <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​        <em><strong>*字段名 数据类型*</strong></em></p>
<p>​        <em><strong>*);*</strong></em></p>
<p>​    <em><strong>*2.表级模式（注：*</strong></em> <strong>MySQL的主键名总是</strong> <strong>PRIMARY</strong> ，就算自定义了主键约束名也没用 <em><strong>*）*</strong></em></p>
<p>​        <em>*<em>*create table*</em> *<em>表名称*</em>**(*</em>**</p>
<p>​        <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​        <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​        <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​        <em>*<em>*[*</em>*<em>constraint*</em> *<em>约束名*</em>**]*</em> *<em>primary key*</em>*<em>(*</em>*<em>字段名*</em>*<em>)*</em> *<em>#*</em>*<em>表级模式*</em>**</p>
<p>​        <em><strong>*);*</strong></em></p>
<p><em><strong>*举例：*</strong></em></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123849391.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123850393.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123850395.png" alt="img"></p>
<h4 id="在CREATE-TABLE-时添加复合主键约束"><a href="#在CREATE-TABLE-时添加复合主键约束" class="headerlink" title="在CREATE TABLE 时添加复合主键约束"></a>在CREATE TABLE 时添加复合主键约束</h4><p>​    <em><strong>*多列组合的复合主键约束，那么这些列都不允许为空值，并且组合的值不允许重复。*</strong></em></p>
<p><strong>语法格式：</strong></p>
<p>​    <strong>create table</strong> <em>*<em>*表名称*</em>**(*</em>**</p>
<p>​    <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​    <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​    <em><strong>*字段名 数据类型,*</strong></em></p>
<p>​    <em>*<em>*primary key*</em>**(*</em>*<em>字段名*</em>*<em>1,*</em>*<em>字段名*</em>*<em>2)*</em>**</p>
<p>​    <em><strong>*);*</strong></em></p>
<p><em>*<em>*字段*</em>*<em>1*</em>*<em>和字段*</em>*<em>2*</em>*<em>的组合是唯一的，也可以有更多个字段*</em>*</em></p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123850419.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123851421.png" alt="img"></p>
<h4 id="在-ALTER-TABLE-时添加（复合）主键约束"><a href="#在-ALTER-TABLE-时添加（复合）主键约束" class="headerlink" title="在 ALTER TABLE 时添加（复合）主键约束"></a>在 ALTER TABLE 时添加（复合）主键约束</h4><p>​    <strong>字段列表可以是一个字段，也可以是多个字段，如果是多个字段的话，是复合主键</strong></p>
<p><strong>语法格式：</strong></p>
<p>​    <em><strong>*1. ALTER TABLE** *<em>表名称*</em> *<em>MODIFY*</em> *<em>字段名 数据类型*</em> **PRIMARY KEY;*</strong></em></p>
<p>​    <em>*<em>*2. ALTER TABLE*</em> *<em>表名称*</em> *<em>ADD PRIMARY KEY*</em>**(*</em>*<em>字段列表*</em>*<em>);*</em>** </p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123851439.png" alt="img"></p>
<h3 id="删除主键约束"><a href="#删除主键约束" class="headerlink" title="删除主键约束"></a><strong>删除主键约束</strong></h3><p>​    <strong>删除主键约束，不需要指定主键名，因为一个表只有一个主键，</strong> <strong>删除主键约束后，非空还存在。</strong> <strong>（但在实际开发中，不会去删除表中的主键约束）</strong></p>
<p><strong>语法格式：</strong></p>
<p>​     <em><strong>*alter table** **表名称*</strong></em></p>
<p>​    <em>*<em>*drop primary key*</em>**;*</em>**</p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123851455.png" alt="img"></p>
<h2 id="自增列：AUTO-INCREMENT"><a href="#自增列：AUTO-INCREMENT" class="headerlink" title="自增列：AUTO_INCREMENT"></a><strong>自增列：AUTO_INCREMENT</strong></h2><h3 id="作用-3"><a href="#作用-3" class="headerlink" title="作用"></a><strong>作用</strong></h3><p>​    <em><strong>*某个字段的值自增*</strong></em></p>
<h3 id="关键字-3"><a href="#关键字-3" class="headerlink" title="关键字"></a><strong>关键字</strong></h3><p>​    <em><strong>*auto_increment*</strong></em></p>
<h3 id="特点和要求"><a href="#特点和要求" class="headerlink" title="特点和要求"></a><strong>特点和要求</strong></h3><p>​    <strong>1. *<em>一个表最多只能有一个自增长列*</em></strong></p>
<p>​    <em><strong>*2. 当需要产生唯一标识符或顺序值时，可设置自增长*</strong></em></p>
<p>​    <em><strong>*3. 自增长列约束的列必须是键列（主键列，唯一键列）*</strong></em></p>
<p>​    <em><strong>*4. 自增约束的列的数据类型必须是整数类型*</strong></em></p>
<p>​    <em>*<em>*5. 如果自增列指定了*</em> *<em>0*</em> *<em>和*</em> *<em>null*</em>*<em>，会在当前最大值的基础上自增；如果自增列手动指定了具体值，直接 赋值为具体值*</em>*</em></p>
<h3 id="添加自增约束"><a href="#添加自增约束" class="headerlink" title="添加自增约束"></a><strong>添加自增约束</strong></h3><h4 id="在CREATE-TABLE-时添加自增约束"><a href="#在CREATE-TABLE-时添加自增约束" class="headerlink" title="在CREATE TABLE 时添加自增约束"></a>在CREATE TABLE 时添加自增约束</h4><p><strong>语法格式：</strong></p>
<p>​        <strong>create table</strong> <em>*<em>*表名称*</em>**(*</em>**</p>
<p>​        <em>*<em>*字段名 数据类型*</em> *<em>primary key auto_increment*</em>**,*</em>**</p>
<p>​        <em><strong>*字段名 数据类型 ,*</strong></em></p>
<p>​        <em><strong>*字段名 数据类型 ,*</strong></em></p>
<p>​        <em><strong>*字段名 数据类型*</strong></em> </p>
<p>​        <em><strong>*);*</strong></em></p>
<p>​        <em>*<em>*create table*</em> *<em>表名称*</em>**(*</em>**</p>
<p>​        <em><strong>*字段名 数据类型 ,*</strong></em></p>
<p>​        <em>*<em>*字段名 数据类型*</em> *<em>unique key auto_increment*</em>**,*</em>**</p>
<p>​        <em><strong>*字段名 数据类型*</strong></em> </p>
<p>​        <em><strong>*);*</strong></em></p>
<p><strong>举例：</strong></p>
<p>非法创建：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123852513.png" alt="img"></p>
<p> 正确创建方式：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123852517.png" alt="img"></p>
<p>插入数据: </p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123853521.png" alt="img"></p>
<p> 特殊情况(不推荐此写法)：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123853525.png" alt="img"></p>
<h4 id="在-ALTER-TABLE-时添加自增约束"><a href="#在-ALTER-TABLE-时添加自增约束" class="headerlink" title="在 ALTER TABLE 时添加自增约束"></a>在 ALTER TABLE 时添加自增约束</h4><p><strong>语法格式：</strong></p>
<p>​    <strong>alter table</strong> <em><strong>*表名称*</strong></em></p>
<p>​    <em>*<em>*modify*</em> *<em>字段名 数据类型*</em> *<em>auto_increment*</em>**;*</em>**</p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123853539.png" alt="img"></p>
<h3 id="删除自增约束"><a href="#删除自增约束" class="headerlink" title="删除自增约束"></a><strong>删除自增约束</strong></h3><p><strong>语法格式：</strong></p>
<p>​    <em>*<em>*alter table*</em> *<em>表名称*</em> *<em>modify*</em> *<em>字段名 数据类型*</em>**;*</em>**</p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123853551.png" alt="img"></p>
<h3 id="MySQL-8-0新特性—自增变量的持久化"><a href="#MySQL-8-0新特性—自增变量的持久化" class="headerlink" title="MySQL 8.0新特性—自增变量的持久化"></a><strong>MySQL 8.0新特性—自增变量的持久化</strong></h3><p>​    在MySQL 8.0 之前，自增主键 AUTO_INCREMENT 的值如果大于 max(primary key)+1 ，在 MySQL 重启后，会重 置AUTO_INCREMENT&#x3D;max(primary key)+1 ，这种现象在某些情况下会导致业务主键冲突或者其他难以发 现的问题。 下面通过案例来对比不同的版本中自增变量是否持久化。</p>
<p><strong>案例：</strong></p>
<p>​    <strong>对于MySQL5.7版本：</strong> </p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123854561.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123854563.png" alt="img"></p>
<p> 然后重启MySQL57服务器：（以管理员的身份运行）</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123854567.png" alt="img"></p>
<p> <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123854569.png" alt="img"></p>
<p>​    从结果可以看出，新插入的0 值分配的是 4 ，按照重启前的操作逻辑，此处应该分配 6 。出现上述结果的主要原因是自增主键没有持久化。</p>
<p>​     在MySQL 5.7系统中，对于自增主键的分配规则，是由 InnoDB 数据字典内部一个 计数器 来决定的，而该计数器只在 内存中维护 ，并不会持久化到磁盘中。当数据库重启时，该<strong>计数器会被初始化。</strong></p>
<p>​     <strong>对于MySQL8.0版本：</strong> </p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123854579.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123855581.png" alt="img"></p>
<p> 然后重启MySQL80服务器：（以管理员的身份运行）</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123855585.png" alt="img"></p>
<p> <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123855587.png" alt="img"></p>
<p>​    从结果可以看出，自增变量已经持久化了。</p>
<p>​    MySQL 8.0将自增主键的计数器持久化到 重做日志 中。每次计数器发生改变，都会将其写入重做日志中。如果数据库重启，InnoDB 会根据重做日志中的信息来初始化计数器的内存值。</p>
<h2 id="FOREIGN-KEY-约束"><a href="#FOREIGN-KEY-约束" class="headerlink" title="FOREIGN KEY 约束"></a><strong>FOREIGN KEY 约束</strong></h2><h3 id="作用-4"><a href="#作用-4" class="headerlink" title="作用"></a><strong>作用</strong></h3><p>​    <strong>限定某个表的某个字段的引用完整性。</strong></p>
<p>​    比如：员工表的员工所在部门的选择，必须在部门表能找到对应的部分。</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123856603.png" alt="img"></p>
<h3 id="关键字-4"><a href="#关键字-4" class="headerlink" title="关键字"></a><strong>关键字</strong></h3><p>​    <strong>FOREIGN KEY</strong></p>
<h3 id="主表和从表-x2F-父表和子表"><a href="#主表和从表-x2F-父表和子表" class="headerlink" title="主表和从表&#x2F;父表和子表"></a><strong>主表和从表&#x2F;父表和子表</strong></h3><p>​    <strong>主表（父表）：被引用的表，被参考的表</strong></p>
<p>​    <em><strong>*从表（子表）：引用别人的表，参考别人的表*</strong></em></p>
<p>​    例如：员工表的员工所在部门这个字段的值要参考部门表：部门表是主表，员工表是从表。</p>
<p>​    例如：学生表、课程表、选课表：选课表的学生和课程要分别参考学生表和课程表，学生表和课程表是主表，选课表是从表。</p>
<h3 id="特点-3"><a href="#特点-3" class="headerlink" title="特点"></a><strong>特点</strong></h3><p>​    <strong>1. 从表的外键列，</strong> <strong>必须引用&#x2F;参考主表的主键或唯一约束的列</strong></p>
<p>​      <em><strong>*因为被依赖&#x2F;被参考的值必须是唯一的*</strong></em></p>
<p>​    <em>*<em>*2. 在创建外键约束时，如果不给外键约束命名，*</em>*<em>默认名不是列名，而是自动产生一个外键名*</em>*<em>（例如 student_ibfk_1;），也可以指定外键约束名。*</em>*</em></p>
<p>​    <em><strong>*3.** **创建(CREATE)表时就指定外键约束的话，先创建主表，再创建从表*</strong></em></p>
<p>​    <em><strong>*4.** **删表时，先删从表（或先删除外键约束），再删除主表*</strong></em></p>
<p>​    <em><strong>*5.** **当主表的记录被从表参照时，主表的记录将不允许删除，如果要删除数据，需要先删除从表中依赖 该记录的数据，然后才可以删除主表的数据*</strong></em></p>
<p>​    <em>*<em>*6. 在“从表*</em>*<em>”*</em>*<em>中指定外键约束，并且*</em>*<em>一个表可以建立多个外键约束*</em>*</em></p>
<p>​    <em>*<em>*7. 从表的外键列与主表被参照的列名字可以不相同，但是*</em>*<em>数据类型*</em>*<em>必须一样，逻辑意义一致。如果类型不一样，创建子表时，就会出现错误。*</em>*</em></p>
<p>​    <strong>8.</strong> <em>*<em>*当创建外键约束时，系统默认会在所在的列上建立对应的普通索引*</em>*<em>。但是索引名是外键的约束名。（根据外键查询效率很高）*</em>*</em></p>
<p>​    <em><strong>*9.** *<em>删除外键约束后，必须*</em> *<em>手动*</em> **删除对应的索引*</strong></em></p>
<h3 id="添加外键约束"><a href="#添加外键约束" class="headerlink" title="添加外键约束"></a>添加外键约束</h3><h4 id="在-create-table-时添加外键约束"><a href="#在-create-table-时添加外键约束" class="headerlink" title="在 create table 时添加外键约束"></a>在 create table 时添加外键约束</h4><p><strong>语法格式：</strong></p>
<p>​     <strong>create table</strong> <em><strong>*主表名称(*</strong></em></p>
<p>​    <em>*<em>*字段1 数据类型*</em> *<em>primary key*</em>**,*</em>**</p>
<p>​    <em><strong>*字段2 数据类型*</strong></em></p>
<p>​    <em><strong>*);*</strong></em></p>
<p>​    <em><strong>*create table** **从表名称(*</strong></em></p>
<p>​    <em>*<em>*字段1 数据类型*</em> *<em>primary key*</em>**,*</em>**</p>
<p>​    <em><strong>*字段2 数据类型,*</strong></em></p>
<p>​    <em>*<em>*[*</em>*<em>CONSTRAINT*</em> **&lt;****外键约束名称****&gt;]*</em> *<em>FOREIGN KEY*</em>*<em>（从表的某个字段*</em>*<em>)*</em> *<em>references*</em> *<em>主表名*</em>*<em>(*</em>*<em>被参考字段) [*</em>*<em>on update*</em> *<em>xx][*</em>*<em>on delete*</em> *<em>xx];*</em>**</p>
<p>​    <em><strong>*);*</strong></em> </p>
<p><strong>– FOREIGN KEY: 在表级指定子表中的列</strong></p>
<p><strong>– REFERENCES: 标示在父表中的列</strong></p>
<p><em>*<em>*(*</em>*<em>从表的某个字段*</em>**)*</em>*<em>的数据类型必须与主表名*</em>*<em>(*</em>*<em>被参考字段*</em>*<em>)*</em>*<em>的数据类型一致，逻辑意义也一样*</em>**</p>
<p><em>*<em>*(*</em>*<em>从表的某个字段*</em>**)*</em>*<em>的字段名可以与主表名*</em>*<em>(*</em>*<em>被参考字段*</em>*<em>)*</em>*<em>的字段名一样，也可以不一样*</em>**</p>
<p><strong>举例：</strong></p>
<p>正确的创建方式：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123856679.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123857681.png" alt="img"></p>
<p> 错误的创建方式：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123857685.png" alt="img"></p>
<p> 添加数据：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123857689.png" alt="img"></p>
<p> 修改数据：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123858693.png" alt="img"></p>
<p> 删除数据：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123858697.png" alt="img"></p>
<h4 id="在ALTER-TABLE-时添加外键约束"><a href="#在ALTER-TABLE-时添加外键约束" class="headerlink" title="在ALTER TABLE 时添加外键约束"></a>在ALTER TABLE 时添加外键约束</h4><p>​    一般情况下，表与表的关联都是提前设计好了的，因此，会在创建表的时候就把外键约束定义好。不过，如果需要修改表的设计（比如添加新的字段，增加新的关联关系），但没有预先定义外键约束，那么，就要用修改表的方式来补充定义。</p>
<p><em><strong>*语法格式：*</strong></em></p>
<p>​    <em><strong>*ALTER TABLE** **从表名*</strong></em></p>
<p>​    <em>*<em>*ADD*</em> **[*</em>*<em>CONSTRAINT*</em> *<em>约束名*</em>*<em>]*</em> *<em>FOREIGN KEY*</em> *<em>(*</em>*<em>从表的字段*</em>*<em>)*</em> *<em>REFERENCES*</em> *<em>主表名*</em>*<em>(*</em>*<em>被引用 字段) [*</em>*<em>on update*</em> *<em>xx][*</em>*<em>on delete*</em> *<em>xx];*</em>**</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123859713.png" alt="img"></p>
<h3 id="约束等级（级联）"><a href="#约束等级（级联）" class="headerlink" title="约束等级（级联）"></a><strong>约束等级（级联）</strong></h3><p>​    <em><strong>*1. Cascade*</strong></em> <strong>方式</strong> ：在父表上 update&#x2F;delete 记录时，同步 update&#x2F;delete 掉子表的匹配记录</p>
<p>​    <em><strong>*2. Set null方式*</strong></em> ：在父表上 update&#x2F;delete 记录时，将子表上匹配记录的列设为 null ，但是要注意子 表的外键列不能为not null</p>
<p>​    \3. No action方式 ：如果子表中有匹配的记录，则不允许对父表对应候选键进行 update&#x2F;delete 操作</p>
<p>​    4 .Restrict方式 （默认） ：同no action ， 都是立即检查外键约束</p>
<p>​    \5. Set default方式 （在可视化工具 SQLyog 中可能显示空白）：父表有变更时，子表将外键列设置成一个默认的值，但Innodb 不能识别</p>
<p>​    <em><strong>*如果没有指定等级，就相当于Restrict方式。*</strong></em></p>
<p>​    <em><strong>*对于外键约束，最好是采用:** *<em>ON UPDATE CASCADE ON DELETE RESTRICT*</em> **的方式。*</strong></em></p>
<p><strong>举例：（以 *<em>on update cascade on delete set null*</em></strong>  **<em>*为例*<em>）</em></em></p>
<p>1.创建表</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123859737.png" alt="img"></p>
<p>2.添加数据</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123859741.png" alt="img"></p>
<p>3.修改数据 </p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123859745.png" alt="img"></p>
<p>4.删除数据 </p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123900749.png" alt="img"></p>
<h3 id="删除外键约束"><a href="#删除外键约束" class="headerlink" title="删除外键约束"></a><strong>删除外键约束</strong></h3><p><strong>流程如下：</strong></p>
<p><em>*<em>*(*</em>*<em>1*</em>**)*</em>*<em>第一步先查看约束名和删除外键约束*</em>**</p>
<p>​    <em><strong>*#查看某个表的约束名*</strong></em></p>
<p>​    <em>*<em>*SELECT*</em> ***</em>* *<em>FROM*</em> *<em>information_schema*</em>*<em>.table_constraints*</em>**</p>
<p>​    <em>*<em>*WHERE table_name*</em> **&#x3D;*</em> *<em>‘*</em>*<em>表名称*</em>*<em>‘*</em>*<em>;*</em>**</p>
<p>​    <em><strong>*ALTER TABLE** **从表名*</strong></em></p>
<p>​    <em>*<em>*DROP FOREIGN KEY*</em> *<em>外键约束名*</em>**;*</em>**</p>
<p>（ <em>*<em>*2*</em>*<em>）第二步查看索引名和删除索引。（注意，只能手动删除）*</em>*</em></p>
<p>​    <em>*<em>*#*</em>*<em>查看某个表的索引名*</em>*</em></p>
<p>​    <em>*<em>*SHOW INDEX FROM*</em> *<em>表名称*</em>**;*</em>**</p>
<p>​    <em>*<em>*ALTER TABLE*</em> *<em>从表名*</em> *<em>DROP INDEX*</em> *<em>索引名*</em>**;*</em>**</p>
<p><em><strong>*注意：** *<em>删除外键约束后，必须*</em> *<em>手动*</em> **删除对应的索引*</strong></em></p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123900781.png" alt="img"></p>
<h3 id="开发场景"><a href="#开发场景" class="headerlink" title="开发场景"></a><strong>开发场景</strong></h3><p><strong>问题</strong> <strong>1</strong> <strong>：如果两个表之间有关系（一对一、一对多），比如：员工表和部门表（一对多），它们之间是否</strong> <strong>一定要建外键约束？</strong></p>
<p>​    答：不是的</p>
<p><strong>问题</strong> <strong>2</strong> <strong>：建和不建外键约束有什么区别？</strong></p>
<p>​    答：建外键约束，你的操作（创建表、删除表、添加、修改、删除）会受到限制，从语法层面受到限制。</p>
<p>​    例如：在员工表中不可能添加一个员工信息，它的部门的值在部门表中找不到。</p>
<p>​    不建外键约束，你的操作（创建表、删除表、添加、修改、删除）不受限制，要保证数据的 引用完整 性 ，只能依 靠程序员的自觉 ，或者是 在 Java 程序中进行限定 。例如：在员工表中，可以添加一个员工的信息，它的部门指定为一个完全不存在的部门。</p>
<p><strong>问题</strong> <strong>3</strong> <strong>：那么建和不建外键约束和查询有没有关系？</strong></p>
<p>​    答：没有</p>
<p><strong>拓展：</strong></p>
<p>​    在 MySQL 里，外键约束是有成本的，需要消耗系统资源。对于大并发的 SQL 操作，有可能会不适 合。比如大型网站的中央数据库，可能会 因为外键约束的系统开销而变得非常慢 。所以， MySQL 允 许你不使用系统自带的外键约束，在 应用层面 完成检查数据一致性的逻辑。也就是说，即使你不 用外键约束，也要想办法通过应用层面的附加逻辑，来实现外键约束的功能，确保数据的一致性。</p>
<h3 id="阿里开发规范"><a href="#阿里开发规范" class="headerlink" title="阿里开发规范"></a><strong>阿里开发规范</strong></h3><p><em><strong>*【** *<em>强制*</em> **】不得使用外键与级联，一切外键概念必须在应用层解决。*</strong></em></p>
<p>​    </p>
<p>​    说明：（概念解释）学生表中的 student_id 是主键，那么成绩表中的 student_id 则为外键。如果更新学 生表中的 student_id ，同时触发成绩表中的 student_id 更新，即为级联更新。外键与级联更新适用于 单机低并发 ，不适合 分布式 、 高并发集群 ；级联更新是强阻塞，存在数据库 更新风暴 的风险；外键影响 数据库的 插入速度 。</p>
<h2 id="CHECK-约束"><a href="#CHECK-约束" class="headerlink" title="CHECK 约束"></a><strong>CHECK 约束</strong></h2><h3 id="作用-5"><a href="#作用-5" class="headerlink" title="作用"></a><strong>作用</strong></h3><p>​    检<strong>查某个字段的值是否符号xx</strong> <em><strong>*要求，一般指的是值的范围*</strong></em></p>
<h3 id="关键字-5"><a href="#关键字-5" class="headerlink" title="关键字"></a><strong>关键字</strong></h3><p>​    <em><strong>*CHECK*</strong></em></p>
<h3 id="说明：MySQL-5-7-不支持"><a href="#说明：MySQL-5-7-不支持" class="headerlink" title="说明：MySQL 5.7 不支持"></a><strong>说明：MySQL 5.7 不支持</strong></h3><p>​    <strong>MySQL5.7 可以使用</strong> <em>*<em>*check*</em>*<em>约束，但*</em>*<em>check*</em>*<em>约束对数据验证没有任何作用。添加数据时，没有任何错误或警告。*</em>*</em></p>
<p>​    <em>*<em>*MySQL 8.0*</em>*<em>中可以使用*</em>*<em>check*</em>*<em>约束了*</em>*</em> 。</p>
<h3 id="添加CHECK-约束"><a href="#添加CHECK-约束" class="headerlink" title="添加CHECK 约束"></a>添加<strong>CHECK 约束</strong></h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123900833.png" alt="img"></p>
<h2 id="DEFAULT约束"><a href="#DEFAULT约束" class="headerlink" title="DEFAULT约束"></a><strong>DEFAULT约束</strong></h2><h3 id="作用-6"><a href="#作用-6" class="headerlink" title="作用"></a><strong>作用</strong></h3><p>​    <strong>给某个字段&#x2F;</strong> <em><strong>*某列指定默认值，一旦设置默认值，在插入数据时，如果此字段没有显式赋值，则赋值为默认值。*</strong></em></p>
<h3 id="关键字-6"><a href="#关键字-6" class="headerlink" title="关键字"></a><strong>关键字</strong></h3><p>​    <strong>DEFAULT</strong></p>
<h3 id="添加默认值约束"><a href="#添加默认值约束" class="headerlink" title="添加默认值约束"></a>添加默认值约束</h3><h4 id="在-CREATE-TABLE时添加默认值约束"><a href="#在-CREATE-TABLE时添加默认值约束" class="headerlink" title="在 CREATE TABLE时添加默认值约束"></a>在 CREATE TABLE时添加默认值约束</h4><p><strong>语法格式：</strong></p>
<p>​    <strong>方式1：</strong></p>
<p>​        <strong>create table</strong> <em>*<em>*表名称*</em>**(*</em>**</p>
<p>​        <em>*<em>*字段名 数据类型*</em> *<em>primary key*</em>**,*</em>**</p>
<p>​        <em>*<em>*字段名 数据类型*</em> *<em>unique key not*</em> *<em>null*</em>**,*</em>**</p>
<p>​        <em>*<em>*字段名 数据类型*</em> *<em>unique key*</em>**,*</em>**</p>
<p>​        <em>*<em>*字段名 数据类型*</em> *<em>not*</em> *<em>null*</em> *<em>default*</em> *<em>默认值*</em>**,*</em>**</p>
<p>​        <em><strong>*);*</strong></em></p>
<p>​    <strong>方式2：</strong></p>
<p>​        <strong>create table</strong> <em>*<em>*表名称*</em>**(*</em>**</p>
<p>​        <em>*<em>*字段名 数据类型*</em> *<em>default*</em> *<em>默认值*</em> **,*</em>**</p>
<p>​        <em>*<em>*字段名 数据类型*</em> *<em>not*</em> *<em>null*</em> *<em>default*</em> *<em>默认值*</em>**,*</em>**</p>
<p>​        <em>*<em>*字段名 数据类型*</em> *<em>not*</em> *<em>null*</em> *<em>default*</em> *<em>默认值*</em>**,*</em>**</p>
<p>​        <em>*<em>*primary key*</em>**(*</em>*<em>字段名*</em>*<em>),*</em>**</p>
<p>​        <em>*<em>*unique key*</em>**(*</em>*<em>字段名*</em>*<em>)*</em>**</p>
<p>​        <em><strong>*);*</strong></em></p>
<p>​    <em><strong>*说明：默认值约束一般不在唯一键和主键列上加*</strong></em></p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123900887.png" alt="img"></p>
<h4 id="在-ALTER-TABLE时添加默认值约束"><a href="#在-ALTER-TABLE时添加默认值约束" class="headerlink" title="在 ALTER TABLE时添加默认值约束"></a>在 ALTER TABLE时添加默认值约束</h4><p><strong>语法格式：</strong></p>
<p>​    <strong>alter table</strong> <em>*<em>*表名称*</em> *<em>modify*</em> *<em>字段名 数据类型*</em> *<em>default*</em> *<em>默认值*</em>**;*</em>**</p>
<p>​    <em><strong>*alter table** *<em>表名称*</em> *<em>modify*</em> *<em>字段名 数据类型*</em> *<em>default*</em> *<em>默认值*</em> *<em>not*</em> **null*</strong></em> <strong>;</strong></p>
<p><em><strong>*注：*</strong></em></p>
<p>​    *<em>1.*<em>如果这个字段原来有非空约束，你还保留非空约束，那么在加默认值约束时，还得保留非空约束，否则非空约束就被*</em>*<em>删除了。*</em></em>*</p>
<p>​    <em>*<em>*2.同理，在给某个字段加非空约束也一样，如果这个字段原来有默认值约束，你想保留，也要在modify*</em>*<em>语句中保留默认值约束，否则就删除了。*</em>*</em></p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123901907.png" alt="img"></p>
<h3 id="删除默认值约束"><a href="#删除默认值约束" class="headerlink" title="删除默认值约束"></a><strong>删除默认值约束</strong></h3><p><strong>语法格式：</strong></p>
<p>​    <em><strong>*1.删除默认值约束，也不保留非空约束*</strong></em></p>
<p>​        <strong>alter table</strong> <em>*<em>*表名称*</em> *<em>modify*</em> *<em>字段名 数据类型*</em> **;*</em>**</p>
<p>​    <em><strong>*2.删除默认值约束，保留非空约束*</strong></em></p>
<p>​        <strong>alter table</strong> <em><strong>*表名称** *<em>modify*</em> *<em>字段名 数据类型*</em> *<em>not*</em> **null*</strong></em> <strong>;</strong> </p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123901925.png" alt="img"></p>
<h2 id="面试"><a href="#面试" class="headerlink" title="面试"></a><strong>面试</strong></h2><p><strong>面试</strong> <strong>1</strong> <strong>、为什么建表时，加</strong> <strong>not null default ‘’</strong> <strong>或</strong> <strong>default 0</strong></p>
<p>​    答：不想让表中出现null 值。</p>
<p><strong>面试</strong> <strong>2</strong> <strong>、为什么不想要</strong> <strong>null</strong> <strong>的值</strong></p>
<p>​    答: （1）不好比较。 null 是一种特殊值，比较时只能用专门的 is null 和 is not null 来比较。碰到运算符，通常返回null 。</p>
<p>​      （2）效率不高。影响提高索引效果。因此，我们往往在建表时 not null default ‘’ 或 default 0</p>
<p><strong>面试</strong> <strong>3</strong> <strong>、带</strong> <strong>AUTO_INCREMENT</strong> <strong>约束的字段值是从</strong> <strong>1</strong> <strong>开始的吗？</strong></p>
<p>​    <strong>在MySQL</strong> <em>*<em>*中，默认*</em>*<em>AUTO_INCREMENT*</em>*<em>的初始 值是1*</em>*<em>，每新增一条记录，字段值自动加*</em>*<em>1*</em>*</em> <strong>。</strong>设置自增属性（AUTO_INCREMENT）的时候，还可以指定第 一条插入记录的自增字段的值，这样新插入的记录的自增字段值从初始值开始递增，如在表中插入第一 条记录，同时指定id 值为 5 ，则以后插入的记录的 id 值就会从 6 开始往上增加。添加主键约束时，往往需要 设置字段自动增加属性。</p>
<p><strong>面试</strong> <strong>4</strong> <strong>、并不是每个表都可以任意选择存储引擎？</strong> 外键约束（</p>
<p>​    <strong>FOREIGN KEY）不能跨引擎使用。(主表和从表用的引擎要相同)</strong></p>
<p>​    MySQL支持多种存储引擎，每一个表都可以指定一个不同的存储引擎，需要注意的是：外键约束是用来保证数据的参照完整性的，如果表之间需要关联外键，却指定了不同的存储引擎，那么这些表之间是不能创建外键约束的。所以说，存储引擎的选择也不完全是随意的。</p>
<h1 id="MySQL-约束练习"><a href="#MySQL-约束练习" class="headerlink" title="MySQL 约束练习"></a>MySQL 约束练习</h1><h2 id="练习1"><a href="#练习1" class="headerlink" title="练习1"></a><strong>练习1</strong></h2><p>已经存在数据库 test04_emp ，两张表 emp2 和 dept2</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123901957.png" alt="img"></p>
<h3 id="向表emp2的id列中添加PRIMARY-KEY约束"><a href="#向表emp2的id列中添加PRIMARY-KEY约束" class="headerlink" title="向表emp2的id列中添加PRIMARY KEY约束"></a>向表emp2的id列中添加PRIMARY KEY约束</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123902963.png" alt="img"></p>
<h3 id="向表dept2的id列中添加PRIMARY-KEY约束"><a href="#向表dept2的id列中添加PRIMARY-KEY约束" class="headerlink" title="向表dept2的id列中添加PRIMARY KEY约束"></a>向表dept2的id列中添加PRIMARY KEY约束</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123902969.png" alt="img"></p>
<h3 id="向表emp2中添加列dept-id，并在其中定义FOREIGN-KEY约束，与之相关联的列是dept2表中的id列。"><a href="#向表emp2中添加列dept-id，并在其中定义FOREIGN-KEY约束，与之相关联的列是dept2表中的id列。" class="headerlink" title="向表emp2中添加列dept_id，并在其中定义FOREIGN KEY约束，与之相关联的列是dept2表中的id列。"></a>向表emp2中添加列dept_id，并在其中定义FOREIGN KEY约束，与之相关联的列是dept2表中的id列。</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123902975.png" alt="img"></p>
<h2 id="练习2"><a href="#练习2" class="headerlink" title="练习2"></a><strong>练习2</strong></h2><p>承接《第11章_数据处理之增删改》的综合案例。</p>
<h3 id="创建数据库test01-library2"><a href="#创建数据库test01-library2" class="headerlink" title="创建数据库test01_library2"></a>创建数据库test01_library2</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123902987.png" alt="img"></p>
<h3 id="创建表-books，表结构如下："><a href="#创建表-books，表结构如下：" class="headerlink" title="创建表 books，表结构如下："></a>创建表 books，表结构如下：</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123903993.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/20221007123903997.png" alt="img"></p>
<h3 id="使用ALTER语句给books按如下要求增加相应的约束"><a href="#使用ALTER语句给books按如下要求增加相应的约束" class="headerlink" title="使用ALTER语句给books按如下要求增加相应的约束"></a>使用ALTER语句给books按如下要求增加相应的约束</h3><h3 id=""><a href="#" class="headerlink" title=""></a><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239031001.png" alt="img"></h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239041003.png" alt="img"></p>
<h2 id="练习3"><a href="#练习3" class="headerlink" title="练习3"></a>练习3</h2><h3 id="创建数据库test04-company"><a href="#创建数据库test04-company" class="headerlink" title="创建数据库test04_company  "></a>创建数据库test04_company  <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239041009.png" alt="img"></h3><h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h3 id="按照下表给出的表结构在test04-company数据库中创建两个数据表offices和employees"><a href="#按照下表给出的表结构在test04-company数据库中创建两个数据表offices和employees" class="headerlink" title="按照下表给出的表结构在test04_company数据库中创建两个数据表offices和employees  "></a>按照下表给出的表结构在test04_company数据库中创建两个数据表offices和employees  <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239041013.png" alt="img"></h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239041015.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239051017.png" alt="img"></p>
<h3 id="将表employees的mobile字段修改到officeCode字段后面"><a href="#将表employees的mobile字段修改到officeCode字段后面" class="headerlink" title="将表employees的mobile字段修改到officeCode字段后面"></a>将表employees的mobile字段修改到officeCode字段后面</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239051023.png" alt="img"></p>
<h3 id="将表employees的birth字段改名为employee-birth"><a href="#将表employees的birth字段改名为employee-birth" class="headerlink" title="将表employees的birth字段改名为employee_birth"></a>将表employees的birth字段改名为employee_birth</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239051029.png" alt="img"></p>
<h3 id="修改sex字段，数据类型为CHAR-1-，非空约束"><a href="#修改sex字段，数据类型为CHAR-1-，非空约束" class="headerlink" title="修改sex字段，数据类型为CHAR(1)，非空约束"></a>修改sex字段，数据类型为CHAR(1)，非空约束</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239051035.png" alt="img"></p>
<h3 id="删除字段note"><a href="#删除字段note" class="headerlink" title="删除字段note"></a>删除字段note</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239061041.png" alt="img"></p>
<h3 id="增加字段名favoriate-activity，数据类型为VARCHAR-100"><a href="#增加字段名favoriate-activity，数据类型为VARCHAR-100" class="headerlink" title="增加字段名favoriate_activity，数据类型为VARCHAR(100)"></a>增加字段名favoriate_activity，数据类型为VARCHAR(100)</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239061047.png" alt="img"></p>
<h3 id="将表employees名称修改为employees-info"><a href="#将表employees名称修改为employees-info" class="headerlink" title="将表employees名称修改为employees_info"></a>将表employees名称修改为employees_info</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239061053.png" alt="img"></p>
<h2 id="2-拓展练习"><a href="#2-拓展练习" class="headerlink" title="2.拓展练习"></a>2.拓展练习</h2><h3 id="创建数据库：test-company"><a href="#创建数据库：test-company" class="headerlink" title="创建数据库：test_company"></a>创建数据库：test_company</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239071061.png" alt="img"></p>
<h3 id="在此数据库下创建如下3表，数据类型，宽度，是否为空根据实际情况自己定义。"><a href="#在此数据库下创建如下3表，数据类型，宽度，是否为空根据实际情况自己定义。" class="headerlink" title="在此数据库下创建如下3表，数据类型，宽度，是否为空根据实际情况自己定义。"></a>在此数据库下创建如下3表，数据类型，宽度，是否为空根据实际情况自己定义。</h3><p>A ． 部门表（department ） ：部门编号（depid），部门名称（depname），部门简介（deinfo）；其中 部门编号为主键。</p>
<p>B ． 雇员表（emoloyee ） ：雇员编号（empid），姓名（name），性别（sex），职称（title），出生日 期（birthday），所在部门编号（depid）；其中</p>
<p>​    </p>
<p>​    雇员编号为主键；</p>
<p>​    部门编号为外键，外键约束等级为（on update cascade 和on delete set null ）；</p>
<p>​    性别默认为男；</p>
<p>C ． 工资表（salary ） ：雇员编号（empid），基本工资（basesalary），职务工资（titlesalary），扣 除（deduction）。其中雇员编号为主键。</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239071083.png" alt="img"></p>
<h3 id="给工资表（salary）的雇员编号（empid）增加外键约束，外键约束等级为（on-update-cascade-和on-delete-cascade）"><a href="#给工资表（salary）的雇员编号（empid）增加外键约束，外键约束等级为（on-update-cascade-和on-delete-cascade）" class="headerlink" title="给工资表（salary）的雇员编号（empid）增加外键约束，外键约束等级为（on update cascade 和on delete cascade）"></a>给工资表（salary）的雇员编号（empid）增加外键约束，外键约束等级为（on update cascade 和on delete cascade）</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239071089.png" alt="img"></p>
<h3 id="添加数据如下："><a href="#添加数据如下：" class="headerlink" title="添加数据如下："></a>添加数据如下：</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239071095.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239081097.png" alt="img"></p>
<p> <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239081099.png" alt="img"></p>
<p> <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239081101.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239081103.png" alt="img"> </p>
<p> <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239091105.png" alt="img"></p>
<h3 id="查询出每个雇员的雇员编号，姓名，职称，所在部门名称，应发工资（基本工资-职务工资），实发工资（基本工资-职务工资-扣除）。"><a href="#查询出每个雇员的雇员编号，姓名，职称，所在部门名称，应发工资（基本工资-职务工资），实发工资（基本工资-职务工资-扣除）。" class="headerlink" title="查询出每个雇员的雇员编号，姓名，职称，所在部门名称，应发工资（基本工资+职务工资），实发工资（基本工资+职务工资-扣除）。"></a>查询出每个雇员的雇员编号，姓名，职称，所在部门名称，应发工资（基本工资+职务工资），实发工资（基本工资+职务工资-扣除）。</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239091111.png" alt="img"></p>
<h3 id="查询销售部门的雇员姓名及其基本工资"><a href="#查询销售部门的雇员姓名及其基本工资" class="headerlink" title="查询销售部门的雇员姓名及其基本工资"></a>查询销售部门的雇员姓名及其基本工资</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239091117.png" alt="img"></p>
<h3 id="查询姓“张”且年龄小于40的员工的全部信息和年龄"><a href="#查询姓“张”且年龄小于40的员工的全部信息和年龄" class="headerlink" title="查询姓“张”且年龄小于40的员工的全部信息和年龄"></a>查询姓“张”且年龄小于40的员工的全部信息和年龄</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239101123.png" alt="img"></p>
<h3 id="查询所有男员工的基本工资和职务工资"><a href="#查询所有男员工的基本工资和职务工资" class="headerlink" title="查询所有男员工的基本工资和职务工资"></a>查询所有男员工的基本工资和职务工资</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239101129.png" alt="img"></p>
<h3 id="查询基本工资低于2000的员工姓名和职称、所在部门名称"><a href="#查询基本工资低于2000的员工姓名和职称、所在部门名称" class="headerlink" title="查询基本工资低于2000的员工姓名和职称、所在部门名称"></a>查询基本工资低于2000的员工姓名和职称、所在部门名称</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239101135.png" alt="img"> </p>
<h3 id="查询员工总数"><a href="#查询员工总数" class="headerlink" title="查询员工总数"></a>查询员工总数</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239101139.png" alt="img"></p>
<h3 id="查询部门总数"><a href="#查询部门总数" class="headerlink" title="查询部门总数"></a>查询部门总数</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239111145.png" alt="img"></p>
<h3 id="查询应发工资的平均工资和最高工资、最低工资"><a href="#查询应发工资的平均工资和最高工资、最低工资" class="headerlink" title="查询应发工资的平均工资和最高工资、最低工资"></a>查询应发工资的平均工资和最高工资、最低工资</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239111151.png" alt="img"></p>
<h3 id="按照部门统计应发工资的平均工资"><a href="#按照部门统计应发工资的平均工资" class="headerlink" title="按照部门统计应发工资的平均工资"></a>按照部门统计应发工资的平均工资</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239111157.png" alt="img"></p>
<h3 id="找出部门基本工资的平均工资低于2000的"><a href="#找出部门基本工资的平均工资低于2000的" class="headerlink" title="找出部门基本工资的平均工资低于2000的"></a>找出部门基本工资的平均工资低于2000的</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239121163.png" alt="img"></p>
<h3 id="按照员工编号、姓名、基本工资、职务工资、扣除，并按照职务升序排列，如果职务工资相同，再按照基本工资升序排列"><a href="#按照员工编号、姓名、基本工资、职务工资、扣除，并按照职务升序排列，如果职务工资相同，再按照基本工资升序排列" class="headerlink" title="按照员工编号、姓名、基本工资、职务工资、扣除，并按照职务升序排列，如果职务工资相同，再按照基本工资升序排列"></a>按照员工编号、姓名、基本工资、职务工资、扣除，并按照职务升序排列，如果职务工资相同，再按照基本工资升序排列</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239121169.png" alt="img"></p>
<h3 id="查询员工编号、姓名，出生日期，及年龄段。其中，如果80年之前出生的，定为”老年“；80后定为”中年“，90后定为”青壮年“"><a href="#查询员工编号、姓名，出生日期，及年龄段。其中，如果80年之前出生的，定为”老年“；80后定为”中年“，90后定为”青壮年“" class="headerlink" title="查询员工编号、姓名，出生日期，及年龄段。其中，如果80年之前出生的，定为”老年“；80后定为”中年“，90后定为”青壮年“"></a>查询员工编号、姓名，出生日期，及年龄段。其中，如果80年之前出生的，定为”老年“；80后定为”中年“，90后定为”青壮年“</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239121175.png" alt="img"></p>
<h3 id="查询所有的员工信息，和他所在的部门名称"><a href="#查询所有的员工信息，和他所在的部门名称" class="headerlink" title="查询所有的员工信息，和他所在的部门名称"></a>查询所有的员工信息，和他所在的部门名称</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239131181.png" alt="img"></p>
<h3 id="查询所有部门信息，和该部门的员工信息"><a href="#查询所有部门信息，和该部门的员工信息" class="headerlink" title="查询所有部门信息，和该部门的员工信息"></a>查询所有部门信息，和该部门的员工信息</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239131187.png" alt="img"></p>
<h3 id="查询所有职位中含“工程师”的男员工的人数"><a href="#查询所有职位中含“工程师”的男员工的人数" class="headerlink" title="查询所有职位中含“工程师”的男员工的人数"></a>查询所有职位中含“工程师”的男员工的人数</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239131193.png" alt="img"></p>
<h3 id="查询每个部门的男生和女生的人数和平均基本工资"><a href="#查询每个部门的男生和女生的人数和平均基本工资" class="headerlink" title="查询每个部门的男生和女生的人数和平均基本工资"></a>查询每个部门的男生和女生的人数和平均基本工资</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239131199.png" alt="img"></p>
<h1 id="MySQL-视图"><a href="#MySQL-视图" class="headerlink" title="MySQL 视图"></a>MySQL 视图</h1><h2 id="常见的数据库对象"><a href="#常见的数据库对象" class="headerlink" title="常见的数据库对象"></a><strong>常见的数据库对象</strong></h2><table>
<thead>
<tr>
<th><em><strong>*对象*</strong></em></th>
<th><em><strong>*描述*</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>*<em>*表*</em>**(TABLE)*</em>**</td>
<td><em><strong>*表是存储数据的逻辑单元，以行和列的形式存在，列就是字段，行就是记录*</strong></em></td>
</tr>
<tr>
<td><em><strong>*数据字典*</strong></em></td>
<td><em>*<em>*就是系统表，存放数据库相关信息的表。系统表的数据通常由数据库系统维护，*</em>*<em>程序员通常不应该修改，只可查看*</em>*</em></td>
</tr>
<tr>
<td><em>*<em>*约束*</em>**(CONSTRAINT)*</em>**</td>
<td><em><strong>*执行数据校验的规则，用于保证数据完整性的规则*</strong></em></td>
</tr>
<tr>
<td><strong>视图(VIEW)</strong></td>
<td><strong>一个或者多个数据表里的数据的逻辑显示，视图并不存储数据</strong></td>
</tr>
<tr>
<td><em>*<em>*索引*</em>**(INDEX)*</em>**</td>
<td><em><strong>*用于提高查询性能，相当于书的目录*</strong></em></td>
</tr>
<tr>
<td><em>*<em>*存储过程*</em>**(PROCEDURE)*</em>**</td>
<td><em><strong>*用于完成一次完整的业务处理，没有返回值，但可通过传出参数将多个值传给调用环境*</strong></em></td>
</tr>
<tr>
<td><em>*<em>*存储函数*</em>**(FUNCTION)*</em>**</td>
<td><em><strong>*用于完成一次特定的计算，具有一个返回值*</strong></em></td>
</tr>
<tr>
<td><em>*<em>*触发器*</em>**(TRIGGER)*</em>**</td>
<td><em>*<em>*相当于一个事件监听器，当数据库发生特定事件后，触发器被触发，完成相应的*</em>*<em>处理*</em>*</em></td>
</tr>
</tbody></table>
<h2 id="视图概述"><a href="#视图概述" class="headerlink" title="视图概述"></a><strong>视图概述</strong></h2><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239141218.png" alt="img"></p>
<h3 id="为什么使用视图？"><a href="#为什么使用视图？" class="headerlink" title="为什么使用视图？"></a><strong>为什么使用视图？</strong></h3><p>​    视图一方面可以帮我们使用表的一部分而不是所有的表，另一方面也可以针对不同的用户制定不同的查询视图。</p>
<p>​    比如，针对一个公司的销售人员，我们只想给他看部分数据，而某些特殊的数据，比如采购的价格，则不会提供给他。再比如，人员薪酬是个敏感的字段，那么只给某个级别以上的人员开放，其他人的查询视图中则不提供这个字段。</p>
<p>​    刚才讲的只是视图的一个使用场景，实际上视图还有很多作用。最后，我们总结视图的优点。</p>
<h3 id="视图的理解"><a href="#视图的理解" class="headerlink" title="视图的理解"></a><strong>视图的理解</strong></h3><p>​    视图是一种 虚拟表 ，本身是 不具有数据 的，占用很少的内存空间，它是 SQL 中的一个重要概念。</p>
<p>​    <strong>视图建立在已有表的基础上</strong> , 视图赖以建立的这些表称为 <strong>基表</strong> 。</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239141236.png" alt="img"></p>
<p>​    <strong>视图的创建和删除只影响视图本身，不影响对应的基表。但是当对视图中的数据进行增加、删除和修改操作时，数据表中的数据会相应地发生变化，反之亦然。</strong></p>
<p>​    向视图提供数据内容的语句为 SELECT 语句 , 可以将视图理解为 <strong>存储起来的</strong> <strong>SELECT</strong> <strong>语句</strong> <strong>（</strong> 在数据库中，视图不会保存数据，数据真正保存在数据表中。当对视图中的数据进行增加、删 除和修改操作时，数据表中的数据会相应地发生变化；反之亦然。 ）</p>
<p>​    视图，是向用户提供基表数据的另一种表现形式。通常情况下，小型项目的数据库可以不使用视图，但是在大型项目中，以及数据表比较复杂的情况下，视图的价值就凸显出来了，它可以帮助我们把经常查询的结果集放到虚拟表中，提升使用效率。理解和使用起来都非常方便。</p>
<p>总结：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239151252.png" alt="img"></p>
<h2 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a><strong>创建视图</strong></h2><p><strong>语法格式：</strong></p>
<p>​    <strong>在 CREATE VIEW 语句中嵌入子查询</strong></p>
<p>​        <strong>CREATE</strong> <em>*<em>*[*</em>*<em>OR REPLACE*</em>**]*</em>**</p>
<p>​        <em>*<em>*[*</em>*<em>ALGORITHM*</em> **&#x3D; {UNDEFINED | MERGE | TEMPTABLE}]*</em>**</p>
<p>​        <em>*<em>*VIEW*</em> *<em>视图名称*</em> **[(*</em>*<em>字段列表*</em>*<em>)]*</em>**</p>
<p>​        <em><strong>*AS** **查询语句*</strong></em></p>
<p>​        <em>*<em>*[*</em>*<em>WITH*</em> **[*</em>*<em>CASCADED*</em>*<em>|*</em>*<em>LOCAL*</em>*<em>]*</em> *<em>CHECK OPTION*</em>*<em>]*</em>**</p>
<p>​    <strong>精简版：</strong></p>
<p>​        <strong>CREATE VIEW</strong> <em><strong>*视图名称*</strong></em></p>
<p>​        <em><strong>*AS** **查询语句*</strong></em></p>
<p><strong>查询视图语法：</strong></p>
<p>​     <strong>SELECT 字段列表 FROM 视图名称;</strong></p>
<p>准备工作：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239151284.png" alt="img"></p>
<h3 id="创建单表视图"><a href="#创建单表视图" class="headerlink" title="创建单表视图"></a><strong>创建单表视图</strong></h3><h3 id="情况1：视图中的字段与基表中的字段有对应关系"><a href="#情况1：视图中的字段与基表中的字段有对应关系" class="headerlink" title="情况1：视图中的字段与基表中的字段有对应关系"></a><strong>情况1：视图中的字段与基表中的字段有对应关系</strong></h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239151292.png" alt="img"></p>
<p>​    </p>
<p>​    <strong>定义视图中字段名称的方式1： 查询语句中字段的别名会作为视图中的字段名</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239161298.png" alt="img"></p>
<p>​     <strong>定义视图中字段名称的方式2：创建视图时 视图名称 后的子段列表为字段名</strong></p>
<p>​    <strong>（前提：小括号里的字段列表需要与SELECT 后的字段列表 一 一对应）</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239161306.png" alt="img"></p>
<p>​    </p>
<h3 id="情况二：视图中的字段在基表中可能没有对应的字段"><a href="#情况二：视图中的字段在基表中可能没有对应的字段" class="headerlink" title="情况二：视图中的字段在基表中可能没有对应的字段"></a>情况二：视图中的字段在基表中可能没有对应的字段</h3><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239161314.png" alt="img"></p>
<p>​    <strong>说明1</strong><em>*<em>*：实际上就是我们在*</em> *<em>SQL*</em> *<em>查询语句的基础上封装了视图*</em> *<em>VIEW*</em>*<em>，这样就会基于*</em> *<em>SQL*</em> *<em>语句的结果集形成一张虚拟表。*</em>*</em></p>
<p>​    <em>*<em>*说明2：在创建视图时，没有在视图名后面指定字段列表，则视图中字段列表默认和*</em>*<em>SELECT*</em>*<em>语句中的字段列表一致。如果SELECT*</em>*<em>语句中给字段取了别名，那么视图中的字段名和别名相同。*</em>*</em></p>
<h3 id="创建多表联合视图"><a href="#创建多表联合视图" class="headerlink" title="创建多表联合视图"></a><strong>创建多表联合视图</strong></h3><p>​    <strong>本质为多表查询后的结果来创建视图</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239171330.png" alt="img"></p>
<h3 id="利用视图对数据进行格式化"><a href="#利用视图对数据进行格式化" class="headerlink" title="利用视图对数据进行格式化"></a><strong>利用视图对数据进行格式化</strong></h3><p>​    <strong>我们经常需要输出某个格式的内容，比如我们想输出员工对应的 部门名和其对应的部门号，对应格式为</strong> <strong>:last_name,department_name(department_id)</strong> <strong>，就可以使用视图来完成数据格式化的操作：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239171340.png" alt="img"></p>
<h3 id="基于视图创建视图"><a href="#基于视图创建视图" class="headerlink" title="基于视图创建视图"></a><strong>基于视图创建视图</strong></h3><p>当我们创建好一张视图之后，还可以在它的基础上继续创建视图。</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239181350.png" alt="img"></p>
<h2 id="查看视图"><a href="#查看视图" class="headerlink" title="查看视图"></a><strong>查看视图</strong></h2><h3 id="查看数据库的表对象、视图对象"><a href="#查看数据库的表对象、视图对象" class="headerlink" title="查看数据库的表对象、视图对象"></a>查看数据库的表对象、视图对象</h3><p><strong>语法:</strong> </p>
<p>​    <em>*<em>*SHOW TABLES*</em>**;*</em>**</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239181362.png" alt="img"></p>
<h3 id="查看视图的结构"><a href="#查看视图的结构" class="headerlink" title="查看视图的结构"></a>查看视图的结构</h3><p><em>*<em>*语法*</em>*<em>：*</em>*</em></p>
<p>​    <em>*<em>*DESC*</em> **&#x2F;*</em> *<em>DESCRIBE*</em> *<em>视图名称*</em>*<em>;*</em>**</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239181372.png" alt="img"></p>
<h3 id="查看视图的属性信息"><a href="#查看视图的属性信息" class="headerlink" title="查看视图的属性信息"></a>查看视图的属性信息</h3><p>​     <em><strong>*查看视图信息（显示数据表的存储引擎、版本、数据行数和数据大小等）*</strong></em></p>
<p><em><strong>*语法：*</strong></em></p>
<p>​    <strong>SHOW TABLE STATUS LIKE</strong> <em>*<em>*‘*</em>*<em>视图名称*</em>**’*</em>*<em>\G*</em>**</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239191384.png" alt="img"></p>
<p>​     执行结果显示，注释Comment为VIEW，说明该表为视图，其他的信息为NULL，说明这是一个虚表。</p>
<h3 id="查看视图的详细定义信息"><a href="#查看视图的详细定义信息" class="headerlink" title="查看视图的详细定义信息"></a>查看视图的详细定义信息</h3><p><strong>语法：</strong></p>
<p>​    <em>*<em>*SHOW CREATE VIEW*</em> *<em>视图名称*</em>**;*</em>**</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239191396.png" alt="img"></p>
<h2 id="更新视图的数据"><a href="#更新视图的数据" class="headerlink" title="更新视图的数据"></a><strong>更新视图的数据</strong></h2><h3 id="一般情况，可以更新的数据"><a href="#一般情况，可以更新的数据" class="headerlink" title="一般情况，可以更新的数据"></a><strong>一般情况，可以更新的数据</strong></h3><p>​    <strong>MySQL支持使用</strong> <em>*<em>*INSERT*</em>*<em>、*</em>*<em>UPDATE*</em>*<em>和*</em>*<em>DELETE*</em>*<em>语句对视图中的数据进行插入、更新和删除操作。当视图中的数据发生变化时，数据表中的数据也会发生变化，反之亦然。*</em>*</em></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239191408.png" alt="img"></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239201410.png" alt="img"> </p>
<h3 id="不可更新的视图"><a href="#不可更新的视图" class="headerlink" title="不可更新的视图"></a><strong>不可更新的视图</strong></h3><p>​    要使视图可更新，视图中的行和底层基本表中的行之间必须存在 <strong>一对一</strong> 的关系。另外当视图定义出现如下情况时，视图不支持更新操作：</p>
<p>​    <strong>1 .在定义视图的时候指定了“ALGORITHM &#x3D; TEMPTABLE”</strong> <em>*<em>*，视图将不支持*</em>*<em>INSERT*</em>*<em>和*</em>*<em>DELETE*</em>*<em>操作；*</em>*</em></p>
<p>​    <em>*<em>*2. 视图中不包含基表中所有被定义为非空又未指定默认值的列，视图将不支持INSERT*</em>*<em>操作；*</em>*</em></p>
<p>​    <em>*<em>*3. 在定义视图的SELECT*</em>*<em>语句中使用了*</em> *<em>JOIN*</em>*<em>联合查询*</em> *<em>，视图将不支持*</em>*<em>INSERT*</em>*<em>和*</em>*<em>DELETE*</em>*<em>操作；*</em>*</em></p>
<p>​    <em>*<em>*4. 在定义视图的SELECT*</em>*<em>语句后的字段列表中使用了*</em> *<em>数学表达式*</em> *<em>或*</em> *<em>子查询*</em> *<em>，视图将不支持*</em>*<em>INSERT*</em>*<em>，也不支持UPDATE*</em>*<em>使用了数学表达式、子查询的字段值；*</em>*</em></p>
<p>​    <em>*<em>*5. 在定义视图的SELECT*</em>*<em>语句后的字段列表中使用*</em> *<em>DISTINCT*</em> *<em>、*</em> *<em>聚合函数*</em> *<em>、*</em> *<em>GROUP BY*</em> *<em>、*</em> *<em>HAVING*</em> *<em>、*</em>*<em>UNION*</em> *<em>等，视图将不支持*</em>*<em>INSERT*</em>*<em>、*</em>*<em>UPDATE*</em>*<em>、*</em>*<em>DELETE*</em>*<em>；*</em>*</em></p>
<p>​    <em>*<em>*6. 在定义视图的SELECT*</em>*<em>语句中包含了子查询，而子查询中引用了*</em>*<em>FROM*</em>*<em>后面的表，视图将不支持 INSERT、*</em>*<em>UPDATE*</em>*<em>、*</em>*<em>DELETE*</em>*<em>；*</em>*</em></p>
<p>​    <em><strong>*7. 视图定义基于一个** *<em>不可更新视图*</em> **；*</strong></em></p>
<p>​    <em><strong>*8. 常量视图。*</strong></em></p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239201438.png" alt="img"></p>
<h2 id="修改、删除视图"><a href="#修改、删除视图" class="headerlink" title="修改、删除视图"></a><strong>修改、删除视图</strong></h2><h3 id="修改视图"><a href="#修改视图" class="headerlink" title="修改视图"></a><strong>修改视图</strong></h3><p><em>*<em>*方式*</em>*<em>1*</em>*<em>：使用*</em>*<em>CREATE*</em> *<em>OR REPLACE*</em> *<em>VIEW*</em> *<em>子句*</em>*<em>修改视图*</em>*</em></p>
<p>​    <strong>CREATE OR REPLACE VIEW</strong> <em><strong>*视图名称[(字段列表)]*</strong></em></p>
<p>​    <em><strong>*AS*</strong></em></p>
<p>​    <strong>查询语句；</strong></p>
<p><em>*<em>*说明：*</em>*<em>CREATE VIEW*</em> *<em>子句中各列的别名应和子查询中各列相对应。*</em>*</em></p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239201462.png" alt="img"></p>
<p><em>*<em>*方式*</em>*<em>2*</em>*<em>：*</em>*<em>ALTER VIEW*</em>*</em></p>
<p><em><strong>*修改视图的语法是：*</strong></em>    </p>
<p>​    <strong>ALTER VIEW</strong> <em><strong>*视图名称*</strong></em></p>
<p>​    <em><strong>*AS*</strong></em></p>
<p>​    <em><strong>*查询语句；*</strong></em></p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239211478.png" alt="img"></p>
<h3 id="删除视图"><a href="#删除视图" class="headerlink" title="删除视图"></a><strong>删除视图</strong></h3><p>​    <strong>删除视图只是删除视图的定义，并不会删除基表的数据。</strong></p>
<p><strong>语法格式：</strong></p>
<p>​    <strong>1.</strong>  <em>*<em>*DROP VIEW [ IF EXISTS ]*</em> *<em>视图名称*</em>**;*</em>**</p>
<p>​    *<em>2. *<em>DROP VIEW [ IF EXISTS ]*</em> *<em>视图名称*</em>*<em>1,*</em>*<em>视图名称*</em>*<em>2,*</em>*<em>视图名称*</em>*<em>3,…;*</em></em>*</p>
<p><em>*<em>*说明：基于视图*</em>*<em>a*</em>*<em>、*</em>*<em>b*</em>*<em>创建了新的视图*</em>*<em>c*</em>*<em>，如果将视图*</em>*<em>a*</em>*<em>或者视图*</em>*<em>b*</em>*<em>删除，会导致视图*</em>*<em>c*</em>*<em>的查询失败。这样的视图c*</em>*<em>需要手动删除或修改，否则影响使用。*</em>*</em></p>
<p><strong>举例：</strong></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239211498.png" alt="img"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2><h3 id="视图优点"><a href="#视图优点" class="headerlink" title="视图优点"></a><strong>视图优点</strong></h3><h4 id="操作简单"><a href="#操作简单" class="headerlink" title="操作简单"></a><strong>操作简单</strong></h4><p>​    将经常使用的查询操作定义为视图，可以使开发人员不需要关心视图对应的数据表的结构、表与表之间的关联关系，也不需要关心数据表之间的业务逻辑和查询条件，而只需要简单地操作视图即可，极大简化了开发人员对数据库的操作。</p>
<h4 id="减少数据冗余"><a href="#减少数据冗余" class="headerlink" title="减少数据冗余"></a><strong>减少数据冗余</strong></h4><p>​    视图跟实际数据表不一样，它存储的是查询语句。所以，在使用的时候，我们要通过定义视图的查询语句来获取结果集。而视图本身不存储数据，不占用数据存储的资源，减少了数据冗余。</p>
<h4 id="数据安全"><a href="#数据安全" class="headerlink" title="数据安全"></a><strong>数据安全</strong></h4><p>​    MySQL将用户对数据的 访问限制 在某些数据的结果集上，而这些数据的结果集可以使用视图来实现。用户不必直接查询或操作数据表。这也可以理解为视图具有 隔离性 。视图相当于在用户和实际的数据表之间加了一层虚拟表。</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239211518.png" alt="img"></p>
<p>​    同时，MySQL 可以根据权限将用户对数据的访问限制在某些视图上， <strong>用户不需要查询数据表，可以直接</strong> <strong>通过视图获取数据表中的信息</strong> 。这在一定程度上保障了数据表中数据的安全性。</p>
<h4 id="适应灵活多变的需求"><a href="#适应灵活多变的需求" class="headerlink" title="适应灵活多变的需求"></a><strong>适应灵活多变的需求</strong></h4><p>​    当业务系统的需求发生变化后，如果需要改动数据表的结构，则工作量相对较</p>
<p>大，可以使用视图来减少改动的工作量。这种方式在实际工作中使用得比较多。</p>
<h4 id="能够分解复杂的查询逻辑"><a href="#能够分解复杂的查询逻辑" class="headerlink" title="能够分解复杂的查询逻辑"></a><strong>能够分解复杂的查询逻辑</strong></h4><p>​    数据库中如果存在复杂的查询逻辑，则可以将问题进行分解，创建多个视图获取数据，再将创建的多个视图结合起来，完成复杂的查询逻辑。</p>
<h3 id="视图不足"><a href="#视图不足" class="headerlink" title="视图不足"></a>视图不足</h3><p>​    如果我们在实际数据表的基础上创建了视图，那么， <strong>如果实际数据表的结构变更了，我们就需要及时对</strong> <strong>相关的视图进行相应的维护</strong> 。特别是嵌套的视图（就是在视图的基础上创建视图），维护会变得比较复杂， 可读性不好 ，容易变成系统的潜在隐患。因为创建视图的 SQL 查询可能会对字段重命名，也可能包含复杂的逻辑，这些都会增加维护的成本。</p>
<p>实际项目中，如果视图过多，会导致数据库维护成本的问题。</p>
<p>​    所以，在创建视图的时候，你要结合实际项目需求，综合考虑视图的优点和不足，这样才能正确使用视图，使系统整体达到最优。</p>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><h3 id="练习1-1"><a href="#练习1-1" class="headerlink" title="练习1"></a>练习1</h3><h4 id="使用表employees创建视图employee-vu，其中包括姓名（LAST-NAME），员工号（EMPLOYEE-ID），部门-号-DEPARTMENT-ID"><a href="#使用表employees创建视图employee-vu，其中包括姓名（LAST-NAME），员工号（EMPLOYEE-ID），部门-号-DEPARTMENT-ID" class="headerlink" title="使用表employees创建视图employee_vu，其中包括姓名（LAST_NAME），员工号（EMPLOYEE_ID），部门 号(DEPARTMENT_ID)"></a>使用表employees创建视图employee_vu，其中包括姓名（LAST_NAME），员工号（EMPLOYEE_ID），部门 号(DEPARTMENT_ID)</h4><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239211552.png" alt="img"></p>
<h4 id="显示视图的结构"><a href="#显示视图的结构" class="headerlink" title="显示视图的结构"></a>显示视图的结构</h4><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239221556.png" alt="img"></p>
<h4 id="查询视图中的全部内容"><a href="#查询视图中的全部内容" class="headerlink" title="查询视图中的全部内容"></a>查询视图中的全部内容</h4><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239221562.png" alt="img"></p>
<h4 id="将视图中的数据限定在部门号是80的范围内"><a href="#将视图中的数据限定在部门号是80的范围内" class="headerlink" title="将视图中的数据限定在部门号是80的范围内"></a>将视图中的数据限定在部门号是80的范围内</h4><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239221568.png" alt="img"></p>
<h3 id="练习2-1"><a href="#练习2-1" class="headerlink" title="练习2"></a>练习2</h3><p>给定:</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239231576.png" alt="img"></p>
<h4 id="创建视图emp-v1-要求查询电话号码以‘011’开头的员工姓名和工资、邮箱"><a href="#创建视图emp-v1-要求查询电话号码以‘011’开头的员工姓名和工资、邮箱" class="headerlink" title="创建视图emp_v1,要求查询电话号码以‘011’开头的员工姓名和工资、邮箱"></a>创建视图emp_v1,要求查询电话号码以‘011’开头的员工姓名和工资、邮箱</h4><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239231580.png" alt="img"></p>
<h4 id="要求将视图-emp-v1-修改为查询电话号码以‘011’开头的并且邮箱中包含-e-字符的员工姓名和邮箱、电话号码"><a href="#要求将视图-emp-v1-修改为查询电话号码以‘011’开头的并且邮箱中包含-e-字符的员工姓名和邮箱、电话号码" class="headerlink" title="要求将视图 emp_v1 修改为查询电话号码以‘011’开头的并且邮箱中包含 e 字符的员工姓名和邮箱、电话号码 "></a>要求将视图 emp_v1 修改为查询电话号码以‘011’开头的并且邮箱中包含 e 字符的员工姓名和邮箱、电话号码 <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239231584.png" alt="img"></h4><h4 id="向-emp-v1-插入一条记录，是否可以？"><a href="#向-emp-v1-插入一条记录，是否可以？" class="headerlink" title="向 emp_v1 插入一条记录，是否可以？"></a>向 emp_v1 插入一条记录，是否可以？</h4><p><em><strong>*不可以，employees表中含有 emp_v1中不存在 的NOT NULL字段*</strong></em></p>
<h4 id="修改emp-v1中员工的工资，每人涨薪1000"><a href="#修改emp-v1中员工的工资，每人涨薪1000" class="headerlink" title="修改emp_v1中员工的工资，每人涨薪1000"></a>修改emp_v1中员工的工资，每人涨薪1000</h4><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239241594.png" alt="img"></p>
<h4 id="删除emp-v1中姓名为Olsen的员工"><a href="#删除emp-v1中姓名为Olsen的员工" class="headerlink" title="删除emp_v1中姓名为Olsen的员工"></a>删除emp_v1中姓名为Olsen的员工</h4><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239241600.png" alt="img"></p>
<h4 id="创建视图emp-v2，要求查询部门的最高工资高于-12000-的部门id和其最高工资"><a href="#创建视图emp-v2，要求查询部门的最高工资高于-12000-的部门id和其最高工资" class="headerlink" title="创建视图emp_v2，要求查询部门的最高工资高于 12000 的部门id和其最高工资"></a>创建视图emp_v2，要求查询部门的最高工资高于 12000 的部门id和其最高工资</h4><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239241606.png" alt="img"></p>
<h4 id="向-emp-v2-中插入一条记录，是否可以？"><a href="#向-emp-v2-中插入一条记录，是否可以？" class="headerlink" title="向 emp_v2 中插入一条记录，是否可以？"></a>向 emp_v2 中插入一条记录，是否可以？</h4><p><strong>不可以，emp_v2中含有聚合函数处理过的字段</strong></p>
<h4 id="删除刚才的emp-v2-和-emp-v1"><a href="#删除刚才的emp-v2-和-emp-v1" class="headerlink" title="删除刚才的emp_v2 和 emp_v1"></a>删除刚才的emp_v2 和 emp_v1</h4><p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239241616.png" alt="img"></p>
<h1 id="MySQL-存储过程与函数"><a href="#MySQL-存储过程与函数" class="headerlink" title="MySQL 存储过程与函数"></a>MySQL 存储过程与函数</h1><h2 id="存储过程概述"><a href="#存储过程概述" class="headerlink" title="存储过程概述"></a><strong>存储过程概述</strong></h2><h3 id="理解"><a href="#理解" class="headerlink" title="理解"></a><strong>理解</strong></h3><p><strong>含义</strong> ：存储过程的英文是 Stored Procedure 。它的思想很简单，就是一组经过 预先编译 的 SQL 语句的封装。</p>
<p><strong>执行过程：</strong> 存储过程预先存储在 MySQL 服务器上，需要执行的时候，客户端只需要向服务器端发出调用存储过程的命令，服务器端就可以把预先存储好的这一系列 SQL 语句全部执行。</p>
<p><strong>好处</strong> ：</p>
<p>​    <strong>1、简化操作，提高了</strong> <em>*<em>*sql*</em>*<em>语句的重用性，减少了开发程序员的压力*</em>*</em></p>
<p>​    <em><strong>*2、减少操作过程中的失误，提高效率*</strong></em></p>
<p>​    <em><strong>*3、减少网络传输量（客户端不需要把所有的** *<em>SQL*</em> **语句通过网络发给服务器）*</strong></em></p>
<p>​    <em><strong>*4、减少了** *<em>SQL*</em> **语句暴露在网上的风险，也提高了数据查询的安全性*</strong></em></p>
<p><strong>和视图、函数的对比</strong> ：</p>
<p>​    它和视图有着同样的优点，清晰、安全，还可以减少网络传输量。不过它和视图不同，视图是 虚拟表 ，通常不对底层数据表直接操作，而存储过程是程序化的 SQL ，可以 直接操作底层数据表 ，相比于面向集合的操作方式，能够实现一些更复杂的数据处理。</p>
<p>​    一旦存储过程被创建出来，使用它就像使用函数一样简单，我们直接通过调用存储过程名即可。相较于函数，存储过程是 没有返回值 的。</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a><strong>分类</strong></h3><p>存储过程的参数类型可以是 IN 、 OUT 和 INOUT 。根据这点分类如下：</p>
<p>​    <strong>1、没有参数（无参数无返回）</strong></p>
<p>​    <em><strong>*2、仅仅带** *<em>IN*</em> **类型（有参数无返回）*</strong></em></p>
<p>​    <em><strong>*3、仅仅带** *<em>OUT*</em> **类型（无参数有返回）*</strong></em></p>
<p>​    <em>*<em>*4、既带*</em> *<em>IN*</em> *<em>又带*</em> *<em>OUT*</em>*<em>（有参数有返回）*</em>*</em></p>
<p>​    <em>*<em>*5、带*</em> *<em>INOUT*</em>*<em>（有参数有返回）*</em>*</em></p>
<p>注意：IN、OUT、INOUT 都可以在一个存储过程中带多个。</p>
<h2 id="创建与调用存储过程"><a href="#创建与调用存储过程" class="headerlink" title="创建与调用存储过程"></a><strong>创建与调用存储过程</strong></h2><h3 id="创建存储过程语法及其分析"><a href="#创建存储过程语法及其分析" class="headerlink" title="创建存储过程语法及其分析"></a><strong>创建存储过程语法及其分析</strong></h3><p><em><strong>*语法：*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 存储过程名(<span class="keyword">IN</span><span class="operator">|</span><span class="keyword">OUT</span><span class="operator">|</span><span class="keyword">INOUT</span> 参数名 参数类型,...)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[characteristics ...]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        存储过程体</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>类似于 Java 中的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">修饰符 返回类型 方法名(参数类型 参数名,...)&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        方法体;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>说明：</strong></p>
<p><em>*<em>*1*</em>*<em>、参数前面的符号的意思*</em>*</em></p>
<p>​    <em><strong>*IN** **：当前参数为输入参数，也就是表示入参；*</strong></em></p>
<p>​    <em><strong>*存储过程只是读取这个参数的值。如果没有定义参数种类，** *<em>默认就是*</em> *<em>IN*</em> **，表示输入参数。*</strong></em></p>
<p>​    <em><strong>*OUT** **：当前参数为输出参数，也就是表示出参；*</strong></em></p>
<p>​    <em><strong>*执行完成之后，调用这个存储过程的客户端或者应用程序就可以读取这个参数返回的值了。*</strong></em></p>
<p>​    <em><strong>*INOUT** **：当前参数既可以为输入参数，也可以为输出参数。<img src="https://latex.codecogs.com/gif.latex?%7B%5Ccolor%7BTeal%7D%20%5Ccdot%20%5Ccdot%20%5Ccdot%20%7D" alt="{\color{Teal} \cdot \cdot \cdot }">*</strong></em></p>
<p>2 、形参类型可以是 MySQL 数据库中的任意类型。</p>
<p>3 、 characteristics 表示创建存储过程时指定的对存储过程的约束条件，其取值信息如下：</p>
<blockquote>
<p><em><strong>*LANGUAGE SQL*</strong></em></p>
<p><em>*<em>*| [*</em>*<em>NOT*</em>**]*</em> *<em>DETERMINISTIC*</em>**</p>
<p><em>*<em>*| {*</em> *<em>CONTAINS SQL*</em> **|*</em> *<em>NO SQL*</em> *<em>|*</em> *<em>READS SQL DATA*</em> *<em>|*</em> *<em>MODIFIES SQL DATA*</em> *<em>}*</em>**</p>
<p><em>*<em>*|*</em> *<em>SQL SECURITY*</em> **{ DEFINER |*</em> *<em>INVOKER*</em> *<em>}*</em>**</p>
<p><em>*<em>*|*</em> *<em>COMMENT*</em> **’string’*</em>**</p>
</blockquote>
<p>​    <img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> LANGUAGE SQL ：说明存储过程执行体是由 SQL 语句组成的，当前系统支持的语言为 SQL 。 </p>
<p>​    <img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> [NOT] DETERMINISTIC ：指明存储过程执行的结果是否确定。 DETERMINISTIC 表示结果是确定的。每次执行存储过程时，相同的输入会得到相同的输出。NOT DETERMINISTIC 表示结果是不确定的，相同的输入可能得到不同的输出。如果没有指定任意一个值，<strong>默认为NOT DETERMINISTIC</strong> <em><strong>*。*</strong></em> </p>
<p>​    <img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } ：指明子程序使 用SQL 语句的限制。</p>
<p>​        （1） CONTAINS SQL 表示当前存储过程的子程序包含SQL 语句，但是并不包含读写数</p>
<p>​                          据的SQL语句；</p>
<p>​        （2） NO SQL 表示当前存储过程的子程序中不包含任何SQL语句；</p>
<p>​        （3） READS SQL DATA 表示当前存储过程的子程序中包含读数据的SQL语句；</p>
<p>​        （4） MODIFIES SQL DATA 表示当前存储过程的子程序中包含写数据的SQL语句。</p>
<p>​        （5）<strong>默认情况下，系统会指定为CONTAINS SQL。</strong></p>
<p>​     <img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> SQL SECURITY { DEFINER | INVOKER } ：执行当前存储过程的权限，即指明哪些用户能够执行当前存储过程。</p>
<p>​        （1） DEFINER 表示只有当前存储过程的创建者或者定义者才能执行当前存储过程；</p>
<p>​        （2） INVOKER 表示拥有当前存储过程的访问权限的用户能够执行当前存储过程。</p>
<p>​        （3）如果没有设置相关的值，则MySQL默认指定值为DEFINER 。</p>
<p>​     <img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> COMMENT ‘string’ ：注释信息，可以用来描述存储过程。</p>
<p><em>*<em>*4*</em>*<em>、存储过程体中可以有多条*</em> *<em>SQL*</em> *<em>语句，如果仅仅一条*</em>*<em>SQL*</em> *<em>语句，则可以省略*</em> *<em>BEGIN*</em> *<em>和*</em> *<em>END*</em>*</em></p>
<p>编写存储过程并不是一件简单的事情，可能存储过程中需要复杂的 SQL 语句。</p>
<blockquote>
<p>\1. BEGIN …END ： BEGIN…END 中间包含了多个语句，每个语句都以（ ; ）号为结束符。</p>
<p>\2. DECLARE ： DECLARE 用来声明变量，使用的位置在于 BEGIN …END 语句中间，而且需要在其他语句使用之前进行变量的声明。</p>
<p>\3. SET ：赋值语句，用于对变量进行赋值。</p>
<p>\4. SELECT … INTO ：把从数据表中查询的结果存放到变量中，也就是为变量赋值。</p>
</blockquote>
<p><em>*<em>*5*</em>*<em>、需要设置新的结束标记*</em>*</em></p>
<blockquote>
<p>DELIMITER 新的结束标记</p>
</blockquote>
<p>​    因为MySQL 默认的语句结束符号为分号 ‘;’ 。为了避免与存储过程中 SQL 语句结束符相冲突，需要使用 DELIMITER改变存储过程的结束符。</p>
<p>​    比如：“DELIMITER &#x2F;&#x2F;” 语句的作用是将 MySQL 的结束符设置为 &#x2F;&#x2F; ，并以 “END &#x2F;&#x2F;” 结束存储过程。存储过程定 义完毕之后再使用“DELIMITER ;” 恢复默认结束符。 DELIMITER 也可以指定其他符号作为结束符。</p>
<p>​    当使用DELIMITER 命令时，应该避免使用反斜杠（‘\’）字符，因为反斜线是 MySQL 的转义字符。</p>
<p>示例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 存储过程名(<span class="keyword">IN</span><span class="operator">|</span><span class="keyword">OUT</span><span class="operator">|</span><span class="keyword">INOUT</span> 参数名 参数类型,...)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[characteristics ...]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">sql</span>语句<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">sql</span>语句<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER $</span><br></pre></td></tr></table></figure>

<p>​    <em>*<em>*如果你用的是 Navicat 工具，那么在编写存储过程的时候，*</em>*<em>Navicat*</em> *<em>会自动设置*</em> *<em>DELIMITER*</em> *<em>为其他符号，我们不需要再进行 DELIMITER*</em> *<em>的操作。*</em>*</em></p>
<h3 id="调用存储过程语法"><a href="#调用存储过程语法" class="headerlink" title="调用存储过程语法"></a>调用存储过程语法</h3><p>​    <strong>存储过程有多种调用方法。存储过程必须使用CALL</strong> <em>*<em>*语句调用，并且存储过程和数据库相关，如果要执行其他数据库中的存储过程，需要指定数据库名称，例如CALL dbname.procname*</em>*<em>。*</em>*</em></p>
<p><strong>语法：</strong></p>
<blockquote>
<p><em>*<em>*CALL*</em> *<em>存储过程名*</em>**(*</em>*<em>实参列表*</em>*<em>)*</em>**</p>
</blockquote>
<p><strong>格式：</strong></p>
<p>​     <em>*<em>*1*</em>*<em>、调用*</em>*<em>in*</em>*</em> <strong>模式的参数：</strong></p>
<blockquote>
<p>​     <em>*<em>*CALL*</em> *<em>sp1(*</em>**’*</em>*<em>值*</em>*<em>‘*</em>*<em>);*</em>**</p>
</blockquote>
<p>​    <em><strong>*或*</strong></em></p>
<blockquote>
<p>​    <em><strong>*SET @name :&#x3D; ‘值’； （:&#x3D; 为赋值符）*</strong></em></p>
<p>​    <em>*<em>*CALL*</em> *<em>sp1(*</em>**’*</em>*<em>值*</em>*<em>‘*</em>*<em>);*</em>**</p>
</blockquote>
<p>​    <strong>2、调用</strong> <em>*<em>*out*</em>*<em>模式的参数：*</em>*</em>     </p>
<blockquote>
<p>​    <em>*<em>*[ SET*</em> **@name*</em>*<em>; ]*</em>**</p>
<p>​    <em>*<em>*CALL*</em> *<em>sp1(*</em>**@name*</em>*<em>);*</em>**</p>
<p>​    <em>*<em>*SELECT*</em> **@name*</em>*<em>;*</em>**</p>
</blockquote>
<p>​    <strong>3、调用</strong> <em>*<em>*inout*</em>*<em>模式的参数：*</em>*</em></p>
<blockquote>
<p>​    <strong>SET</strong> <em>*<em>*@name*</em>**&#x3D;*</em>*<em>值*</em>*<em>;*</em>**</p>
<p>​    <em>*<em>*CALL*</em> *<em>sp1(*</em>**@name*</em>*<em>);*</em>**</p>
<p>​    <em>*<em>*SELECT*</em> **@name*</em>*<em>;*</em>**</p>
</blockquote>
<h3 id="代码举例"><a href="#代码举例" class="headerlink" title="代码举例"></a><strong>代码举例</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 准备工作</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE dbtest15;</span><br><span class="line">USE dbtest15;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emps </span><br><span class="line"><span class="keyword">As</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> atguigudb.employees ;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> depts</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigudb.departments;</span><br></pre></td></tr></table></figure>

<h4 id="举例-1-：创建存储过程-select-all-emps-，查看-emps-表的所有数据"><a href="#举例-1-：创建存储过程-select-all-emps-，查看-emps-表的所有数据" class="headerlink" title="**举例**1**：创建存储过程**select_all_emps()**，查看* *emps* *表的所有数据**"></a><em>*<em>*举例*</em>*<em>1*</em>*<em>：创建存储过程*</em>*<em>select_all_emps()*</em>*<em>，查看*</em> *<em>emps*</em> *<em>表的所有数据*</em>*</em></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 类型<span class="number">1</span>：无参的存储过程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 举例<span class="number">1</span>：创建存储过程select_all_emps()，查看 emps 表的所有数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> select_all_emps()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emps;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用存储过程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> select_all_emps();</span><br></pre></td></tr></table></figure>

<p>调用结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239251933.png" alt="img"></p>
<p><em>*<em>*举例*</em>*<em>2*</em>*<em>：创建存储过程*</em>*<em>avg_employee_salary()，返回emps中所有员工的平均工资*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># 举例<span class="number">2</span>：创建存储过程avg_employee_salary()，返回emps中所有员工的平均工资</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> avg_employee_salary()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">AS</span> avg_sal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">FROM</span> emps;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p>调用结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239251981.png" alt="img"></p>
<h4 id="举例3-：创建存储过程-show-max-salary-，用来查看-“emps”表的最高薪资值。"><a href="#举例3-：创建存储过程-show-max-salary-，用来查看-“emps”表的最高薪资值。" class="headerlink" title="**举例3**：创建存储过程**show_max_salary()**，用来查看**“emps”表的最高薪资值。**"></a><em>*<em>*举例3*</em>*<em>：创建存储过程*</em>*<em>show_max_salary()*</em>*<em>，用来查看*</em>*<em>“emps”表的最高薪资值。*</em>*</em></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 举例<span class="number">3</span>：创建存储过程show_max_salary()，用来查看“emps”表的最高薪资值。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> show_max_salary()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary) <span class="keyword">AS</span> max_sal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">FROM</span> emps;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> show_max_salary();</span><br></pre></td></tr></table></figure>

<p>调用结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239252041.png" alt="img"></p>
<h4 id="举例-4-：创建存储过程-show-min-salary-，查看-“emps”-表的最低薪资值。并将最低薪资通过-OUT-参数-“ms”-输出"><a href="#举例-4-：创建存储过程-show-min-salary-，查看-“emps”-表的最低薪资值。并将最低薪资通过-OUT-参数-“ms”-输出" class="headerlink" title="**举例**4**：创建存储过程**show_min_salary()**，查看**“emps”**表的最低薪资值。并将最低薪资通过**OUT**参数**“ms” 输出:**"></a><em>*<em>*举例*</em>*<em>4*</em>*<em>：创建存储过程*</em>*<em>show_min_salary()*</em>*<em>，查看*</em>*<em>“emps”*</em>*<em>表的最低薪资值。并将最低薪资通过*</em>*<em>OUT*</em>*<em>参数*</em>*<em>“ms” 输出:*</em>*</em></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># 类型<span class="number">2</span>：带有<span class="keyword">OUT</span>参数的存储过程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#举例<span class="number">4</span>：创建存储过程show_min_salary()，查看“emps”表的最低薪资值。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 并将最低薪资通过<span class="keyword">OUT</span>参数“ms” 输出:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> show_min_salary(<span class="keyword">OUT</span> ms <span class="keyword">DOUBLE</span>(<span class="number">8</span>,<span class="number">2</span>)) #注意这里ms数据类型要与emps中salary相同</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary) <span class="keyword">INTO</span> ms  #用<span class="keyword">INTO</span>将数据插入ms中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">FROM</span> emps;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用带有<span class="keyword">OUT</span>参数的存储过程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> show_min_salary(<span class="variable">@ms</span>) # <span class="variable">@ms</span> 为变量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看此变量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@ms</span>;</span><br></pre></td></tr></table></figure>

<p>查看结果为：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239262121.png" alt="img"></p>
<h4 id="举例-5-：创建存储过程-show-someone-salary-，查看-“emps”-表的某个员工的薪资，并用-IN-参数-empname输入员工姓名。"><a href="#举例-5-：创建存储过程-show-someone-salary-，查看-“emps”-表的某个员工的薪资，并用-IN-参数-empname输入员工姓名。" class="headerlink" title="**举例**5**：创建存储过程**show_someone_salary()**，查看**“emps”**表的某个员工的薪资，并用**IN**参数**empname输入员工姓名。**"></a><em>*<em>*举例*</em>*<em>5*</em>*<em>：创建存储过程*</em>*<em>show_someone_salary()*</em>*<em>，查看*</em>*<em>“emps”*</em>*<em>表的某个员工的薪资，并用*</em>*<em>IN*</em>*<em>参数*</em>*<em>empname输入员工姓名。*</em>*</em></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"># 类型<span class="number">3</span>：带有<span class="keyword">IN</span>参数的存储过程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 举例<span class="number">5</span>：创建存储过程show_someone_salary()，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看“emps”表的某个员工的薪资，并用<span class="keyword">IN</span>参数empname输入员工姓名。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#注empname数据类型要与emps中last_name的数据类型相同</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> show_someone_salary(<span class="keyword">IN</span> empname <span class="type">VARCHAR</span>(<span class="number">25</span>)) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">SELECT</span> last_name,salary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">FROM</span> emps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">WHERE</span> last_name <span class="operator">=</span> empname;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用带有<span class="keyword">IN</span>参数的存储过程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 方式<span class="number">1</span>：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@empname</span> <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span>; #给变量<span class="variable">@empname</span>赋值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> show_someone_salary(<span class="variable">@empname</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 方式<span class="number">2</span>：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> show_someone_salary(<span class="string">&#x27;Abel&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>调用结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239262217.png" alt="img"></p>
<h4 id="举例-6-：创建存储过程-show-someone-salary2-，查看-“emps”-表的某个员工的薪资，并用-IN-参数-empname输入员工姓名，用OUT-参数-empsalary-输出员工薪资。"><a href="#举例-6-：创建存储过程-show-someone-salary2-，查看-“emps”-表的某个员工的薪资，并用-IN-参数-empname输入员工姓名，用OUT-参数-empsalary-输出员工薪资。" class="headerlink" title="**举例**6**：创建存储过程**show_someone_salary2()**，查看**“emps”**表的某个员工的薪资，并用**IN**参数**empname输入员工姓名，用OUT**参数**empsalary**输出员工薪资。**"></a><em>*<em>*举例*</em>*<em>6*</em>*<em>：创建存储过程*</em>*<em>show_someone_salary2()*</em>*<em>，查看*</em>*<em>“emps”*</em>*<em>表的某个员工的薪资，并用*</em>*<em>IN*</em>*<em>参数*</em>*<em>empname输入员工姓名，用OUT*</em>*<em>参数*</em>*<em>empsalary*</em>*<em>输出员工薪资。*</em>*</em></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># 类型<span class="number">3</span>：带有 <span class="keyword">IN</span> 和 <span class="keyword">OUT</span> 的参数的存储过程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 举例<span class="number">6</span>：创建存储过程show_someone_salary2()，查看“emps”表的某个员工的薪资，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 并用<span class="keyword">IN</span>参数empname输入员工姓名，用<span class="keyword">OUT</span>参数empsalary输出员工薪资。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> show_someone_salary2(<span class="keyword">IN</span> empname <span class="type">VARCHAR</span>(<span class="number">25</span>),<span class="keyword">OUT</span> empsalary <span class="keyword">DOUBLE</span>(<span class="number">8</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">SELECT</span> salary <span class="keyword">INTO</span> empsalary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">FROM</span> emps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">WHERE</span> last_name <span class="operator">=</span> empname;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用带有 <span class="keyword">IN</span> 和 <span class="keyword">OUT</span> 的参数的存储过程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@empname</span> <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> show_someone_salary2(<span class="variable">@empname</span>,<span class="variable">@empsalary</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@empsalary</span>;</span><br></pre></td></tr></table></figure>

<p>查询结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239262297.png" alt="img"></p>
<h4 id="举例-7-：创建存储过程-show-mgr-name-，查询某个员工领导的姓名，并用-INOUT-参数-“empname”-输入员工姓名，输出领导的姓名。"><a href="#举例-7-：创建存储过程-show-mgr-name-，查询某个员工领导的姓名，并用-INOUT-参数-“empname”-输入员工姓名，输出领导的姓名。" class="headerlink" title="**举例**7**：创建存储过程**show_mgr_name()**，查询某个员工领导的姓名，并用**INOUT**参数**“empname”**输入员工姓名，输出领导的姓名。**"></a><em>*<em>*举例*</em>*<em>7*</em>*<em>：创建存储过程*</em>*<em>show_mgr_name()*</em>*<em>，查询某个员工领导的姓名，并用*</em>*<em>INOUT*</em>*<em>参数*</em>*<em>“empname”*</em>*<em>输入员工姓名，输出领导的姓名。*</em>*</em></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"># 类型<span class="number">4</span>：带有 <span class="keyword">INOUT</span> 的参数的存储过程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 举例<span class="number">7</span>：创建存储过程show_mgr_name()，查询某个员工领导的姓名，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 并用<span class="keyword">INOUT</span>参数“empname”输入员工姓名，输出领导的姓名。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> show_mgr_name(<span class="keyword">INOUT</span> empname <span class="type">VARCHAR</span>(<span class="number">25</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">SELECT</span> last_name <span class="keyword">INTO</span> empname</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">FROM</span> emps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> (</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">												<span class="keyword">SELECT</span> manager_id </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">												<span class="keyword">FROM</span> emps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">												<span class="keyword">WHERE</span> last_name <span class="operator">=</span> empname</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">												);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用 带有 <span class="keyword">INOUT</span> 的参数的存储过程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@empname</span> <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> show_mgr_name(<span class="variable">@empname</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@empname</span>;</span><br></pre></td></tr></table></figure>

<p>查询结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239262393.png" alt="img"></p>
<p>​    <em><strong>*如果你用的是 Navicat 工具，那么在编写存储过程的时候，Navicat 会自动设置 DELIMITER 为其他符号，我们不需要再进行 DELIMITER 的操作。*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"># 如果你用的是 Navicat 工具，那么在编写存储过程的时候，Navicat 会自动设置 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># DELIMITER 为其他符号，我们不需要再进行 DELIMITER 的操作。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> show_mgr_name2(<span class="keyword">INOUT</span> empname <span class="type">VARCHAR</span>(<span class="number">25</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">SELECT</span> last_name <span class="keyword">INTO</span> empname</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">FROM</span> emps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> (</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">												<span class="keyword">SELECT</span> manager_id </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">												<span class="keyword">FROM</span> emps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">												<span class="keyword">WHERE</span> last_name <span class="operator">=</span> empname</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">												);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 直接调用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@empname</span> <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> show_mgr_name(<span class="variable">@empname</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@empname</span>;</span><br></pre></td></tr></table></figure>

<p>查询结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239272467.png" alt="img"></p>
<h3 id="如何调试"><a href="#如何调试" class="headerlink" title="如何调试"></a><strong>如何调试</strong></h3><p>​    在 MySQL 中，存储过程不像普通的编程语言（比如 VC++ 、 Java 等）那样有专门的集成开发环境。因此，你可以通过 SELECT 语句，把程序执行的中间结果查询出来，来调试一个 SQL 语句的正确性。调试成功之后，把 SELECT 语句后移到下一个 SQL 语句之后，再调试下一个 SQL 语句。这样 逐步推进 ，就可以完成对存储过程中所有操作的调试了。当然，你也可以把存储过程中的 SQL 语句复制出来，逐段单独调试。</p>
<h2 id="存储函数的使用"><a href="#存储函数的使用" class="headerlink" title="存储函数的使用"></a><strong>存储函数的使用</strong></h2><p>​    前面学习了很多函数，使用这些函数可以对数据进行的各种处理操作，极大地提高用户对数据库的管理效率。MySQL支持自定义函数，定义好之后，调用方式与调用 MySQL 预定义的系统函数一样。</p>
<h3 id="创建存储函数的语法及其分析"><a href="#创建存储函数的语法及其分析" class="headerlink" title="创建存储函数的语法及其分析"></a><strong>创建存储函数的语法及其分析</strong></h3><p>​    学过的函数：LENGTH 、 SUBSTR 、 CONCAT 等</p>
<p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> 函数名(参数名 参数类型,...)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">RETURNS</span> 返回值类型</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[characteristics ...]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    函数体 #函数体中肯定有 <span class="keyword">RETURN</span> 语句</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p><strong>说明：</strong></p>
<p>​    <strong>1、参数列表：指定参数为</strong> <em>*<em>*IN*</em>*<em>、*</em>*<em>OUT*</em>*<em>或*</em>*<em>INOUT*</em>*<em>只对*</em>*<em>PROCEDURE*</em>*<em>是合法的，*</em>*<em>FUNCTION*</em>*<em>中总是默认为*</em>*<em>IN*</em>*<em>参数。*</em>*</em></p>
<p>​    <em>*<em>*2、*</em>*<em>RETURNS type*</em> *<em>语句表示函数返回数据的类型；*</em>*</em></p>
<p>​    <em>*<em>*RETURNS子句只能对*</em>*<em>FUNCTION*</em>*<em>做指定，对函数而言这是*</em> *<em>强制*</em> *<em>的。它用来指定函数的返回类型，而且函数体必须包含一个*</em> *<em>RETURN value*</em> *<em>语句。*</em>*</em></p>
<p>​    <em>*<em>*3、*</em>*<em>characteristic*</em> *<em>创建函数时指定的对函数的约束。取值与创建存储过程时相同，这里不再赘述。*</em>*</em></p>
<p>​    </p>
<p>​    <strong>注意：</strong></p>
<p>​        若在创建存储函数中报错“ you might want to use the less safe         log_bin_trust_function_creators variable ”，表示缺少部分的 <em><strong>*characteristic*</strong></em> （ 特征</p>
<p>​        值），有两种处理方法：</p>
<p>​            <strong>方式1：加上必要的函数特性</strong></p>
<blockquote>
<p>​            <strong>[NOT] DETERMINISTIC”和</strong></p>
<p>​            <strong>{CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQLDATA}</strong></p>
</blockquote>
<p>​            <strong>方式</strong> <em>*<em>*2*</em>*<em>：在创建存储函数前加声明：*</em>*</em></p>
<blockquote>
<p>​             <em>*<em>*SET GLOBAL*</em> *<em>log_bin_trust_function_creators &#x3D;*</em> *<em>1*</em>**;*</em>**</p>
</blockquote>
<p>​    <em>*<em>*4、函数体也可以用*</em>*<em>BEGIN…END*</em>*<em>来表示*</em>*<em>SQL*</em>*<em>代码的开始和结束。如果函数体只有一条语句，也可以省略BEGIN…END。*</em>*</em></p>
<h3 id="调用存储函数"><a href="#调用存储函数" class="headerlink" title="调用存储函数"></a><strong>调用存储函数</strong></h3><p>​    在MySQL 中，存储函数的使用方法与 MySQL 内部函数的使用方法是一样的。换言之，用户自己定义的存储函数与MySQL 内部函数是一个性质的。</p>
<p>​    区别在于，存储函数是 用户自己定义 的，而内部函数是 MySQL的 开发者定义 的.</p>
<p><em><strong>*语法格式：*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 函数名(实参列表);</span><br></pre></td></tr></table></figure>

<h3 id="代码举例-1"><a href="#代码举例-1" class="headerlink" title="代码举例"></a><strong>代码举例</strong></h3><h4 id="举例-1-：-创建存储函数，名称为email-by-name-，参数定义为空，该函数查询-Abel-的-email-，并返回，数据类型为字符串型。"><a href="#举例-1-：-创建存储函数，名称为email-by-name-，参数定义为空，该函数查询-Abel-的-email-，并返回，数据类型为字符串型。" class="headerlink" title="**举例**1**：* *创建存储函数，名称为email_by_name()**，参数定义为空，该函数查询**Abel**的**email**，并返回，数据类型为字符串型。**"></a><em>*<em>*举例*</em>*<em>1*</em>*<em>：*</em> *<em>创建存储函数，名称为email_by_name()*</em>*<em>，参数定义为空，该函数查询*</em>*<em>Abel*</em>*<em>的*</em>*<em>email*</em>*<em>，并返回，数据类型为字符串型。*</em>*</em></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2.</span>存储函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 举例<span class="number">1</span>：创建存储函数，名称为email_by_name()，参数定义为空，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#        该函数查询Abel的email，并返回，数据类型为字符串型。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> email_by_name()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	#设置特征值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">DETERMINISTIC</span> # 指明存储过程执行的结果为确定的</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">READS</span> <span class="keyword">SQL</span> DATA # 设置<span class="keyword">SQL</span>语句可读</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">RETURN</span> (<span class="keyword">SELECT</span> email</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">						<span class="keyword">FROM</span> emps</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">						<span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用存储函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> email_by_name();</span><br></pre></td></tr></table></figure>

<p>调用结果为：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239272639.png" alt="img"></p>
<h4 id="举例2：-创建存储函数，名称为email-by-id-，参数传入emp-id，该函数查询emp-id的email，并返回，数据类型为字符串型。"><a href="#举例2：-创建存储函数，名称为email-by-id-，参数传入emp-id，该函数查询emp-id的email，并返回，数据类型为字符串型。" class="headerlink" title="举例2： 创建存储函数，名称为email_by_id()，参数传入emp_id，该函数查询emp_id的email，并返回，数据类型为字符串型。"></a><strong>举例<strong><strong>2</strong></strong>：</strong> 创建存储函数，名称为email_by_id()，参数传入emp_id，该函数查询emp_id的email，并返回，数据类型为字符串型。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"># 举例<span class="number">2</span>：创建存储函数，名称为email_by_id()，参数传入emp_id，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#				 该函数查询emp_id的email，并返回，数据类型为字符串型。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 在创建函数前声明：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> log_bin_trust_function_creators <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> email_by_id(emp_id <span class="type">INT</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">RETURN</span> (<span class="keyword">SELECT</span> email <span class="keyword">FROM</span> emps <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> emp_id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 方式<span class="number">1</span>：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> email_by_id(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 方式<span class="number">2</span>：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@emp</span>_id <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> email_by_id(<span class="variable">@emp</span>_id)</span><br></pre></td></tr></table></figure>

<p>调用结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239272739.png" alt="img"></p>
<h4 id="举例3：-创建存储函数count-by-id-，参数传入dept-id，该函数查询dept-id部门的员工人数，并返回，数据类型为整型。"><a href="#举例3：-创建存储函数count-by-id-，参数传入dept-id，该函数查询dept-id部门的员工人数，并返回，数据类型为整型。" class="headerlink" title="举例3： 创建存储函数count_by_id()，参数传入dept_id，该函数查询dept_id部门的员工人数，并返回，数据类型为整型。"></a><strong>举例<strong><strong>3</strong></strong>：</strong> 创建存储函数count_by_id()，参数传入dept_id，该函数查询dept_id部门的员工人数，并返回，数据类型为整型。</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"># 举例<span class="number">3</span>：创建存储函数count_by_id()，参数传入dept_id，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#				 该函数查询dept_id部门的员工人数，并返回，数据类型为整型。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> count_by_id(dept_id <span class="type">INT</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">INT</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">RETURN</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> emps <span class="keyword">WHERE</span> department_id <span class="operator">=</span> dept_id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> count_by_id(<span class="number">90</span>);</span><br></pre></td></tr></table></figure>

<p>调用结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239282803.png" alt="img"></p>
<h3 id="对比存储函数和存储过程"><a href="#对比存储函数和存储过程" class="headerlink" title="对比存储函数和存储过程"></a><strong>对比存储函数和存储过程</strong></h3><blockquote>
<table>
<thead>
<tr>
<th></th>
<th><em><strong>*关键字*</strong></em></th>
<th><em><strong>*调用语法*</strong></em></th>
<th><em><strong>*返回值*</strong></em></th>
<th><em><strong>*应用场景*</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em><strong>*存储过程*</strong></em></td>
<td><em><strong>*PROCEDURE*</strong></em></td>
<td><em>*<em>*CALL*</em> *<em>存储过程*</em>**()*</em>**</td>
<td><em>*<em>*理解为有*</em>*<em>0*</em>*<em>个或多个*</em>*</em></td>
<td><em><strong>*一般用于更新*</strong></em></td>
</tr>
<tr>
<td><em><strong>*存储函数*</strong></em></td>
<td><em><strong>*FUNCTION*</strong></em></td>
<td><em>*<em>*SELECT*</em> *<em>函数*</em>**()*</em>**</td>
<td><em><strong>*只能是一个*</strong></em></td>
<td><em><strong>*一般用于查询结果为一个值并返回值*</strong></em></td>
</tr>
</tbody></table>
</blockquote>
<p>​    此外， <strong>存储函数可以放在查询语句中使用，存储过程不行</strong> 。反之，存储过程的功能更加强大，包括能够执行对表的操作（比如创建表，删除表等）和事务操作，这些功能是存储函数不具备的。</p>
<h2 id="存储过程和函数的查看、修改、删除"><a href="#存储过程和函数的查看、修改、删除" class="headerlink" title="存储过程和函数的查看、修改、删除"></a><strong>存储过程和函数的查看、修改、删除</strong></h2><h3 id="查看"><a href="#查看" class="headerlink" title="查看"></a><strong>查看</strong></h3><p>创建完之后，怎么知道我们创建的存储过程、存储函数是否成功了呢？</p>
<p>​    MySQL存储了存储过程和函数的状态信息，用户可以使用 SHOW STATUS 语句或 SHOW CREATE 语句来查看，也可直接从系统的information_schema 数据库中查询。这里介绍 3 种方法。</p>
<h4 id="使用SHOW-CREATE语句查看存储过程和函数的创建信息"><a href="#使用SHOW-CREATE语句查看存储过程和函数的创建信息" class="headerlink" title="使用SHOW CREATE语句查看存储过程和函数的创建信息"></a><strong>使用SHOW CREATE语句查看存储过程和函数的创建信息</strong></h4><p><em><strong>*语法结构：*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; 存储过程名或函数名</span><br></pre></td></tr></table></figure>

<p>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 存储过程、函数的查看</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 方式<span class="number">1</span>：使用<span class="keyword">SHOW</span> <span class="keyword">CREATE</span> 语句查看存储过程和函数的创建信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> show_max_salary\G</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239282846.png" alt="img"></p>
<h4 id="使用SHOW-STATUS语句查看存储过程和函数的状态信息"><a href="#使用SHOW-STATUS语句查看存储过程和函数的状态信息" class="headerlink" title="使用SHOW STATUS语句查看存储过程和函数的状态信息"></a><strong>使用SHOW STATUS语句查看存储过程和函数的状态信息</strong></h4><p>语法结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; STATUS [<span class="keyword">LIKE</span> <span class="string">&#x27;pattern&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>​    这个语句返回子程序的特征，如数据库、名字、类型、创建者及创建和修改日期。</p>
<p>​    [LIKE ‘pattern’]：匹配存储过程或函数的名称，可以省略。当省略不写时，会列出MySQL数据库中存在的 所有存储过程或函数的信息。</p>
<p>举例1：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 方式<span class="number">2</span>：使用<span class="keyword">SHOW</span> STATUS语句查看存储过程和函数的状态信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FUNCTION</span> STATUS;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239282874.png" alt="img"></p>
<p> 举例2：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239292878.png" alt="img"></p>
<h4 id="从information-schema-Routines表中查看存储过程和函数的信息"><a href="#从information-schema-Routines表中查看存储过程和函数的信息" class="headerlink" title="从information_schema.Routines表中查看存储过程和函数的信息"></a><strong>从information_schema.Routines表中查看存储过程和函数的信息</strong></h4><p>​     MySQL 中存储过程和函数的信息存储在 information_schema 数据库下的 Routines 表中。可以通过查询该表 的记录来查询存储过程和函数的信息。</p>
<p><strong>语法格式：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.Routines </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> ROUTINE_NAME<span class="operator">=</span><span class="string">&#x27;存储过程或函数的名&#x27;</span> [<span class="keyword">AND</span> ROUTINE_TYPE <span class="operator">=</span> &#123;<span class="string">&#x27;PROCEDURE|FUNCTION&#x27;</span>&#125;];</span><br></pre></td></tr></table></figure>

<p>说明：如果在 MySQL 数据库中存在存储过程和函数名称相同的情况，最好指定 ROUTINE_TYPE 查询条件来指明查询的是存储过程还是函数。</p>
<p>举例：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239292898.png" alt="img"></p>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a><strong>修改</strong></h3><p>​    修改存储过程或函数，不影响存储过程或函数功能，只是修改相关特性。使用ALTER 语句实现。</p>
<p><em><strong>*语法格式：*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; 存储过程或函数的名 [characteristic ...]</span><br></pre></td></tr></table></figure>

<p>​    其中，characteristic 指定存储过程或函数的特性，其取值信息与创建存储过程、函数时的取值信息略有不同。</p>
<blockquote>
<p><em>*<em>*{*</em> *<em>CONTAINS SQL*</em> **|*</em> *<em>NO SQL*</em> *<em>|*</em> *<em>READS SQL DATA*</em> *<em>|*</em> *<em>MODIFIES SQL DATA*</em> *<em>}*</em>**</p>
<p><em>*<em>*|*</em> *<em>SQL SECURITY*</em> **{ DEFINER |*</em> *<em>INVOKER*</em> *<em>}*</em>**</p>
<p><em>*<em>*|*</em> *<em>COMMENT*</em> **’string*</em>**</p>
</blockquote>
<p>​    <em>*<em>*<img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> CONTAINS SQL*</em> *<em>，表示子程序包含*</em>*<em>SQL*</em>*<em>语句，但不包含读或写数据的语句。*</em>*</em></p>
<p>​    <em>*<em>*<img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> NO SQL*</em> *<em>，表示子程序中不包含*</em>*<em>SQL*</em>*<em>语句。*</em>*</em></p>
<p>​    <em><strong>*<img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> READS SQL DATA** **，表示子程序中包含读数据的语句。*</strong></em></p>
<p>​    <em><strong>*<img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> MODIFIES SQL DATA** **，表示子程序中包含写数据的语句。*</strong></em></p>
<p>​    <em><strong>*<img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> SQL SECURITY { DEFINER | INVOKER }** **，指明谁有权限来执行。*</strong></em> </p>
<p>​        <em><strong>*<img src="https://latex.codecogs.com/gif.latex?%5Ccirc" alt="\circ">** *<em>DEFINER*</em> **，表示只有定义者自己才能够执行。*</strong></em> </p>
<p>​        <em><strong>*<img src="https://latex.codecogs.com/gif.latex?%5Ccirc" alt="\circ">** *<em>INVOKER*</em> **，表示调用者可以执行。*</strong></em></p>
<p>​    <em><strong>*<img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> COMMENT ‘string’** **，表示注释信息。*</strong></em></p>
<p>​    修改存储过程使用ALTER PROCEDURE 语句，修改存储函数使用 ALTER FUNCTION 语句。但是，这两个语句的结构是一样的，语句中的所有参数也是一样的。</p>
<p>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 存储过程、函数的修改</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">FUNCTION</span> email_by_id </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">COMMENT <span class="string">&#x27;输入员工id查看其emial&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FUNCTION</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;email_by_id&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239292964.png" alt="img"></p>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a><strong>删除</strong></h3><p>​    删除存储过程和函数，可以使用DROP 语句</p>
<p><em><strong>*语法结构：*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> &#123;<span class="keyword">PROCEDURE</span> <span class="operator">|</span> <span class="keyword">FUNCTION</span>&#125; [IF <span class="keyword">EXISTS</span>] 存储过程或函数的名</span><br></pre></td></tr></table></figure>

<p>​    IF EXISTS：如果程序或函数不存储，它可以防止发生错误，产生一个用 SHOW WARNINGS 查看的警告。</p>
<p>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 存储过程、函数的删除</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> show_max_salary;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> STATUS;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239302990.png" alt="img"></p>
<h2 id="关于存储过程使用的争议"><a href="#关于存储过程使用的争议" class="headerlink" title="关于存储过程使用的争议"></a><strong>关于存储过程使用的争议</strong></h2><p>​    尽管存储过程有诸多优点，但是对于存储过程的使用， <strong>一直都存在着很多争议</strong> ，比如有些公司对于大型项目要求使用存储过程，而有些公司在手册中明确禁止使用存储过程，为什么这些公司对存储过程的使用需求差别这么大呢？</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a><strong>优点</strong></h3><p>​    <strong>1、存储过程可以一次编译多次使用。</strong> 存储过程只在创建时进行编译，之后的使用都不需要重新编译，这就提升了 SQL 的执行效率。</p>
<p>​    <strong>2、可以减少开发工作量。</strong> 将代码 封装 成模块，实际上是编程的核心思想之一，这样可以把复杂的问题拆解成不同的模块，然后模块之间可以 重复使用 ，在减少开发工作量的同时，还能保证代码的结构清晰。</p>
<p>​    <strong>3、存储过程的安全性强。</strong> 我们在设定存储过程的时候可以 设置对用户的使用权限 ，这样就和视图一样具有较强的安全性。</p>
<p>​    <strong>4、可以减少网络传输量。</strong> 因为代码封装到存储过程中，每次使用只需要调用存储过程即可，这样就减少了网络传输量。</p>
<p>​    <strong>5、良好的封装性。</strong> 在进行相对复杂的数据库操作时，原本需要使用一条一条的 SQL 语句，可能要连接多次数据库才能完成的操作，现在变成了一次存储过程，只需要 连接一次即可 。</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a><strong>缺点</strong></h3><p>​    基于上面这些优点，不少大公司都要求大型项目使用存储过程，比如微软、IBM 等公司。但是国内的阿里并不推荐开发人员使用存储过程，这是为什么呢？</p>
<blockquote>
<p><strong>阿里开发规范</strong></p>
<p>【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。</p>
</blockquote>
<p>存储过程虽然有诸如上面的好处，但缺点也是很明显的。</p>
<p>​    <strong>1、可移植性差。</strong> 存储过程不能跨数据库移植，比如在 MySQL 、 Oracle 和 SQL Server 里编写的存储过程，在换成其他数据库时都需要重新编写。</p>
<p>​    <strong>2、调试困难。</strong> 只有少数 DBMS 支持存储过程的调试。对于复杂的存储过程来说，开发和维护都不容易。虽然也有一些第三方工具可以对存储过程进行调试，但要收费。</p>
<p>​    <strong>3、存储过程的版本管理很困难。</strong> 比如数据表索引发生变化了，可能会导致存储过程失效。我们在开发软件的时候往往需要进行版本管理，但是存储过程本身没有版本控制，版本迭代更新的时候很麻烦。</p>
<p>​    <strong>4、它不适合高并发的场景。</strong> 高并发的场景需要减少数据库的压力，有时数据库会采用分库分表的方式，而且对可扩展性要求很高，在这种情况下，存储过程会变得难以维护， 增加数据库的压力 ，显然就不适用了。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>​    <strong>存储过程既方便，又有局限性。尽管不同的公司对存储过程的态度不一，但是对于我们开发人员来说，不论怎样，掌握存储过程都是必备的技能之一。</strong></p>
<h2 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h2><h3 id="存储过程练习"><a href="#存储过程练习" class="headerlink" title="存储过程练习"></a><strong>存储过程练习</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 存储过程练习</span><br><span class="line">#<span class="number">0.</span>准备工作</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE test15_pro_func;</span><br><span class="line">USE test15_pro_func;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> admin(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">user_name <span class="type">VARCHAR</span>(<span class="number">15</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">pwd <span class="type">VARCHAR</span>(<span class="number">25</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> beauty(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">15</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">phone <span class="type">VARCHAR</span>(<span class="number">15</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">birth <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty(NAME,phone,birth)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;朱茵&#x27;</span>,<span class="string">&#x27;13201233453&#x27;</span>,<span class="string">&#x27;1982-02-12&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;孙燕姿&#x27;</span>,<span class="string">&#x27;13501233653&#x27;</span>,<span class="string">&#x27;1980-12-09&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;田馥甄&#x27;</span>,<span class="string">&#x27;13651238755&#x27;</span>,<span class="string">&#x27;1983-08-21&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;邓紫棋&#x27;</span>,<span class="string">&#x27;17843283452&#x27;</span>,<span class="string">&#x27;1991-11-12&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;刘若英&#x27;</span>,<span class="string">&#x27;18635575464&#x27;</span>,<span class="string">&#x27;1989-05-18&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;杨超越&#x27;</span>,<span class="string">&#x27;13761238755&#x27;</span>,<span class="string">&#x27;1994-05-11&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> beauty;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239303065.png" alt="img"></p>
<h4 id="创建存储过程insert-user-实现传入用户名和密码，插入到admin表中"><a href="#创建存储过程insert-user-实现传入用户名和密码，插入到admin表中" class="headerlink" title="创建存储过程insert_user(),实现传入用户名和密码，插入到admin表中"></a>创建存储过程insert_user(),实现传入用户名和密码，插入到admin表中</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> 创建存储过程insert_user(),实现传入用户名和密码，插入到admin表中</span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_user(<span class="keyword">IN</span> username <span class="type">VARCHAR</span>(<span class="number">15</span>),<span class="keyword">IN</span> password <span class="type">VARCHAR</span>(<span class="number">25</span>))</span><br><span class="line">	<span class="keyword">BEGIN</span> </span><br><span class="line"></span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> admin(user_name,pwd)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">VALUES</span>(username,password);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>



<h4 id="创建存储过程get-phone-实现传入女神编号，返回女神姓名和女神电话"><a href="#创建存储过程get-phone-实现传入女神编号，返回女神姓名和女神电话" class="headerlink" title="创建存储过程get_phone(),实现传入女神编号，返回女神姓名和女神电话"></a>创建存储过程get_phone(),实现传入女神编号，返回女神姓名和女神电话</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">2.</span> 创建存储过程get_phone(),实现传入女神编号，返回女神姓名和女神电话</span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_phone(<span class="keyword">IN</span> id <span class="type">INT</span>,<span class="keyword">OUT</span> name <span class="type">VARCHAR</span>(<span class="number">15</span>),<span class="keyword">OUT</span> phone <span class="type">VARCHAR</span>(<span class="number">15</span>))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">SELECT</span> b.name,b.phone <span class="keyword">INTO</span> name,phone</span><br><span class="line"></span><br><span class="line">		<span class="keyword">FROM</span> beauty b</span><br><span class="line"></span><br><span class="line">		<span class="keyword">WHERE</span> b.id <span class="operator">=</span> id;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"># 调用</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@id</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line"><span class="keyword">CALL</span> get_phone(<span class="variable">@id</span>,<span class="variable">@name</span>,<span class="variable">@phone</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@name</span>,<span class="variable">@phone</span>;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239303115.png" alt="img"></p>
<h4 id="创建存储过程date-diff-，实现传入两个女神生日，返回日期间隔大小"><a href="#创建存储过程date-diff-，实现传入两个女神生日，返回日期间隔大小" class="headerlink" title="创建存储过程date_diff()，实现传入两个女神生日，返回日期间隔大小"></a>创建存储过程date_diff()，实现传入两个女神生日，返回日期间隔大小</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">3.</span> 创建存储过程date_diff()，实现传入两个女神生日，返回日期间隔大小 </span><br><span class="line"></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> date_diff(<span class="keyword">IN</span> birth1 <span class="type">DATE</span>,<span class="keyword">IN</span> birth2 <span class="type">DATE</span>,<span class="keyword">OUT</span> <span class="keyword">result</span> <span class="type">INT</span>)</span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">SELECT</span> DATEDIFF(birth1,birth2) <span class="keyword">INTO</span> <span class="keyword">result</span>;</span><br><span class="line">	<span class="keyword">END</span> $ </span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line">#调用 </span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@birth1</span> <span class="operator">=</span> <span class="string">&#x27;1992-09-08&#x27;</span>; </span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@birth2</span> <span class="operator">=</span> <span class="string">&#x27;1989-01-03&#x27;</span>; </span><br><span class="line"><span class="keyword">CALL</span> date_diff(<span class="variable">@birth1</span>,<span class="variable">@birth2</span>,<span class="variable">@result</span>); </span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@result</span>;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239313139.png" alt="img"></p>
<h4 id="创建存储过程format-date-实现传入一个日期，格式化成xx年xx月xx日并"><a href="#创建存储过程format-date-实现传入一个日期，格式化成xx年xx月xx日并" class="headerlink" title="创建存储过程format_date(),实现传入一个日期，格式化成xx年xx月xx日并"></a>创建存储过程format_date(),实现传入一个日期，格式化成xx年xx月xx日并</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">4.</span> 创建存储过程format_date(),实现传入一个日期，格式化成xx年xx月xx日并 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> format_date(<span class="keyword">IN</span> mydate <span class="type">DATE</span>)</span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">SELECT</span> DATE_FORMAT(mydate,<span class="string">&#x27;%y年%m月%d&#x27;</span>);</span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"># 调用</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@mydate</span> <span class="operator">=</span> <span class="string">&#x27;1992-09-08&#x27;</span>;</span><br><span class="line"><span class="keyword">CALL</span> format_date(<span class="variable">@mydate</span>);</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239313163.png" alt="img"></p>
<h4 id="创建存储过程beauty-limit-，根据传入的起始索引和条目数，查询女神表的记录"><a href="#创建存储过程beauty-limit-，根据传入的起始索引和条目数，查询女神表的记录" class="headerlink" title="创建存储过程beauty_limit()，根据传入的起始索引和条目数，查询女神表的记录"></a>创建存储过程beauty_limit()，根据传入的起始索引和条目数，查询女神表的记录</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">5.</span> 创建存储过程beauty_limit()，根据传入的起始索引和条目数，查询女神表的记录 </span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> beauty_limit(<span class="keyword">IN</span> <span class="keyword">first</span> <span class="type">INT</span>,<span class="keyword">IN</span> num <span class="type">INT</span>)</span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line">		<span class="keyword">FROM</span> beauty</span><br><span class="line">		LIMIT <span class="keyword">first</span>,num;</span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">CALL</span> beauty_limit(<span class="number">1</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239313182.png" alt="img"></p>
<h4 id="传入a和b两个值，最终a和b都翻倍并返回"><a href="#传入a和b两个值，最终a和b都翻倍并返回" class="headerlink" title="传入a和b两个值，最终a和b都翻倍并返回"></a>传入a和b两个值，最终a和b都翻倍并返回</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">6.</span> 传入a和b两个值，最终a和b都翻倍并返回 </span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> add_INT(<span class="keyword">INOUT</span> a <span class="type">INT</span>,<span class="keyword">INOUT</span> b <span class="type">INT</span>)</span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">SET</span> a <span class="operator">=</span> a <span class="operator">*</span> <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">SET</span> b <span class="operator">=</span> b <span class="operator">*</span> <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@a</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@b</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line"><span class="keyword">CALL</span> add_INT(<span class="variable">@a</span>,<span class="variable">@b</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@a</span>,<span class="variable">@b</span> ;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239313202.png" alt="img"></p>
<h4 id="删除题目5的存储过程"><a href="#删除题目5的存储过程" class="headerlink" title="删除题目5的存储过程"></a>删除题目5的存储过程</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">7.</span> 删除题目<span class="number">5</span>的存储过程 </span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> beauty_limit;</span><br></pre></td></tr></table></figure>

<h4 id="查看题目6中存储过程的信息"><a href="#查看题目6中存储过程的信息" class="headerlink" title="查看题目6中存储过程的信息"></a>查看题目6中存储过程的信息</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">8.</span> 查看题目<span class="number">6</span>中存储过程的信息</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> add_INT;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;add_INT&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="存储函数练习"><a href="#存储函数练习" class="headerlink" title="存储函数练习"></a><strong>存储函数练习</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 存储函数练习</span><br><span class="line">#<span class="number">0.</span> 准备工作</span><br><span class="line">USE test15_pro_func;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emps</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigudb.`employees`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> depts</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigudb.`departments`;</span><br></pre></td></tr></table></figure>

<h4 id="创建函数get-count-返回公司的员工个数"><a href="#创建函数get-count-返回公司的员工个数" class="headerlink" title="创建函数get_count(),返回公司的员工个数"></a>创建函数get_count(),返回公司的员工个数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> 创建函数get_count(),返回公司的员工个数</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> log_bin_trust_function_creators <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> get_count()</span><br><span class="line"></span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">INT</span></span><br><span class="line">	<span class="keyword">BEGIN</span> </span><br><span class="line">		<span class="keyword">RETURN</span>(<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> emps);</span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">SELECT</span> get_count();</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239313253.png" alt="img"></p>
<h4 id="创建函数ename-salary-根据员工姓名，返回它的工资"><a href="#创建函数ename-salary-根据员工姓名，返回它的工资" class="headerlink" title="创建函数ename_salary(),根据员工姓名，返回它的工资"></a>创建函数ename_salary(),根据员工姓名，返回它的工资</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">2.</span> 创建函数ename_salary(),根据员工姓名，返回它的工资</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> ename_salary(ename <span class="type">VARCHAR</span>(<span class="number">25</span>))</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="keyword">DOUBLE</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">RETURN</span>(<span class="keyword">SELECT</span> salary <span class="keyword">FROM</span> emps <span class="keyword">WHERE</span> last_name <span class="operator">=</span> ename);</span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">SELECT</span> ename_salary(<span class="string">&#x27;Abel&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>​    <img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239313272.png" alt="img"></p>
<h4 id="创建函数dept-sal-根据部门名，返回该部门的平均工资"><a href="#创建函数dept-sal-根据部门名，返回该部门的平均工资" class="headerlink" title="创建函数dept_sal() ,根据部门名，返回该部门的平均工资"></a>创建函数dept_sal() ,根据部门名，返回该部门的平均工资</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">3.</span> 创建函数dept_sal() ,根据部门名，返回该部门的平均工资</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> dept_sal(depid <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="keyword">DOUBLE</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">RETURN</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">FROM</span> emps <span class="keyword">WHERE</span> department_id <span class="operator">=</span> depid);</span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">SELECT</span> dept_sal(<span class="number">50</span>);</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239323294.png" alt="img"></p>
<h4 id="创建函数add-float-，实现传入两个float，返回二者之和"><a href="#创建函数add-float-，实现传入两个float，返回二者之和" class="headerlink" title="创建函数add_float()，实现传入两个float，返回二者之和"></a>创建函数add_float()，实现传入两个float，返回二者之和</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">4.</span> 创建函数add_float()，实现传入两个<span class="type">float</span>，返回二者之和</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> add_float(float1 <span class="type">FLOAT</span>,float2 <span class="type">FLOAT</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">FLOAT</span></span><br><span class="line">	<span class="keyword">BEGIN</span></span><br><span class="line">		<span class="keyword">RETURN</span>(<span class="keyword">SELECT</span> float1 <span class="operator">+</span> float2);</span><br><span class="line">	<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">SELECT</span> add_float(<span class="number">5.2</span>,<span class="number">6.9</span>);</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239323315.png" alt="img"></p>
<h1 id="MySQL-变量、流程控制与游标练习"><a href="#MySQL-变量、流程控制与游标练习" class="headerlink" title="MySQL 变量、流程控制与游标练习"></a>MySQL 变量、流程控制与游标练习</h1><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a><strong>变量</strong></h2><p>准备工作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">0.</span>准备工作</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE test16_var_cur;</span><br><span class="line"></span><br><span class="line">use test16_var_cur;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employees</span><br><span class="line"></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigudb.`employees`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> departments</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigudb.`departments`;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> log_bin_trust_function_creators <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="创建函数get-count-返回公司的员工个数-1"><a href="#创建函数get-count-返回公司的员工个数-1" class="headerlink" title="创建函数get_count(),返回公司的员工个数"></a>创建函数get_count(),返回公司的员工个数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#无参有返回</span><br><span class="line"></span><br><span class="line">#<span class="number">1.</span> 创建函数get_count(),返回公司的员工个数</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> get_count()</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">INT</span></span><br><span class="line">		<span class="keyword">BEGIN</span></span><br><span class="line">			# 声明局部变量</span><br><span class="line">			<span class="keyword">DECLARE</span> emp_count <span class="type">INT</span>;</span><br><span class="line">			<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> emp_count</span><br><span class="line">			<span class="keyword">FROM</span> employees；</span><br><span class="line">			<span class="keyword">RETURN</span> emp_count;</span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">SELECT</span> get_count(); #<span class="number">107</span></span><br></pre></td></tr></table></figure>

<h3 id="创建函数ename-salary-根据员工姓名，返回它的工资-1"><a href="#创建函数ename-salary-根据员工姓名，返回它的工资-1" class="headerlink" title="创建函数ename_salary(),根据员工姓名，返回它的工资"></a>创建函数ename_salary(),根据员工姓名，返回它的工资</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#有参有返回</span><br><span class="line">#<span class="number">2.</span> 创建函数ename_salary(),根据员工姓名，返回它的工资</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> ename_salary(emp_name <span class="type">VARCHAR</span>(<span class="number">25</span>))</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="keyword">DOUBLE</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">		<span class="keyword">BEGIN</span></span><br><span class="line">			# 声明局部变量</span><br><span class="line">			<span class="keyword">DECLARE</span> emp_sal <span class="keyword">DOUBLE</span>(<span class="number">8</span>,<span class="number">2</span>);</span><br><span class="line">			<span class="keyword">SELECT</span> salary <span class="keyword">INTO</span> emp_sal</span><br><span class="line">			<span class="keyword">FROM</span> employees</span><br><span class="line">			<span class="keyword">WHERE</span> last_name <span class="operator">=</span> emp_name;</span><br><span class="line">			<span class="keyword">RETURN</span> emp_sal;</span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">SELECT</span> ename_salary(<span class="string">&#x27;Abel&#x27;</span>); #<span class="number">12000.00</span></span><br></pre></td></tr></table></figure>

<h3 id="创建函数dept-sal-根据部门名，返回该部门的平均工资-1"><a href="#创建函数dept-sal-根据部门名，返回该部门的平均工资-1" class="headerlink" title="创建函数dept_sal() ,根据部门名，返回该部门的平均工资"></a>创建函数dept_sal() ,根据部门名，返回该部门的平均工资</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">3.</span> 创建函数dept_sal() ,根据部门名，返回该部门的平均工资</span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> dept_sal(dept_name <span class="type">VARCHAR</span>(<span class="number">30</span>))</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="keyword">DOUBLE</span></span><br><span class="line">		<span class="keyword">BEGIN</span> </span><br><span class="line">				<span class="keyword">DECLARE</span> dept_sal <span class="keyword">DOUBLE</span>;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">INTO</span> dept_sal</span><br><span class="line">				<span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line">				<span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line">				<span class="keyword">WHERE</span> department_name <span class="operator">=</span> dept_name;</span><br><span class="line">				<span class="keyword">RETURN</span> dept_sal;</span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">SELECT</span> dept_sal(<span class="string">&#x27;IT&#x27;</span>); #<span class="number">5760</span></span><br></pre></td></tr></table></figure>

<h3 id="创建函数add-float-，实现传入两个float，返回二者之和-1"><a href="#创建函数add-float-，实现传入两个float，返回二者之和-1" class="headerlink" title="创建函数add_float()，实现传入两个float，返回二者之和"></a>创建函数add_float()，实现传入两个float，返回二者之和</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">4.</span> 创建函数add_float()，实现传入两个<span class="type">float</span>，返回二者之和</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> add_float(f1 <span class="type">FLOAT</span>,f2 <span class="type">FLOAT</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">FLOAT</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">BEGIN</span></span><br><span class="line">				<span class="keyword">DECLARE</span> sum <span class="type">FLOAT</span>;</span><br><span class="line">				<span class="keyword">SET</span> sum <span class="operator">=</span> f1 <span class="operator">+</span> f2;</span><br><span class="line">				<span class="keyword">RETURN</span> sum;</span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@f1</span> <span class="operator">=</span> <span class="number">12.25</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@f2</span> <span class="operator">=</span> <span class="number">36.55</span>;</span><br><span class="line"><span class="keyword">SELECT</span> add_float(<span class="variable">@f1</span>,<span class="variable">@f2</span>); #<span class="number">48.8</span></span><br></pre></td></tr></table></figure>

<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a><strong>流程控制</strong></h2><h3 id="创建函数test-if-case-，实现传入成绩，如果成绩-gt-90-返回A，如果成绩-gt-80-返回B，如果成绩-gt-60-返回-C，否则返回D-要求：分别使用if结构和case结构实现"><a href="#创建函数test-if-case-，实现传入成绩，如果成绩-gt-90-返回A，如果成绩-gt-80-返回B，如果成绩-gt-60-返回-C，否则返回D-要求：分别使用if结构和case结构实现" class="headerlink" title="创建函数test_if_case()，实现传入成绩，如果成绩&gt;90,返回A，如果成绩&gt;80,返回B，如果成绩&gt;60,返回 C，否则返回D ,要求：分别使用if结构和case结构实现"></a>创建函数test_if_case()，实现传入成绩，如果成绩&gt;90,返回A，如果成绩&gt;80,返回B，如果成绩&gt;60,返回 C，否则返回D ,要求：分别使用if结构和case结构实现</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> 创建函数test_if_case()，实现传入成绩，</span><br><span class="line">#		如果成绩<span class="operator">&gt;</span><span class="number">90</span>,返回A，如果成绩<span class="operator">&gt;</span><span class="number">80</span>,返回B，如果成绩<span class="operator">&gt;</span><span class="number">60</span>,返回C，否则返回D</span><br><span class="line"></span><br><span class="line">#		要求：分别使用if结构和<span class="keyword">case</span>结构实现</span><br><span class="line"># 方式<span class="number">1</span>：使用if结构实现</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> test_if(score <span class="type">INT</span> )</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">CHAR</span></span><br><span class="line">		<span class="keyword">BEGIN</span></span><br><span class="line">				<span class="keyword">DECLARE</span> grade <span class="type">CHAR</span>;</span><br><span class="line">				IF score <span class="operator">&gt;</span> <span class="number">90</span></span><br><span class="line">						<span class="keyword">THEN</span> <span class="keyword">SET</span> grade <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">				ELSEIF score <span class="operator">&gt;</span> <span class="number">80</span> </span><br><span class="line">						<span class="keyword">THEN</span> <span class="keyword">SET</span> grade <span class="operator">=</span> <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">				ELSEIF score <span class="operator">&gt;</span> <span class="number">60</span></span><br><span class="line">						<span class="keyword">THEN</span> <span class="keyword">SET</span> grade <span class="operator">=</span> <span class="string">&#x27;C&#x27;</span>;</span><br><span class="line">				<span class="keyword">ELSE</span></span><br><span class="line">						<span class="keyword">SET</span> grade <span class="operator">=</span> <span class="string">&#x27;D&#x27;</span>;</span><br><span class="line">				<span class="keyword">END</span> IF;</span><br><span class="line">				<span class="keyword">RETURN</span> grade;</span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> test_if(<span class="number">95</span>); #A</span><br><span class="line"><span class="keyword">SELECT</span> test_if(<span class="number">65</span>); #C</span><br><span class="line"># 方式<span class="number">2</span>：使用<span class="keyword">case</span>结构实现</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> test_case(score <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">CHAR</span></span><br><span class="line">		<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line">				<span class="keyword">DECLARE</span> grade <span class="type">CHAR</span>;</span><br><span class="line">				<span class="keyword">CASE</span> <span class="keyword">WHEN</span> score <span class="operator">&gt;</span> <span class="number">90</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> grade <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">						 <span class="keyword">WHEN</span> score <span class="operator">&gt;</span> <span class="number">80</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> grade <span class="operator">=</span> <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">						 <span class="keyword">WHEN</span> score <span class="operator">&gt;</span> <span class="number">60</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> grade <span class="operator">=</span> <span class="string">&#x27;C&#x27;</span>;</span><br><span class="line">						 <span class="keyword">ELSE</span> <span class="keyword">SET</span> grade <span class="operator">=</span> <span class="string">&#x27;D&#x27;</span>;</span><br><span class="line">				<span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line">				<span class="keyword">RETURN</span> grade;</span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> test_case(<span class="number">87</span>); # B</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> test_case(<span class="number">56</span>); # D</span><br></pre></td></tr></table></figure>

<h3 id="创建存储过程test-if-pro-，传入工资值，如果工资值-lt-3000-则删除工资为此值的员工，如果3000-lt-x3D-工-资值-lt-x3D-5000-则修改此工资值的员工薪资涨1000，否则涨工资500"><a href="#创建存储过程test-if-pro-，传入工资值，如果工资值-lt-3000-则删除工资为此值的员工，如果3000-lt-x3D-工-资值-lt-x3D-5000-则修改此工资值的员工薪资涨1000，否则涨工资500" class="headerlink" title="创建存储过程test_if_pro()，传入工资值，如果工资值&lt;3000,则删除工资为此值的员工，如果3000 &lt;&#x3D; 工 资值 &lt;&#x3D; 5000,则修改此工资值的员工薪资涨1000，否则涨工资500"></a>创建存储过程test_if_pro()，传入工资值，如果工资值&lt;3000,则删除工资为此值的员工，如果3000 &lt;&#x3D; 工 资值 &lt;&#x3D; 5000,则修改此工资值的员工薪资涨1000，否则涨工资500</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">2.</span> 创建存储过程test_if_pro()，传入工资值，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#  如果工资值<span class="operator">&lt;</span><span class="number">3000</span>,则删除工资为此值的员工，如果<span class="number">3000</span> <span class="operator">&lt;=</span> 工</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#  资值 <span class="operator">&lt;=</span> <span class="number">5000</span>,则修改此工资值的员工薪资涨<span class="number">1000</span>，否则涨工资<span class="number">500</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_if_pro(<span class="keyword">IN</span> salary <span class="keyword">DOUBLE</span>(<span class="number">8</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				IF sal<span class="operator">&lt;</span><span class="number">3000</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">						<span class="keyword">THEN</span> <span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">=</span> sal; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				ELSEIF sal <span class="operator">&lt;=</span> <span class="number">5000</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">						<span class="keyword">THEN</span> <span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary<span class="operator">+</span><span class="number">1000</span> <span class="keyword">WHERE</span> salary <span class="operator">=</span> sal; 			 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="keyword">ELSE</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">						<span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary<span class="operator">+</span><span class="number">500</span> <span class="keyword">WHERE</span> salary <span class="operator">=</span> sal; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h3 id="创建存储过程insert-data-传入参数为-IN-的-INT-类型变量-insert-count-实现向admin表中批量插入insert-count条记录"><a href="#创建存储过程insert-data-传入参数为-IN-的-INT-类型变量-insert-count-实现向admin表中批量插入insert-count条记录" class="headerlink" title="创建存储过程insert_data(),传入参数为 IN 的 INT 类型变量 insert_count,实现向admin表中批量插入insert_count条记录"></a>创建存储过程insert_data(),传入参数为 IN 的 INT 类型变量 insert_count,实现向admin表中批量插入insert_count条记录</h3><p>题目：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> admin(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">user_name <span class="type">VARCHAR</span>(<span class="number">25</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">user_pwd <span class="type">VARCHAR</span>(<span class="number">35</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> admin;</span><br></pre></td></tr></table></figure>

<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">3.</span> 创建存储过程insert_data(),传入参数为 <span class="keyword">IN</span> 的 <span class="type">INT</span> 类型变量 insert_count,</span><br><span class="line"># 实现向admin表中批量插入insert_count条记录</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> admin(</span><br><span class="line">		id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">		user_name <span class="type">VARCHAR</span>(<span class="number">25</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">		user_pwd <span class="type">VARCHAR</span>(<span class="number">35</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> admin; # <span class="keyword">NULL</span>  <span class="keyword">NULL</span>  <span class="keyword">NULL</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_data(<span class="keyword">IN</span> insert_count <span class="type">INT</span>)</span><br><span class="line">		<span class="keyword">BEGIN</span></span><br><span class="line">			<span class="keyword">DECLARE</span> num <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;#记录循环次数</span><br><span class="line">			WHILE num <span class="operator">&lt;=</span> insert_count DO</span><br><span class="line">					<span class="keyword">INSERT</span> <span class="keyword">INTO</span> admin(user_name,user_pwd)					<span class="keyword">VALUES</span>(CONCAT(<span class="string">&#x27;Tom&#x27;</span>,num),ROUND(RAND() <span class="operator">*</span> <span class="number">100000000</span>));</span><br><span class="line"></span><br><span class="line">					<span class="keyword">SET</span> num <span class="operator">=</span> num <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">END</span> WHILE;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"><span class="keyword">CALL</span> insert_data(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> admin;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239323593.png" alt="img"></p>
<h2 id="游标的使用"><a href="#游标的使用" class="headerlink" title="游标的使用"></a><strong>游标的使用</strong></h2><p>​    创建存储过程update_salary() ，参数 1 为 IN 的 INT 型变量 dept_id ，表示部门 id ；参数 2 为 IN 的 INT 型变量 change_sal_count，表示要调整薪资的员工个数。查询指定 id 部门的员工信息，按照 salary 升序排列，根 据hire_date 的情况，调整前 change_sal_count 个员工的薪资，详情如下。</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239333599.png" alt="img"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"># 游标的使用</span><br><span class="line">#创建存储过程update_salary()，参数<span class="number">1</span>为 <span class="keyword">IN</span> 的<span class="type">INT</span>型变量dept_id，表示部门id；</span><br><span class="line">#  参数<span class="number">2</span>为 <span class="keyword">IN</span>的<span class="type">INT</span>型变量change_sal_count，表示要调整薪资的员工个数。</span><br><span class="line">#  查询指定id部门的员工信息，按照salary升序排列，根据hire_date的情况，</span><br><span class="line">#  调整前change_sal_count个员工的薪资，详情如下。</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> update_salary(<span class="keyword">IN</span> dept_id <span class="type">INT</span>,<span class="keyword">IN</span> change_sal_count <span class="type">INT</span>)</span><br><span class="line">		<span class="keyword">BEGIN</span></span><br><span class="line">				#声明变量</span><br><span class="line">				<span class="keyword">DECLARE</span> hire_year <span class="keyword">DOUBLE</span>; #记录某个员工的入职年份</span><br><span class="line">				<span class="keyword">DECLARE</span> id <span class="type">INT</span>; #记录员工的id</span><br><span class="line">				<span class="keyword">DECLARE</span> num <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>; #记录循环的次数</span><br><span class="line">				#定义游标</span><br><span class="line">				<span class="keyword">DECLARE</span> emp_cursor <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(hire_date),employee_id </span><br><span class="line">			<span class="keyword">FROM</span> employees </span><br><span class="line">														<span class="keyword">WHERE</span> department_id <span class="operator">=</span> dept_id					<span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>;</span><br><span class="line">				#打开游标</span><br><span class="line">				<span class="keyword">OPEN</span> emp_cursor;</span><br><span class="line"></span><br><span class="line">				#使用游标</span><br><span class="line"></span><br><span class="line">				WHILE num <span class="operator">&lt;=</span> change_sal_count DO</span><br><span class="line">						<span class="keyword">FETCH</span> emp_cursor <span class="keyword">INTO</span> hire_year,id;</span><br><span class="line"></span><br><span class="line">						IF hire_year <span class="operator">&lt;</span> <span class="number">1995</span></span><br><span class="line">								<span class="keyword">THEN</span> <span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.2</span> <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> id;</span><br><span class="line">						ELSEIF hire_year <span class="operator">&lt;</span> <span class="number">1998</span> </span><br><span class="line">								<span class="keyword">THEN</span> <span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.15</span> <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> id;</span><br><span class="line">						ELSEIF hire_year <span class="operator">&lt;</span> <span class="number">2001</span> </span><br><span class="line">								<span class="keyword">THEN</span> <span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.10</span> <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> id;</span><br><span class="line">						<span class="keyword">ELSE</span> </span><br><span class="line">								<span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> salary <span class="operator">*</span> <span class="number">1.05</span> <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> id;</span><br><span class="line"></span><br><span class="line">						<span class="keyword">END</span> IF;</span><br><span class="line">						<span class="keyword">SET</span> num <span class="operator">=</span> num <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">END</span> WHILE;</span><br><span class="line">				# 关闭游标</span><br><span class="line">				<span class="keyword">CLOSE</span> emp_cursor;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id ,<span class="keyword">YEAR</span>(hire_date),salary</span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> update_salary(<span class="number">100</span>,<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id ,<span class="keyword">YEAR</span>(hire_date),salary</span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239333659.png" alt="img"></p>
<h1 id="MySQL-触发器"><a href="#MySQL-触发器" class="headerlink" title="MySQL 触发器"></a>MySQL 触发器</h1><p>​     在实际开发中，我们经常会遇到这样的情况：有 2 个或者多个相互关联的表，如 商品信息 和 库存信息 分别存放在 2 个不同的数据表中，我们在添加一条新商品记录的时候，为了保证数据的完整性，必须同时在库存表中添加一条库存记录。</p>
<p>​    这样一来，我们就必须把这两个关联的操作步骤写到程序里面，而且要用 事务 包裹起来，确保这两个操作成为一个 原子操作 ，要么全部执行，要么全部不执行。要是遇到特殊情况，可能还需要对数据进行手动维护，这样就很 容易忘记其中的一步 ，导致数据缺失。</p>
<p>​    这个时候，咱们可以使用触发器。 <strong>你可以创建一个触发器，让商品信息数据的插入操作自动触发库存数</strong> <strong>据的插入操作。</strong> 这样一来，就不用担心因为忘记添加库存数据而导致的数据缺失了。</p>
<h2 id="触发器概述"><a href="#触发器概述" class="headerlink" title="触发器概述"></a><strong>触发器概述</strong></h2><p>​    MySQL从 5.0.2 版本开始支持触发器。 MySQL 的触发器和存储过程一样，都是嵌入到 MySQL 服务器的一段程序。</p>
<p>​    触发器是由 事件来触发 某个操作，这些事件包括 INSERT 、 UPDATE 、 DELETE 事件。所谓事件就是指用户的动作或者触发某项行为。如果定义了触发程序，当数据库执行这些语句时候，就相当于事件发生了，就会 自动 激发触发器执行相应的操作。</p>
<p>​    当对数据表中的数据执行插入、更新和删除操作，需要自动执行一些数据库逻辑时，可以使用触发器来实现。</p>
<h2 id="触发器的创建"><a href="#触发器的创建" class="headerlink" title="触发器的创建"></a><strong>触发器的创建</strong></h2><h3 id="创建触发器语法"><a href="#创建触发器语法" class="headerlink" title="创建触发器语法"></a><strong>创建触发器语法</strong></h3><p><em><strong>*创建触发器的语法结构是：*</strong></em></p>
<blockquote>
<p>​    <em><strong>*CREATE TRIGGER** **触发器名称*</strong></em></p>
<p>​    <em>*<em>*{BEFORE|*</em>*<em>AFTER*</em>**} {INSERT|*</em>*<em>UPDATE*</em>*<em>|*</em>*<em>DELETE*</em>*<em>}*</em> *<em>ON*</em> *<em>表名*</em>**</p>
<p>​    <em><strong>*FOR EACH ROW*</strong></em></p>
<p>​    <em><strong>*触发器执行的语句块;*</strong></em></p>
</blockquote>
<p><em><strong>*说明：*</strong></em></p>
<p>​    <em><strong>*表名** **：表示触发器监控的对象。*</strong></em></p>
<p>​    <em>*<em>*BEFORE|AFTER*</em> *<em>：表示触发的时间。*</em>*<em>BEFORE*</em> *<em>表示在事件之前触发；*</em>*</em></p>
<p>​                                   <em><strong>*AFTER 表示在事件之后触发。*</strong></em></p>
<p>​    <em><strong>*INSERT|UPDATE|DELETE** **：表示触发的事件。*</strong></em></p>
<p>​        <em><strong>*INSERT 表示插入记录时触发；*</strong></em></p>
<p>​        <em><strong>*UPDATE 表示更新记录时触发；*</strong></em></p>
<p>​        <em><strong>*DELETE 表示删除记录时触发。*</strong></em></p>
<p>​     <em>*<em>*触发器执行的语句块*</em> *<em>：可以是单条*</em>*<em>SQL*</em>*<em>语句，也可以是由*</em>*<em>BEGIN…END*</em>*</em> <strong>结构组成的复合语句块。</strong></p>
<h3 id="代码举例-2"><a href="#代码举例-2" class="headerlink" title="代码举例"></a><strong>代码举例</strong></h3><p><em><strong>*举例1：*</strong></em></p>
<p><em>*<em>*1*</em>*<em>、创建数据表：*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test_trigger (</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">t_note <span class="type">VARCHAR</span>(<span class="number">30</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test_trigger_log (</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">t_log <span class="type">VARCHAR</span>(<span class="number">30</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><em>*<em>*2*</em>*<em>、创建触发器：创建名称为*</em>*<em>before_insert*</em>*<em>的触发器，向*</em>*<em>test_trigger*</em>*<em>数据表插入数据之前，向*</em>*</em></p>
<p><em>*<em>*test_trigger_log*</em>*<em>数据表中插入*</em>*<em>before_insert*</em>*<em>的日志信息。*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2</span>、创建触发器：创建名称为before_insert的触发器，向test_trigger数据表插入数据之前，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#   向test_trigger_log数据表中插入before_insert的日志信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> before_insert</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> test_trigger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> test_trigger_log(t_log)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">VALUES</span> (<span class="string">&#x27;before into ...&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<p><em>*<em>*3*</em>*<em>、向*</em>*<em>test_trigger*</em>*<em>数据表中插入数据*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3</span>、向test_trigger数据表中插入数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test_trigger(t_note)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27; 测试 before into 触发器&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><em>*<em>*4*</em>*<em>、查看*</em>*<em>test_trigger_log*</em>*<em>数据表中的数据*</em>*</em></p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239333798.png" alt="img"></p>
<p><em>*<em>*举例*</em>*<em>2*</em>*<em>：*</em>*</em> <strong>创建名称为after_insert</strong> <em>*<em>*的触发器，向*</em>*<em>test_trigger*</em>*<em>数据表插入数据之后，向*</em>*<em>test_trigger_log*</em>*<em>数据表中插入after_insert*</em>*<em>的日志信息。*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"># 举例<span class="number">2</span>： 创建名称为after_insert的触发器，向test_trigger数据表插入数据之后，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 向test_trigger_log数据表中插入after_insert的日志信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> after_insert</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> test_trigger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> test_trigger_log(t_log)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">VALUES</span> (<span class="string">&#x27;after insert ...&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test_trigger(t_note)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;测试 after insert 触发器&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test_trigger;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test_trigger_log;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239343860.png" alt="img"></p>
<p><em>*<em>*举例*</em>*<em>3*</em>*<em>：*</em>*<em>定义触发器*</em>*<em>“salary_check_trigger”*</em>*<em>，基于员工表*</em>*<em>“employees”*</em>*<em>的*</em>*<em>INSERT*</em>*<em>事件，在*</em>*<em>INSERT*</em>*<em>之前检查将要添加的新员工薪资是否大于他领导的薪资，如果大于领导薪资，则报sqlstate_value*</em>*<em>为*</em>**’HY000’*</em>*<em>的错误，从而使得添加失败。*</em>**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"># 举例<span class="number">3</span>：定义触发器“salary_check_trigger”，基于员工表“employees”的<span class="keyword">INSERT</span>事件，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#	 在<span class="keyword">INSERT</span>之前检查将要添加的新员工薪资是否大于他领导的薪资，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#	 如果大于领导薪资，则报sqlstate_value为<span class="string">&#x27;HY000&#x27;</span>的错误，从而使得添加失败。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 准备工作</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employees</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigudb.`employees`;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> departments</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> atguigudb.`departments`;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DESC</span> employees;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#创建触发器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> salary_check_trigger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> employees</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">BEGIN</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				#查询到要添加的数据的manager的薪资</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="keyword">DECLARE</span> mgr_sal <span class="keyword">DOUBLE</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="keyword">SELECT</span> salary <span class="keyword">INTO</span> mgr_sal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="keyword">FROM</span> employees</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> NEW.manager_id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				IF NEW.salary <span class="operator">&gt;</span> mgr_sal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">					<span class="keyword">THEN</span> SIGNAL <span class="keyword">SQLSTATE</span> <span class="string">&#x27;HY000&#x27;</span> <span class="keyword">SET</span> MESSAGE_TEXT <span class="operator">=</span> <span class="string">&#x27;薪资高于领导薪资错误&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#测试</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#添加成功：依然触发了触发器salary_check_trigger的执行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employees(employee_id,last_name,email,hire_date,job_id,salary,manager_id)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="keyword">VALUES</span>(<span class="number">300</span>,<span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;Tom@123.com&#x27;</span>,CURDATE(),<span class="string">&#x27;AD_VP&#x27;</span>,<span class="number">8000</span>,<span class="number">206</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># <span class="number">1644</span> <span class="operator">-</span> 薪资高于领导薪资错误</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employees(employee_id,last_name,email,hire_date,job_id,salary,manager_id)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="keyword">VALUES</span>(<span class="number">301</span>,<span class="string">&#x27;Tom2&#x27;</span>,<span class="string">&#x27;Tom2@123.com&#x27;</span>,CURDATE(),<span class="string">&#x27;AD_VP&#x27;</span>,<span class="number">9000</span>,<span class="number">206</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239344054.png" alt="img"></p>
<p>​     <strong>上面触发器声明过程中的NEW关键字代表INSERT添加语句的新记录。</strong></p>
<p>​    <strong>还有OLD表示原有的数据记录。</strong></p>
<h2 id="查看、删除触发器"><a href="#查看、删除触发器" class="headerlink" title="查看、删除触发器"></a><strong>查看、删除触发器</strong></h2><h3 id="查看触发器"><a href="#查看触发器" class="headerlink" title="查看触发器"></a><strong>查看触发器</strong></h3><p>​    查看触发器是查看数据库中已经存在的触发器的定义、状态和语法信息等。</p>
<h3 id="方式1：查看当前数据库的所有触发器的定义"><a href="#方式1：查看当前数据库的所有触发器的定义" class="headerlink" title="方式1：查看当前数据库的所有触发器的定义"></a><strong>方式1：查看当前数据库的所有触发器的定义</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TRIGGERS\G</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239344072.png" alt="img"></p>
<h3 id="方式2：查看当前数据库中某个触发器的定义"><a href="#方式2：查看当前数据库中某个触发器的定义" class="headerlink" title="方式2：查看当前数据库中某个触发器的定义"></a><strong>方式2：查看当前数据库中某个触发器的定义</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> 触发器名</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239344080.png" alt="img"></p>
<h3 id="方式3：从系统库information-schema的TRIGGERS表中查询"><a href="#方式3：从系统库information-schema的TRIGGERS表中查询" class="headerlink" title="*方式3：从系统库information_schema的TRIGGERS表中查询*"></a><em><strong>*方式3：从系统库information_schema的TRIGGERS表中查询*</strong></em></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.TRIGGERS;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239354088.png" alt="img"></p>
<h3 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a><strong>删除触发器</strong></h3><p>​    <strong>触发器也是数据库对象，删除触发器也用DROP</strong> <em><strong>*语句，语法格式如下：*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> [IF <span class="keyword">EXISTS</span>] 触发器名称;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239354098.png" alt="img"></p>
<h2 id="触发器的优缺点"><a href="#触发器的优缺点" class="headerlink" title="触发器的优缺点"></a><strong>触发器的优缺点</strong></h2><h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a><strong>优点</strong></h3><h4 id="触发器可以确保数据的完整性。"><a href="#触发器可以确保数据的完整性。" class="headerlink" title="触发器可以确保数据的完整性。"></a><strong>触发器可以确保数据的完整性</strong>。</h4><p>​    假设我们用 进货单头表 （demo.importhead）来保存进货单的总体信息，包括进货单编号、供货商编 号、仓库编号、总计进货数量、总计进货金额和验收日期。</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239354108.png" alt="img"></p>
<p>​    用 进货单明细表 （demo.importdetails）来保存进货商品的明细，包括进货单编号、商品编号、进货数量、进货价格和进货金额。</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239364112.png" alt="img"></p>
<p>​    每当我们录入、删除和修改一条进货单明细数据的时候，进货单明细表里的数据就会发生变动。这个时候，在进货单头表中的总计数量和总计金额就必须重新计算，否则，进货单头表中的总计数量和总计金额就不等于进货单明细表中数量合计和金额合计了，这就是数据不一致。</p>
<p>​    为了解决这个问题，我们就可以使用触发器， <strong>规定每当进货单明细表有数据插入、修改和删除的操作</strong> <strong>时，自动触发</strong> <strong>2</strong> <strong>步操作：</strong></p>
<p>​    1）重新计算进货单明细表中的数量合计和金额合计；</p>
<p>​    2）用第一步中计算出来的值更新进货单头表中的合计数量与合计金额。</p>
<p>​    这样一来，进货单头表中的合计数量与合计金额的值，就始终与进货单明细表中计算出来的合计数量与合计金额的值相同，数据就是一致的，不会互相矛盾。</p>
<h4 id="触发器可以帮助我们记录操作日志。"><a href="#触发器可以帮助我们记录操作日志。" class="headerlink" title="触发器可以帮助我们记录操作日志。"></a><strong>触发器可以帮助我们记录操作日志。</strong></h4><p>​    利用触发器，可以具体记录什么时间发生了什么。比如，记录修改会员储值金额的触发器，就是一个很好的例子。这对我们还原操作执行时的具体场景，更好地定位问题原因很有帮助。</p>
<h4 id="触发器还可以用在操作数据前，对数据进行合法性检查。"><a href="#触发器还可以用在操作数据前，对数据进行合法性检查。" class="headerlink" title="触发器还可以用在操作数据前，对数据进行合法性检查。"></a><strong>触发器还可以用在操作数据前，对数据进行合法性检查。</strong></h4><p>​    比如，超市进货的时候，需要库管录入进货价格。但是，人为操作很容易犯错误，比如说在录入数量的时候，把条形码扫进去了；录入金额的时候，看串了行，录入的价格远超售价，导致账面上的巨亏……</p>
<p>​    这些都可以通过触发器，在实际插入或者更新操作之前，对相应的数据进行检查，及时提示错误，防止错误数据进入系统.</p>
<h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a><strong>缺点</strong></h3><h4 id="触发器最大的一个问题就是可读性差。"><a href="#触发器最大的一个问题就是可读性差。" class="headerlink" title="触发器最大的一个问题就是可读性差。"></a><strong>触发器最大的一个问题就是可读性差。</strong></h4><p>​    因为触发器存储在数据库中，并且由事件驱动，这就意味着触发器有可能 不受应用层的控制 。这对系统 维护是非常有挑战的。</p>
<p>​    比如，创建触发器用于修改会员储值操作。如果触发器中的操作出了问题，会导致会员储值金额更新失败。我用下面的代码演示一下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> demo.membermaster <span class="keyword">set</span> memberdeposit<span class="operator">=</span><span class="number">20</span> <span class="keyword">where</span> memberid <span class="operator">=</span> <span class="number">2</span>; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ERROR <span class="number">1054</span> (<span class="number">42</span>S22): <span class="literal">Unknown</span> <span class="keyword">column</span> <span class="string">&#x27;aa&#x27;</span> <span class="keyword">in</span> <span class="string">&#x27;field list&#x27;</span></span><br></pre></td></tr></table></figure>

<p>​    结果显示，系统提示错误，字段“aa”不存在。 这是因为，触发器中的数据插入操作多了一个字段，系统提示错误。可是，如果你不了解这个触发器，很可能会认为是更新语句本身的问题，或者是会员信息表的结构出了问题。说不定你还会给会员信息表添加一个叫“aa”的字段，试图解决这个问题，结果只能是白费力。</p>
<h4 id="相关数据的变更，可能会导致触发器出错。"><a href="#相关数据的变更，可能会导致触发器出错。" class="headerlink" title="相关数据的变更，可能会导致触发器出错。"></a><strong>相关数据的变更，可能会导致触发器出错。</strong></h4><p>​    特别是数据表结构的变更，都可能会导致触发器出错，进而影响数据操作的正常运行。这些都会由于触发器本身的隐蔽性，影响到应用中错误原因排查的效率。</p>
<h3 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a><strong>注意点</strong></h3><p>​    注意，如果在子表中定义了外键约束，并且外键指定了ON UPDATE&#x2F;DELETE CASCADE&#x2F;SET NULL 子句，此时修改父表被引用的键值或删除父表被引用的记录行时，也会引起子表的修改和删除操作，此时基于子 表的UPDATE 和 DELETE 语句定义的触发器并不会被激活。</p>
<p>​    例如：基于子表员工表（t_employee）的DELETE 语句定义了触发器 t1 ，而子表的部门编号（did）字段定义了外键约束引用了父表部门表（t_department）的主键列部门编号（did），并且该外键加了 “ON DELETE SET NULL”子句，那么如果此时删除父表部门表（</p>
<p>t_department ）在子表员工表（t_employee）有匹配记录的部门记录时，会引起子表员工表（t_employee）匹配记录的部门编号（did）修改为 NULL 但是此时不会激活触发器 t1 。只有直接对子表员工表（ t_employee ）执行 DELETE 语句时才会激活触发器 t1 。</p>
<h2 id="练习-2"><a href="#练习-2" class="headerlink" title="练习"></a>练习</h2><h3 id="练习1-2"><a href="#练习1-2" class="headerlink" title="练习1"></a>练习1</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">0.</span> 准备工作</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emps</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> atguigudb.`employees`;</span><br></pre></td></tr></table></figure>

<h4 id="复制一张emps表的空表emps-back，只有表结构，不包含任何数据"><a href="#复制一张emps表的空表emps-back，只有表结构，不包含任何数据" class="headerlink" title="复制一张emps表的空表emps_back，只有表结构，不包含任何数据"></a>复制一张emps表的空表emps_back，只有表结构，不包含任何数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span> 复制一张emps表的空表emps_back，只有表结构，不包含任何数据</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emps_back</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> emps</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h4 id="查询emps-back表中的数据"><a href="#查询emps-back表中的数据" class="headerlink" title="查询emps_back表中的数据"></a>查询emps_back表中的数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">2.</span> 查询emps_back表中的数据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emps_back;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239364201.png" alt="img"></p>
<h4 id="创建触发器emps-insert-trigger，每当向emps表中添加一条记录时，同步将这条记录添加到emps-back表中"><a href="#创建触发器emps-insert-trigger，每当向emps表中添加一条记录时，同步将这条记录添加到emps-back表中" class="headerlink" title="创建触发器emps_insert_trigger，每当向emps表中添加一条记录时，同步将这条记录添加到emps_back表中"></a>创建触发器emps_insert_trigger，每当向emps表中添加一条记录时，同步将这条记录添加到emps_back表中</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">3.</span> 创建触发器emps_insert_trigger，每当向emps表中添加一条记录时，</span><br><span class="line">#   同步将这条记录添加到emps_back表中</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> emps_insert_trigger</span><br><span class="line">AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> emps</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line">		<span class="keyword">BEGIN</span></span><br><span class="line">				<span class="keyword">INSERT</span> <span class="keyword">INTO</span> emps_back(employee_id,last_name,salary)</span><br><span class="line">				<span class="keyword">VALUES</span> (NEW.employee_id,NEW.last_name,NEW.salary);</span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h4 id="验证触发器是否起作用"><a href="#验证触发器是否起作用" class="headerlink" title="验证触发器是否起作用"></a>验证触发器是否起作用</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">4.</span> 验证触发器是否起作用</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emps <span class="keyword">VALUES</span>(<span class="number">300</span>,<span class="string">&#x27;Tom&#x27;</span>,<span class="number">5600</span>); </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emps_back; #<span class="number">300</span>	Tom	<span class="number">5600.00</span></span><br></pre></td></tr></table></figure>

<h3 id="练习2-2"><a href="#练习2-2" class="headerlink" title="练习2"></a>练习2</h3><h4 id="复制一张emps表的空表emps-back1，只有表结构，不包含任何数据"><a href="#复制一张emps表的空表emps-back1，只有表结构，不包含任何数据" class="headerlink" title="复制一张emps表的空表emps_back1，只有表结构，不包含任何数据"></a>复制一张emps表的空表emps_back1，只有表结构，不包含任何数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 练习<span class="number">2</span></span><br><span class="line">#<span class="number">1.</span> 复制一张emps表的空表emps_back1，只有表结构，不包含任何数据</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emps_back1</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> emps</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h4 id="查询emps-back1表中的数据"><a href="#查询emps-back1表中的数据" class="headerlink" title="查询emps_back1表中的数据"></a>查询emps_back1表中的数据</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">2.</span> 查询emps_back1表中的数据</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emps_back1; #	<span class="keyword">NULL</span> <span class="keyword">NULL</span> <span class="keyword">NULL</span>	</span><br></pre></td></tr></table></figure>

<h4 id="创建触发器emps-del-trigger，每当向emps表中删除一条记录时，同步将删除的这条记录添加到emps-back1表中"><a href="#创建触发器emps-del-trigger，每当向emps表中删除一条记录时，同步将删除的这条记录添加到emps-back1表中" class="headerlink" title="创建触发器emps_del_trigger，每当向emps表中删除一条记录时，同步将删除的这条记录添加到emps_back1表中"></a>创建触发器emps_del_trigger，每当向emps表中删除一条记录时，同步将删除的这条记录添加到emps_back1表中</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">3.</span> 创建触发器emps_del_trigger，每当向emps表中删除一条记录时，</span><br><span class="line">#		同步将删除的这条记录添加到emps_back1表中</span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> emps_del_trigger</span><br><span class="line">BEFORE <span class="keyword">DELETE</span> <span class="keyword">ON</span> emps</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line">		<span class="keyword">BEGIN</span></span><br><span class="line">			<span class="keyword">INSERT</span> <span class="keyword">INTO</span> emps_back1(employee_id,last_name,salary)</span><br><span class="line">			<span class="keyword">VALUES</span> (OLD.employee_id,OLD.last_name,OLD.salary); </span><br><span class="line">		<span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h4 id="验证触发器是否起作用-1"><a href="#验证触发器是否起作用-1" class="headerlink" title="验证触发器是否起作用"></a>验证触发器是否起作用</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">4.</span> 验证触发器是否起作用</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> emps</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> emps_back1; # <span class="number">100</span>	King	<span class="number">24000.00</span></span><br></pre></td></tr></table></figure>

<h1 id="MySQL8新特性概述"><a href="#MySQL8新特性概述" class="headerlink" title="MySQL8新特性概述"></a><strong>MySQL8</strong>新特性概述</h1><p>​    MySQL从 5.7 版本直接跳跃发布了 8.0 版本 ，可见这是一个令人兴奋的里程碑版本。 MySQL 8 版本在功能上 做了显著的改进与增强，开发者对MySQL 的源代码进行了重构，最突出的一点是多 MySQL Optimizer 优化器进行了改进。不仅在速度上得到了改善，还为用户带来了更好的性能和更棒的体验。</p>
<h2 id="MySQL8-0-新增特性"><a href="#MySQL8-0-新增特性" class="headerlink" title="MySQL8.0 新增特性"></a><strong>MySQL8.0 新增特性</strong></h2><h3 id="更简便的NoSQL支持"><a href="#更简便的NoSQL支持" class="headerlink" title="更简便的NoSQL支持"></a><strong>更简便的NoSQL支持</strong></h3><p>​     NoSQL 泛指非关系型数据库和数据存储。随着互联网平台的规模飞速发展，传统 的关系型数据库已经越来越不能满足需求。从5.6 版本开始， MySQL 就开始支持简单的 NoSQL 存储功能。</p>
<p>MySQL 8 对这一功能做了优化，以更灵活的方式实现 NoSQL 功能，不再依赖模式（</p>
<p>schema ）。</p>
<h3 id="更好的索引"><a href="#更好的索引" class="headerlink" title="更好的索引"></a><strong>更好的索引</strong></h3><p>​    在查询中，正确地使用索引可以提高查询的效率。MySQL 8 中新增了 隐藏索引 和 降序索引 。隐藏索引可以用来测试去掉索引对查询性能的影响。在查询中混合存在多列索引时，使用降序索引可以提高查询的性能。</p>
<h3 id="更完善的JSON支持"><a href="#更完善的JSON支持" class="headerlink" title="更完善的JSON支持"></a><strong>更完善的JSON支持</strong></h3><p>​    ySQL从 5.7 开始支持原生 JSON 数据的存储， MySQL 8 对这一功能做了优化，增加了聚合函数 JSON_ARRAYAGG() 和 JSON_OBJECTAGG() ，将参数聚合为 JSON 数组或对象，新增了行内</p>
<p>操作符 -&gt;&gt; ，是列路径运算符 -&gt; 的增强，对 JSON 排序做了提升，并优化了 JSON 的更新操作。</p>
<h3 id="安全和账户管理"><a href="#安全和账户管理" class="headerlink" title="安全和账户管理"></a><strong>安全和账户管理</strong></h3><p>​     MySQL 8 中新增了 caching_sha2_password 授权插件、角色、密码历史记录和 FIPS模式支持，这些特性提高了数据库的安全性和性能，使数据库管理员能够更灵活地进行账户管理工作。</p>
<h3 id="InnoDB的变化"><a href="#InnoDB的变化" class="headerlink" title="InnoDB的变化"></a><strong>InnoDB的变化</strong></h3><p>​    InnoDB是 MySQL 默认的存储引擎 ，是事务型数据库的首选引擎，支持事务安全表</p>
<p>（ACID），支持行锁定和外键。在 MySQL 8 版本中， InnoDB 在自增、索引、加密、死锁、共享锁等方面做了大量的 改进和优化 ，并且支持原子数据定义语言（DDL），提高了数据安全性，对事务提供更好的支持。</p>
<h3 id="数据字典"><a href="#数据字典" class="headerlink" title="数据字典"></a><strong>数据字典</strong></h3><p>​     在之前的 MySQL 版本中，字典数据都存储在元数据文件和非事务表中。从 MySQL 8 开始新增</p>
<p>了事务数据字典，在这个字典里存储着数据库对象信息，这些数据字典存储在内部事务表中。</p>
<h3 id="原子数据定义语句"><a href="#原子数据定义语句" class="headerlink" title="原子数据定义语句"></a><strong>原子数据定义语句</strong></h3><p>​    MySQL 8开始支持原子数据定义语句（Automic DDL），即 原子 DDL 。目前，只有InnoDB存储引擎支持原子 DDL 。原子数据定义语句（DDL）将与 DDL 操作相关的数据字典更新、存储引擎</p>
<p>操作、二进制日志写入结合到一个单独的原子事务中，这使得即使服务器崩溃，事务也会提交或回滚。</p>
<p>​    使用支持原子操作的存储引擎所创建的表，在执行DROP TABLE 、 CREATE TABLE 、 ALTER TABLE 、RENAME TABLE、 TRUNCATE TABLE 、 CREATE TABLESPACE 、 DROP TABLESPACE 等操作时，都支持原子操作，即事务要么完全操作成功，要么失败后回滚，不再进行部分提交。 对于从MySQL 5.7 复制到 MySQL 8版本中的语句，可以添加 IF EXISTS 或 IF NOT EXISTS 语句来避免发生错误。</p>
<h3 id="资源管理"><a href="#资源管理" class="headerlink" title="资源管理"></a><strong>资源管理</strong></h3><p>​     MySQL 8 开始支持创建和管理资源组，允许将服务器内运行的线程分配给特定的分组，以便 线程根据组内可用资源执行。组属性能够控制组内资源，启用或限制组内资源消耗。数据库管理员能够根据不同的工作负载适当地更改这些属性。 目前，CPU 时间是可控资源，由 “ 虚拟 CPU” 这个概念来表示，此术语包含CPU 的核心数，超线程，硬件线程等等。服务器在启动时确定可用的虚拟 CPU 数量。拥有对应权限的数据库管理员可以将这些CPU 与资源组关联，并为资源组分配线程。 资源组组件为 MySQL中 的资源组管理提供了 SQL 接口。资源组的属性用于定义资源组。 MySQL 中存在两个默认组，系统组和用户 组，默认的组不能被删除，其属性也不能被更改。对于用户自定义的组，资源组创建时可初始化所有的 属性，除去名字和类型，其他属性都可在创建之后进行更改。 在一些平台下，或进行了某些 MySQL 的配 置时，资源管理的功能将受到限制，甚至不可用。例如，如果安装了线程池插件，或者使用的是 macOS 系统，资源管理将处于不可用状态。在 FreeBSD 和 Solaris 系统中，资源线程优先级将失效。在 Linux 系统 中，只有配置了 CAP_SYS_NICE 属性，资源管理优先级才能发挥作用。</p>
<h3 id="字符集支持"><a href="#字符集支持" class="headerlink" title="字符集支持"></a><strong>字符集支持</strong></h3><p>​     MySQL 8 中默认的字符集由 latin1 更改为 utf8mb4 ，并首次增加了日语所特定使用的集合，utf8mb4_ja_0900_as_cs 。</p>
<h3 id="优化器增强"><a href="#优化器增强" class="headerlink" title="优化器增强"></a><strong>优化器增强</strong></h3><p>​     MySQL 优化器开始支持隐藏索引和降序索引。隐藏索引不会被优化器使用，验证索引的必要性时不需要删除索引，先将索引隐藏，如果优化器性能无影响就可以真正地删除索引。降序索引允许优化器对多个列进行排序，并且允许排序顺序不一致。</p>
<h3 id="公用表表达式"><a href="#公用表表达式" class="headerlink" title="公用表表达式"></a><strong>公用表表达式</strong></h3><p>​    公用表表达式（Common Table Expressions）简称为CTE ， MySQL 现在支持递归和非递</p>
<p>归两种形式的 CTE 。 CTE 通过在 SELECT 语句或其他特定语句前 使用 WITH 语句对临时结果集 进行命名。</p>
<p><em><strong>*基础语法如下：*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> cte_name (col_name1,col_name2 ...) <span class="keyword">AS</span> (Subquery)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> cte_name;</span><br></pre></td></tr></table></figure>

<p>​    <strong>Subquery代表子查询，子查询前使用</strong> <em>*<em>*WITH*</em>*<em>语句将结果集命名为*</em>*<em>cte_name*</em>*<em>，在后续的查询中即可使用cte_name进行查询。*</em>*</em></p>
<h3 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a><strong>窗口函数</strong></h3><p>​     MySQL 8 开始支持窗口函数。在之前的版本中已存在的大部分 聚合函数 在 MySQL 8 中也可以作为窗口函数来使用。</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239364357.png" alt="img"></p>
<h3 id="正则表达式支持"><a href="#正则表达式支持" class="headerlink" title="正则表达式支持"></a><strong>正则表达式支持</strong></h3><p>​     MySQL 在 8.0.4 以后的版本中采用支持 Unicode 的国际化组件库实现正则表达式操作，这种方式不仅能提供完全的Unicode 支持，而且是多字节安全编码。 MySQL 增加了 REGEXP_LIKE() 、</p>
<p>EGEXP_INSTR() 、 REGEXP_REPLACE() 和 REGEXP_SUBSTR() 等函数来提升性能。另外， regexp_stack_limit 和regexp_time_limit 系统变量能够通过匹配引擎来控制资源消耗。</p>
<h3 id="内部临时表"><a href="#内部临时表" class="headerlink" title="内部临时表"></a><strong>内部临时表</strong></h3><p>​     TempTable 存储引擎取代 MEMORY 存储引擎成为内部临时表的默认存储引擎 。 TempTable 存储引擎为VARCHAR 和 VARBINARY 列提供高效存储。 internal_tmp_mem_storage_engine 会话变量定义了内部临时表的存储引擎，可选的值有两个，TempTable 和 MEMORY ，其中 TempTable 为默认的存储引擎。</p>
<p>​    temptable_max_ram系统配置项定义了TempTable 存储引擎可使用的最大内存数量。</p>
<h3 id="日志记录"><a href="#日志记录" class="headerlink" title="日志记录"></a><strong>日志记录</strong></h3><p>​     在 MySQL 8 中错误日志子系统由一系列 MySQL 组件构成。这些组件的构成由系统变量</p>
<p>log_error_services 来配置，能够实现日志事件的过滤和写入</p>
<h3 id="备份锁"><a href="#备份锁" class="headerlink" title="备份锁"></a><strong>备份锁</strong></h3><p>​     新的备份锁允许在线备份期间执行数据操作语句，同时阻止可能造成快照不一致的操作。新备份锁由 LOCK INSTANCE FOR BACKUP 和 UNLOCK INSTANCE 语法提供支持，执行这些操作需要备份管理员特权。</p>
<h3 id="增强的MySQL复制"><a href="#增强的MySQL复制" class="headerlink" title="增强的MySQL复制"></a><strong>增强的MySQL复制</strong></h3><p>​     MySQL 8 复制支持对 JSON 文档 进行部分更新的 二进制日志记录 ，该记录 使用紧凑的二进制格式 ，从而节省记录完整 JSON 文档的空间。当使用基于语句的日志记录时，这种紧凑的日志记</p>
<p>录会自动完成，并且可以通过将新的 binlog_row_value_options 系统变量值设置为 PARTIAL_JSON 来启用。</p>
<h2 id="MySQL8-0移除的旧特性"><a href="#MySQL8-0移除的旧特性" class="headerlink" title="MySQL8.0移除的旧特性"></a><strong>MySQL8.0移除的旧特性</strong></h2><p>​    在MySQL 5.7 版本上开发的应用程序如果使用了 MySQL8.0 移除的特性，语句可能会失败，或者产生不同的执行结果。为了避免这些问题，对于使用了移除特性的应用，应当尽力修正避免使用这些特性，并尽可能使用替代方法。</p>
<h3 id="查询缓存"><a href="#查询缓存" class="headerlink" title="查询缓存"></a><strong>查询缓存</strong></h3><p>​    查询缓存已被移除 ，删除的项有：</p>
<p>​        <strong>（1）语句：</strong> FLUSH QUERY CACHE 和 RESET QUERY CACHE。</p>
<p>​        <strong>（2）系统变量：</strong> query_cache_limit 、 query_cache_min_res_unit 、 query_cache_size 、</p>
<p>​                      query_cache_type、query_cache_wlock_invalidate。</p>
<p>​        <strong>（3）状态变量：</strong> Qcache_free_blocks、 Qcache_free_memory、Qcache_hits、</p>
<p>​                      Qcache_inserts、Qcache_lowmem_prunes、Qcache_not_cached、</p>
<p>​                      Qcache_queries_in_cache、Qcache_total_blocks。</p>
<p>​        <strong>（4）线程状态：</strong> checking privileges on cached query、checking query cache for                           query、invalidating query cache entries、sending cached result to</p>
<p>​                      client、storing result in query cache、waiting for query cache lock。</p>
<h3 id="加密相关"><a href="#加密相关" class="headerlink" title="加密相关"></a><strong>加密相关</strong></h3><p>​     删除的加密相关的内容有： ENCODE() 、 DECODE() 、 ENCRYPT() 、 DES_ENCRYPT() 和</p>
<p>DES_DECRYPT() 函数，配置项 des-key-file ，系统变量 have_crypt ， FLUSH 语句 DES_KEY_FILE 选项，HAVE_CRYPT CMake选项。 对于移除的 ENCRYPT() 函数，考虑使用 SHA2() 替代，对于其他移除的函数，使用AES_ENCRYPT() 和 AES_DECRYPT() 替代。</p>
<h3 id="空间函数相关"><a href="#空间函数相关" class="headerlink" title="空间函数相关"></a><strong>空间函数相关</strong></h3><p>​     在 MySQL 5.7 版本中，多个空间函数已被标记为过时。这些过时函数在 MySQL 8 中都已被</p>
<p>移除，只保留了对应的 ST_ 和 MBR 函数。</p>
<h3 id="N和NULL"><a href="#N和NULL" class="headerlink" title="\N和NULL"></a><strong>\N和NULL</strong></h3><p>​    在SQL语句中，解析器不再将\N视为NULL，所以在SQL语句中应使用NULL代替\N。这项变化不会影响使用LOAD DATA INFILE或者SELECT…INTO OUTFILE操作文件的导入和导出。在这类操作中，NULL仍等同于\N。</p>
<h3 id="mysql-install-db"><a href="#mysql-install-db" class="headerlink" title="mysql_install_db"></a><strong>mysql_install_db</strong></h3><p>​     在 MySQL 分布中，已移除了 mysql_install_db 程序，数据字典初始化需要调用带着 –</p>
<p>initialize 或者 –initialize-insecure 选项的 mysqld 来代替实现。另外， –bootstrap 和 INSTALL_SCRIPTDIRCMake也已被删除。</p>
<h3 id="通用分区处理程序"><a href="#通用分区处理程序" class="headerlink" title="通用分区处理程序"></a><strong>通用分区处理程序</strong></h3><p>​     通用分区处理程序已从 MySQL 服务中被移除。为了实现给定表分区，表所使用的存</p>
<p>储引擎需要自有的分区处理程序。 提供本地分区支持的 MySQL 存储引擎有两个，即 InnoDB 和 NDB ，而在MySQL 8中只支持 InnoDB 。</p>
<h3 id="系统和状态变量信息"><a href="#系统和状态变量信息" class="headerlink" title="系统和状态变量信息"></a><strong>系统和状态变量信息</strong></h3><p>​     在 INFORMATION_SCHEMA 数据库中，对系统和状态变量信息不再进行维护。</p>
<p>GLOBAL_VARIABLES 、 SESSION_VARIABLES 、 GLOBAL_STATUS 、 SESSION_STATUS 表都已被删除。另外，系统变量show_compatibility_56 也已被删除。被删除的状态变量有 Slave_heartbeat_period 、Slave_last_heartbeat,Slave_received_heartbeats、 Slave_retried_transactions 、 Slave_running 。以上被删除的内容都可使用性能模式中对应的内容进行替代。</p>
<h3 id="mysql-plugin工具"><a href="#mysql-plugin工具" class="headerlink" title="mysql_plugin工具"></a><strong>mysql_plugin工具</strong></h3><p>​     mysql_plugin 工具用来配置 MySQL 服务器插件，现已被删除，可使用 –plugin-load 或 -</p>
<p>-plugin-load-add 选项在服务器启动时加载插件或者在运行时使用 INSTALL PLUGIN 语句加载插件来替代该工具。</p>
<h2 id="新特性1：窗口函数"><a href="#新特性1：窗口函数" class="headerlink" title="新特性1：窗口函数"></a><strong>新特性1：窗口函数</strong></h2><h3 id="使用窗口函数前后对比"><a href="#使用窗口函数前后对比" class="headerlink" title="使用窗口函数前后对比"></a><strong>使用窗口函数前后对比</strong></h3><p>假设我现在有这样一个数据表，它显示了某购物网站在每个城市每个区的销售额：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sales(</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">city <span class="type">VARCHAR</span>(<span class="number">15</span>),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">county <span class="type">VARCHAR</span>(<span class="number">15</span>),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sales_value <span class="type">DECIMAL</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sales(city,county,sales_value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;北京&#x27;</span>,<span class="string">&#x27;海淀&#x27;</span>,<span class="number">10.00</span>),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;北京&#x27;</span>,<span class="string">&#x27;朝阳&#x27;</span>,<span class="number">20.00</span>),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;上海&#x27;</span>,<span class="string">&#x27;黄埔&#x27;</span>,<span class="number">30.00</span>),</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;上海&#x27;</span>,<span class="string">&#x27;长宁&#x27;</span>,<span class="number">10.00</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看sales表</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sales;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239364523.png" alt="img"></p>
<p> <strong>需求：</strong>现在计算这个网站在每个城市的销售总额、在全国的销售总额、每个区的销售额占所在城市销售额中的比率，以及占总销售额中的比率。</p>
<p>如果用分组和聚合函数，就需要分好几步来计算。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"># 需求：现在计算这个网站在每个城市的销售总额、全国的销售总额、</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#				每个区的销售额占所在城市销售额中的比率，以及占总销售额中的比率。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 方式<span class="number">1</span>：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 第一步，计算总销售金额，并存入临时表 a：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> a <span class="comment">-- 创建临时表 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(sales_value) <span class="keyword">AS</span> sales_value <span class="comment">-- 计算总计金额 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> sales;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> a; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 第二步，计算每个城市的销售总额并存入临时表 b：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> b <span class="comment">-- 创建临时表</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> city,<span class="built_in">SUM</span>(sales_value) <span class="keyword">AS</span> sales_value <span class="comment">-- 计算城市销售合计</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> sales</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> city;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> b;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 第三步，计算各区的销售占所在城市的总计金额的比例，和占全部销售总计金额的比例。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 		我们可以通过下面的连接查询获得需要的结果：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> s.city <span class="keyword">AS</span> 城市,s.county <span class="keyword">AS</span> 区,s.sales_value <span class="keyword">AS</span> 区销售额,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b.sales_value <span class="keyword">AS</span> 市销售额,s.sales_value<span class="operator">/</span>b.sales_value <span class="keyword">AS</span> 市比率,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a.sales_value <span class="keyword">AS</span> 总销售额,s.sales_value<span class="operator">/</span>a.sales_value <span class="keyword">AS</span> 总比率</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> sales s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">JOIN</span> b <span class="keyword">ON</span> (s.city<span class="operator">=</span>b.city) <span class="comment">-- 连接市统计结果临时表</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">JOIN</span> a <span class="comment">-- 连接总计金额临时表</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> s.city,s.county;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239364637.png" alt="img"></p>
<p> 结果显示：市销售金额、市销售占比、总销售金额、总销售占比都计算出来了。</p>
<p>同样的查询，如果用窗口函数，就简单多了。我们可以用下面的代码来实现：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 方式<span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> city <span class="keyword">AS</span> 城市,county <span class="keyword">AS</span> 区,sales_value <span class="keyword">AS</span> 区销售额,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">SUM</span>(sales_value) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> city) <span class="keyword">AS</span> 市销售额, <span class="comment">-- 计算市销售额</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sales_value<span class="operator">/</span><span class="built_in">SUM</span>(sales_value) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> city) <span class="keyword">AS</span> 市比率,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">SUM</span>(sales_value) <span class="keyword">OVER</span>() <span class="keyword">AS</span> 总销售额, <span class="comment">-- 计算总销售额</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sales_value<span class="operator">/</span><span class="built_in">SUM</span>(sales_value) <span class="keyword">OVER</span>() <span class="keyword">AS</span> 总比率</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> sales</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> city,county;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239374677.png" alt="img"></p>
<p>​    结果显示，我们得到了与上面那种查询同样的结果。</p>
<p>​    使用窗口函数，只用了一步就完成了查询。而且，由于没有用到临时表，执行的效率也更高了。很显然， <strong>在这种需要用到分组统计的结果对每一条记录进行计算的场景下，使用窗口函数更好</strong> 。</p>
<h3 id="窗口函数分类"><a href="#窗口函数分类" class="headerlink" title="窗口函数分类"></a><strong>窗口函数分类</strong></h3><p>​    MySQL从 8.0 版本开始支持窗口函数。窗口函数的作用类似于在查询中对数据进行分组，不同的是，分组操作会把分组的结果聚合成一条记录，而窗口函数是将结果置于每一条数据记录中。</p>
<p>​    <strong>窗口函数可以分为</strong> <em><strong>*静态窗口函数** *<em>和*</em> *<em>动态窗口函数*</em> **。*</strong></em></p>
<p>​        <em><strong>*静态窗口函数的窗口大小是固定的，不会因为记录的不同而不同；*</strong></em></p>
<p>​        <em><strong>*动态窗口函数的窗口大小会随着记录的不同而变化。*</strong></em></p>
<p>​    MySQL官方网站窗口函数的网址为 <strong><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptio">https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptio</a></strong> <strong>ns.html#function_row-number</strong> 。</p>
<p>​    窗口函数总体上可以分为序号函数、分布函数、前后函数、首尾函数和其他函数，如下表：</p>
<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239374699.png" alt="img"></p>
<h3 id="语法结构"><a href="#语法结构" class="headerlink" title="语法结构"></a><strong>语法结构</strong></h3><p><strong>窗口函数的语法结构是：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">函数 <span class="keyword">OVER</span>（[<span class="keyword">PARTITION</span> <span class="keyword">BY</span> 字段名 <span class="keyword">ORDER</span> <span class="keyword">BY</span> 字段名 <span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>]）</span><br><span class="line"># 或</span><br><span class="line">函数 <span class="keyword">OVER</span> 窗口名 … <span class="keyword">WINDOW</span> 窗口名 <span class="keyword">AS</span> （[<span class="keyword">PARTITION</span> <span class="keyword">BY</span> 字段名 <span class="keyword">ORDER</span> <span class="keyword">BY</span> 字段名 <span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>]）</span><br></pre></td></tr></table></figure>

<p>​    <em><strong>*<img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> OVER 关键字指定函数窗口的范围。*</strong></em></p>
<p>​        <strong><img src="https://latex.codecogs.com/gif.latex?%5Ccirc" alt="\circ"> 如果省略后面括号中的内容，则窗口会包含满足WHERE条件的所有记录，窗口函数会</strong></p>
<p>​          <strong>基于所有满足WHERE条件的记录进行计算。</strong></p>
<p>​        <strong><img src="https://latex.codecogs.com/gif.latex?%5Ccirc" alt="\circ"> 如果OVER关键字后面的括号不为空，则可以使用如下语法设置窗口。</strong></p>
<p>​    <strong><img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> 窗口名：为窗口设置一个别名，用来标识窗口。</strong></p>
<p>​    <strong><img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> PARTITION BY子句：指定窗口函数按照哪些字段进行分组。分组后，窗口函数可以在每个分组中分别执行。</strong></p>
<p>​    <strong><img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> ORDER BY子句：指定窗口函数按照哪些字段进行排序。执行排序操作使窗口函数按照排序后的数据记录的顺序进行编号。</strong></p>
<p>​    <strong><img src="https://latex.codecogs.com/gif.latex?%5Cbullet" alt="\bullet"> FRAME子句：为分区中的某个子集定义规则，可以用来作为滑动窗口使用。</strong></p>
<h3 id="分类讲解"><a href="#分类讲解" class="headerlink" title="分类讲解"></a><strong>分类讲解</strong></h3><p>准备数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 准备数据</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> goods(</span><br><span class="line">	id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">	category_id <span class="type">INT</span>,</span><br><span class="line">	category <span class="type">VARCHAR</span>(<span class="number">15</span>),</span><br><span class="line">	NAME <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">	price <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">	stock <span class="type">INT</span>,</span><br><span class="line">	upper_time DATETIME</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> goods(category_id,category,NAME,price,stock,upper_time)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;T恤&#x27;</span>, <span class="number">39.90</span>, <span class="number">1000</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;连衣裙&#x27;</span>, <span class="number">79.90</span>, <span class="number">2500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;卫衣&#x27;</span>, <span class="number">89.90</span>, <span class="number">1500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;牛仔裤&#x27;</span>, <span class="number">89.90</span>, <span class="number">3500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;百褶裙&#x27;</span>, <span class="number">29.90</span>, <span class="number">500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;女装/女士精品&#x27;</span>, <span class="string">&#x27;呢绒外套&#x27;</span>, <span class="number">399.90</span>, <span class="number">1200</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;自行车&#x27;</span>, <span class="number">399.90</span>, <span class="number">1000</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;山地自行车&#x27;</span>, <span class="number">1399.90</span>, <span class="number">2500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;登山杖&#x27;</span>, <span class="number">59.90</span>, <span class="number">1500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;骑行装备&#x27;</span>, <span class="number">399.90</span>, <span class="number">3500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;运动外套&#x27;</span>, <span class="number">799.90</span>, <span class="number">500</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;户外运动&#x27;</span>, <span class="string">&#x27;滑板&#x27;</span>, <span class="number">499.90</span>, <span class="number">1200</span>, <span class="string">&#x27;2020-11-10 00:00:00&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239374764.png" alt="img"></p>
<p>下面针对 goods 表中的数据来验证每个窗口函数的功能。</p>
<h3 id="序号函数"><a href="#序号函数" class="headerlink" title="序号函数"></a><strong>序号函数</strong></h3><p><em><strong>*1．ROW_NUMBER()函数*</strong></em></p>
<p>ROW_NUMBER() 函数能够对数据中的序号进行顺序显示。</p>
<p><em><strong>*举例：查询** *<em>goods*</em> **数据表中每个商品分类下价格降序排列的各个商品信息。*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 序号函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#<span class="number">1</span>．<span class="built_in">ROW_NUMBER</span>()函数: 能够对数据中的序号进行顺序显示。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#举例：查询 goods 数据表中每个商品分类下价格降序排列的各个商品信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>) <span class="keyword">AS</span> num,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">id,category_id,category,NAME,price,stock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> goods;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239374800.png" alt="img"></p>
<p> <em>*<em>*举例：查询*</em> *<em>goods*</em> *<em>数据表中每个商品分类下价格最高的*</em>*<em>3*</em>*<em>种商品信息。*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 举例：查询 goods 数据表中每个商品分类下价格最高的<span class="number">3</span>种商品信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>) <span class="keyword">AS</span> num,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			id,category_id,category,NAME,price,stock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">FROM</span> goods) t</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> num <span class="operator">&lt;=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239384828.png" alt="img"></p>
<p><strong>2．RANK()函数</strong></p>
<p>​    <em>*<em>*使用RANK()*</em>*<em>函数能够对序号进行并列排序，并且会跳过重复的序号，比如序号为*</em>*<em>1*</em>*<em>、*</em>*<em>1*</em>*<em>、*</em>*<em>3*</em>*<em>。*</em>*</em></p>
<p>​    在名称为“女装 &#x2F; 女士精品 ” 的商品类别中，有两款商品的价格为 89.90 元，分别是卫衣和牛仔裤。两款商品的序号都应该为2 ，而不是一个为 2 ，另一个为 3 。此时，可以使用 RANK() 函数和 DENSE_RANK() 函数解决。</p>
<p><em>*<em>*举例：使用*</em>*<em>RANK()*</em>*<em>函数获取*</em> *<em>goods*</em> *<em>数据表中各类别的价格从高到低排序的各商品信息。*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2.</span><span class="built_in">RANK</span>()函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 举例：使用<span class="built_in">RANK</span>()函数获取 goods 数据表中各类别的价格从高到低排序的各商品信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>) num_rank,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">id,category_id,category,NAME,price,stock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> goods;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239384862.png" alt="img"></p>
<p> <em>*<em>*举例：使用*</em>*<em>RANK()*</em>*<em>函数获取*</em> *<em>goods*</em> *<em>数据表中类别为*</em>*<em>“*</em>*<em>女装*</em>**&#x2F;*</em>*<em>女士精品*</em>*<em>”*</em>*<em>的价格最高的*</em>*<em>4*</em>*<em>款商品信息。*</em>**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 举例：使用<span class="built_in">RANK</span>()函数获取 goods 数据表中类别为“女装<span class="operator">/</span>女士精品”的价格最高的<span class="number">4</span>款商品信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="built_in">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>) num_rank,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			id,category_id,category,NAME,price,stock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">FROM</span> goods) <span class="keyword">AS</span> t</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> category_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> num_rank <span class="operator">&lt;=</span> <span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239384892.png" alt="img"></p>
<p> <em><strong>*3．DENSE_RANK()函数*</strong></em></p>
<p>​    DENSE_RANK()函数对序号进行并列排序，并且不会跳过重复的序号，比如序号为 1 、 1 、 2 。</p>
<p><em>*<em>*举例：使用*</em>*<em>DENSE_RANK()*</em>*<em>函数获取*</em> *<em>goods*</em> *<em>数据表中各类别的价格从高到低排序的各商品信息。*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3.</span><span class="built_in">DENSE_RANK</span>()函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 举例：使用<span class="built_in">DENSE_RANK</span>()函数获取 goods 数据表中各类别的价格从高到低排序的各商品信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>) num_dense_rank,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">id,category_id,category,NAME,price,stock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> goods;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239384920.png" alt="img"></p>
<p> <em>*<em>*举例：使用*</em>*<em>DENSE_RANK()*</em>*<em>函数获取*</em> *<em>goods*</em> *<em>数据表中类别为*</em>*<em>“*</em>*<em>女装*</em>**&#x2F;*</em>*<em>女士精品*</em>*<em>”*</em>*<em>的价格最高的*</em>*<em>4*</em>*<em>款商品信息。*</em>**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 举例：使用<span class="built_in">DENSE_RANK</span>()函数获取 goods 数据表中类别为“女装<span class="operator">/</span>女士精品”的价格最高的<span class="number">4</span>款商品信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>) num_dense_rank,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			id,category_id,category,NAME,price,stock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="keyword">FROM</span> goods) <span class="keyword">AS</span> t</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> category_id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> num_dense_rank <span class="operator">&lt;=</span> <span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239394948.png" alt="img"></p>
<p>​     可以看到，使用DENSE_RANK()函数得出的行号为1、2、2、3，相同价格的商品序号相同，后面的商品序号是连续的，并且没有跳过重复的序号。</p>
<h3 id="分布函数"><a href="#分布函数" class="headerlink" title="分布函数"></a><strong>分布函数</strong></h3><p><strong>1．PERCENT_RANK()函数</strong></p>
<p>​    <strong>PERCENT_RANK()函数是等级值百分比函数。(可以抽象的理解为进度条)</strong></p>
<p><strong>按照如下方式进行计算。</strong></p>
<p>​        </p>
<blockquote>
<p><em>*<em>*(rank -*</em> *<em>1*</em>**) &#x2F; (rows -*</em> *<em>1*</em>*<em>)*</em>**</p>
</blockquote>
<p><em>*<em>*其中，*</em>*<em>rank*</em>*<em>的值为使用*</em>*<em>RANK()*</em>*<em>函数产生的序号，*</em>*<em>rows*</em>*<em>的值为当前窗口的总记录数。*</em>*</em></p>
<p><em>*<em>*举例：计算*</em> *<em>goods*</em> *<em>数据表中名称为*</em>*<em>“*</em>*<em>女装*</em>**&#x2F;*</em>*<em>女士精品*</em>*<em>”*</em>*<em>的类别下的商品的*</em>*<em>PERCENT_RANK*</em>** <strong>值。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2.</span> 分布函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># <span class="number">1.</span><span class="built_in">PERCENT_RANK</span>()函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 举例：计算 goods 数据表中名称为“女装<span class="operator">/</span>女士精品”的类别下的商品的PERCENT_RANK值。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 方式<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>) <span class="keyword">AS</span> r,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PERCENT_RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>) <span class="keyword">AS</span> pr,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">id, category_id, category, NAME, price, stock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> goods</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> category_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 方式<span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">RANK</span>() <span class="keyword">OVER</span> w <span class="keyword">AS</span> r,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="built_in">PERCENT_RANK</span>() <span class="keyword">OVER</span> w <span class="keyword">AS</span> pr,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			id,category_id,category,NAME,price,stock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> goods</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WINDOW</span> w <span class="keyword">AS</span>  (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239395034.png" alt="img"></p>
<p><strong>2．CUME_DIST()函数</strong></p>
<p>​    <strong>CUME_DIST()函数主要用于查询小于或等于某个值的比例。</strong></p>
<p><em>*<em>*举例：查询*</em>*<em>goods*</em>*<em>数据表中小于或等于当前价格的比例。*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2</span>．<span class="built_in">CUME_DIST</span>()函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 举例：查询goods数据表中小于或等于当前价格的比例。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">RANK</span>() <span class="keyword">OVER</span> w <span class="keyword">AS</span> r,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="built_in">CUME_DIST</span>() <span class="keyword">OVER</span> w <span class="keyword">AS</span> cd,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			id,category_id,category,NAME,price,stock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> goods</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WINDOW</span> w <span class="keyword">AS</span>  (<span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239395070.png" alt="img"></p>
<h3 id="前后函数"><a href="#前后函数" class="headerlink" title="前后函数"></a><strong>前后函数</strong></h3><p><strong>1．LAG(expr,n)函数</strong></p>
<p>​    <strong>LAG(expr,n)函数返回当前行的前</strong> <em>*<em>*n*</em>*<em>行的*</em>*<em>expr*</em>*<em>的值。*</em>*</em></p>
<p><em>*<em>*举例：查询*</em>*<em>goods*</em>*<em>数据表中前一个商品价格与当前商品价格的差值。*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">3.</span> 前后函数</span><br><span class="line"># <span class="number">1</span>．<span class="built_in">LAG</span>(expr,n)函数:返回当前行的前n行的expr的值。</span><br><span class="line">#举例：查询goods数据表中前一个商品价格与当前商品价格的差值。</span><br><span class="line"><span class="keyword">SELECT</span> id,category_id,category,NAME,price,lag_price,</span><br><span class="line">			 lag_price <span class="operator">-</span> price <span class="keyword">AS</span> price_diff,stock</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> id,category_id,category,NAME,price,<span class="built_in">LAG</span>(price,<span class="number">1</span>) <span class="keyword">OVER</span> w <span class="keyword">AS</span> lag_price,stock</span><br><span class="line">    <span class="keyword">FROM</span> goods</span><br><span class="line">    <span class="keyword">WINDOW</span> w <span class="keyword">AS</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>) </span><br><span class="line">) t;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239395095.png" alt="img"></p>
<p><strong>2．LEAD(expr,n)函数</strong></p>
<p>​    <em>*<em>*LEAD(expr,n)函数返回当前行的后*</em>*<em>n*</em>*<em>行的*</em>*<em>expr*</em>*<em>的值。*</em>*</em></p>
<p><em>*<em>*举例：查询*</em>*<em>goods*</em>*<em>数据表中后一个商品价格与当前商品价格的差值。*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2</span>．<span class="built_in">LEAD</span>(expr,n)函数</span><br><span class="line"></span><br><span class="line"># <span class="built_in">LEAD</span>(expr,n)函数返回当前行的后n行的expr的值。</span><br><span class="line"></span><br><span class="line"># 举例：查询goods数据表中后一个商品价格与当前商品价格的差值。</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> id,category_id,category,NAME,price,lead_price,</span><br><span class="line">			 price <span class="operator">-</span> lead_price <span class="keyword">AS</span> price_diff,stock</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> id,category_id,category,NAME,price,<span class="built_in">LEAD</span>(price,<span class="number">1</span>) <span class="keyword">OVER</span> w <span class="keyword">AS</span> lead_price,stock</span><br><span class="line">    <span class="keyword">FROM</span> goods</span><br><span class="line">    <span class="keyword">WINDOW</span> w <span class="keyword">AS</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>)</span><br><span class="line">) t;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239395121.png" alt="img"></p>
<h3 id="首尾函数"><a href="#首尾函数" class="headerlink" title="首尾函数"></a><strong>首尾函数</strong></h3><p><strong>1．FIRST_VALUE(expr)函数</strong></p>
<p>​    <em>*<em>*FIRST_VALUE(expr)函数返回第一个*</em>*<em>expr*</em>*<em>的值。*</em>*</em></p>
<p><em>*<em>*举例：按照价格排序，查询第*</em>*<em>1*</em>*<em>个商品的价格信息*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">4.</span> 首尾函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># <span class="number">1</span>．<span class="built_in">FIRST_VALUE</span>(expr)函数:返回第一个expr的值。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#举例：按照价格排序，查询第<span class="number">1</span>个商品的价格信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> id,category_id,category,NAME,stock,price,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			 <span class="built_in">FIRST_VALUE</span>(price) <span class="keyword">OVER</span> w <span class="keyword">AS</span> fir_price</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> goods</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WINDOW</span> w <span class="keyword">AS</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239405159.png" alt="img"></p>
<p><strong>2．LAST_VALUE(expr)函数</strong></p>
<p>​    LAST_VALUE取得的是当前窗口到此条记录的最后一行，即当前记录；</p>
<p><em><strong>*举例：按照价格排序，查询最后一个商品的价格信息。*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">2</span>．<span class="built_in">LAST_VALUE</span>(expr)函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#举例：按照价格排序，查询最后一个商品的价格信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> id,category_id,category,NAME,stock,price,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			 <span class="built_in">LAST_VALUE</span>(price) <span class="keyword">OVER</span> w <span class="keyword">AS</span> last_price</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> goods</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WINDOW</span> w <span class="keyword">AS</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239405193.png" alt="img"></p>
<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a><strong>其他函数</strong></h3><p><strong>1．NTH_VALUE(expr,n)函数</strong></p>
<p>​    <em>*<em>*NTH_VALUE(expr,n)函数返回第*</em>*<em>n*</em>*<em>个*</em>*<em>expr*</em>*<em>的值。*</em>*</em></p>
<p><em>*<em>*举例：查询*</em>*<em>goods*</em>*<em>数据表中排名第*</em>*<em>2*</em>*<em>和第*</em>*<em>3*</em>*<em>的价格信息。*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">5.</span> 其他函数</span><br><span class="line"># <span class="number">1</span>．<span class="built_in">NTH_VALUE</span>(expr,n)函数,返回第n个expr的值。</span><br><span class="line"></span><br><span class="line">#举例：查询goods数据表中排名第<span class="number">2</span>和第<span class="number">3</span>的价格信息。</span><br><span class="line"><span class="keyword">SELECT</span> id,category,NAME,stock,price,</span><br><span class="line">		<span class="built_in">NTH_VALUE</span>(price,<span class="number">2</span>) <span class="keyword">OVER</span> w <span class="keyword">AS</span> second_price,</span><br><span class="line">		<span class="built_in">NTH_VALUE</span>(price,<span class="number">3</span>) <span class="keyword">OVER</span> w <span class="keyword">AS</span> third_price</span><br><span class="line"><span class="keyword">FROM</span> goods</span><br><span class="line"><span class="keyword">WINDOW</span> w <span class="keyword">AS</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> category <span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239405217.png" alt="img"></p>
<p><strong>2．NTILE(n)函数</strong></p>
<p>​    <em>*<em>*NTILE(n)函数将分区中的有序数据分为*</em>*<em>n*</em>*<em>个桶，记录桶编号。*</em>*</em></p>
<p><em>*<em>*举例：将*</em>*<em>goods*</em>*<em>表中的商品按照价格分为*</em>*<em>3*</em>*<em>组。*</em>*</em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2</span>．<span class="built_in">NTILE</span>(n)函数:将分区中的有序数据分为n个桶，记录桶编号。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 举例：将goods表中的商品按照价格分为<span class="number">3</span>组。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">NTILE</span>(<span class="number">3</span>) <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>) <span class="keyword">AS</span> ntile_price,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			id,category,NAME,price</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> goods;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239405245.png" alt="img"></p>
<h3 id="小-结"><a href="#小-结" class="headerlink" title="小 结"></a><strong>小 结</strong></h3><p>​    <strong>窗口函数的特点是可以分组，而且可以在分组内排序。另外，窗口函数不会因为分组而减少原表中的行数，这对我们在原表数据的基础上进行统计和排序非常有用。</strong></p>
<h2 id="新特性2：公用表表达式"><a href="#新特性2：公用表表达式" class="headerlink" title="新特性2：公用表表达式"></a><strong>新特性2：公用表表达式</strong></h2><p>​    公用表表达式（或通用表表达式）简称为<strong>CTE</strong> （Common Table Expressions）。 CTE 是一个命名的临时结果集，作用范围是当前语句。CTE 可以理解成一个可以复用的子查询，当然跟子查询还是有点区别的，CTE可以引用其他 CTE ，但子查询不能引用其他子查询。所以，可以考虑代替子查询。</p>
<p>​    <strong>依据语法结构和执行方式的不同，公用表表达式分为</strong> <em><strong>*普通公用表表达式** *<em>和*</em> *<em>递归公用表表达式*</em> *<em>2*</em> **种。*</strong></em></p>
<h3 id="普通公用表表达式"><a href="#普通公用表表达式" class="headerlink" title="普通公用表表达式"></a><strong>普通公用表表达式</strong></h3><p><em><strong>*普通公用表表达式的语法结构是：*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> CTE名称</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">AS</span> （子查询）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span><span class="operator">|</span><span class="keyword">DELETE</span><span class="operator">|</span><span class="keyword">UPDATE</span> 语句;</span><br></pre></td></tr></table></figure>

<p>​    普通公用表表达式类似于子查询，不过，跟子查询不同的是，它可以被多次引用，而且可以被其他的普通公用表表达式所引用。</p>
<p><em><strong>*举例：查询员工所在的部门的详细信息。*</strong></em></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3.</span>公用表表达式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># <span class="number">3.1</span> 普通公用表表达式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 举例：查询员工所在的部门的详细信息。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># <span class="number">0.</span>准备工作</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employees</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> atguigudb.employees;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> departments</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> atguigudb.departments;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 方式<span class="number">1</span>：使用子查询</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">											<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">											<span class="keyword">FROM</span> employees</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">											);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 方式<span class="number">2</span>：使用公用表表达式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WITH</span> cte_emp_did</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">AS</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id <span class="keyword">FROM</span> employees)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> departments d <span class="keyword">JOIN</span> cte_emp_did c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> d.department_id <span class="operator">=</span> c.department_id;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239405387.png" alt="img"></p>
<p>​    例子说明，公用表表达式可以起到子查询的作用。以后如果遇到需要使用子查询的场景，你可以在查询之前，先定义公用表表达式，然后在查询中用它来代替子查询。而且，跟子查询相比，公用表表达式有一个优点，就是<strong>定义过公用表表达式之后的查询，可以像一个表一样多次引用公用表表达式，而子查询则不能。</strong></p>
<h3 id="递归公用表表达式"><a href="#递归公用表表达式" class="headerlink" title="递归公用表表达式"></a><strong>递归公用表表达式</strong></h3><p>​    递归公用表表达式也是一种公用表表达式，只不过，除了普通公用表表达式的特点以外，它还有自己的特点，就是 <strong>可以调用自己</strong> 。它的语法结构是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span></span><br><span class="line">CTE名称 <span class="keyword">AS</span> （子查询）</span><br><span class="line"><span class="keyword">SELECT</span><span class="operator">|</span><span class="keyword">DELETE</span><span class="operator">|</span><span class="keyword">UPDATE</span> 语句;</span><br></pre></td></tr></table></figure>

<p>​    递归公用表表达式由 2 部分组成，分别是种子查询和递归查询，中间通过关键字 UNION [ALL] 进行连接。这里的 <strong>种子查询，意思就是获得递归的初始值</strong> 。这个查询只会运行一次，以创建初始数据集，之后递归查询会一直执行，直到没有任何新的查询数据产生，递归返回。</p>
<p><strong>案例：</strong> 针对于我们常用的 employees 表，包含 employee_id ， last_name 和 manager_id 三个字段。如果 a 是 b的管理者，那么，我们可以把b 叫做 a 的下属，如果同时 b 又是 c 的管理者，那么 c 就是 b 的下属，是 a 的下下 属。</p>
<p>​    下面我们尝试用查询语句列出所有具有下下属身份的人员信息。</p>
<p>​    如果用我们之前学过的知识来解决，会比较复杂，至少要进行 4 次查询才能搞定：</p>
<p>​        第一步，先找出初代管理者，就是不以任何别人为管理者的人，把结果存入临时表；</p>
<p>​        第二步，找出所有以初代管理者为管理者的人，得到一个下属集，把结果存入临时表；</p>
<p>​        第三步，找出所有以下属为管理者的人，得到一个下下属集，把结果存入临时表。</p>
<p>​        第四步，找出所有以下下属为管理者的人，得到一个结果集。</p>
<p>​    如果第四步的结果集为空，则计算结束，第三步的结果集就是我们需要的下下属集了，否则就必须继续进行第四步，一直到结果集为空为止。比如上面的这个数据表，就需要到第五步，才能得到空结果集。</p>
<p>​    而且，最后还要进行第六步：把第三步和第四步的结果集合并，这样才能最终获得我们需要的结果集。</p>
<p><em><strong>*如果用递归公用表表达式，就非常简单了。我介绍下具体的思路。*</strong></em></p>
<p>​    <em>*<em>*用递归公用表表达式中的种子查询，找出初代管理者。字段 n*</em> *<em>表示代次，初始值为*</em> *<em>1*</em>*<em>，表示是第一代管理者。*</em>*</em></p>
<p>​    <em>*<em>*用递归公用表表达式中的递归查询，查出以这个递归公用表表达式中的人为管理者的人，并且代次的值加 1*</em>*<em>。直到没有人以这个递归公用表表达式中的人为管理者了，递归返回。在最后的查询中，选出所有代次大于等于 3*</em> *<em>的人，他们肯定是第三代及以上代次的下属了，也就是下下属了。这样就得到了我们需要的结果集。*</em>*</em></p>
<p>​    这里看似也是 3 步，实际上是一个查询的 3 个部分，只需要执行一次就可以了。而且也不需要用临时表保存中间结果，比刚刚的方法简单多了。</p>
<p><strong>代码实现：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3.2</span> 递归公用表表达式</span><br><span class="line">#案例：针对于我们常用的employees表，包含employee_id，last_name和manager_id三个字段。</span><br><span class="line">#     如果a是b的管理者，那么，我们可以把b叫做a的下属，</span><br><span class="line">#     如果同时b又是c的管理者，那么c就是b的下属，是a的下下属。</span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">RECURSIVE</span> cte</span><br><span class="line"></span><br><span class="line"><span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> employee_id,last_name,manager_id,<span class="number">1</span> <span class="keyword">AS</span> n </span><br><span class="line">    <span class="keyword">FROM</span> employees </span><br><span class="line">    <span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line">    <span class="comment">-- 种子查询，找到第一代领</span></span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    <span class="keyword">SELECT</span> e.employee_id,e.last_name,e.manager_id,n <span class="operator">+</span> <span class="number">1</span> </span><br><span class="line">    <span class="keyword">FROM</span> employees <span class="keyword">AS</span> e </span><br><span class="line">    <span class="keyword">JOIN</span> cte <span class="keyword">ON</span> e.manager_id <span class="operator">=</span> cte.employee_id </span><br><span class="line">    <span class="comment">-- 递归查询，找出以递归公用表表达式的人为领导的人</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,manager_id,n <span class="keyword">FROM</span> cte <span class="keyword">WHERE</span> n <span class="operator">&gt;=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/202210071239415453.png" alt="img"></p>
<p>​     <em><strong>*总之，递归公用表表达式对于查询一个有共同的根节点的树形结构数据，非常有用。它可以不受层级的限制，轻松查出所有节点的数据。如果用其他的查询方式，就比较复杂了。*</strong></em></p>
<h3 id="小-结-1"><a href="#小-结-1" class="headerlink" title="小 结"></a><strong>小 结</strong></h3><p>​    <strong>公用表表达式的作用是可以替代子查询，而且可以被多次引用。递归公用表表达式对查询有一个共同根节点的树形结构数据非常高效，可以轻松搞定其他查询方式难以处理的查询。</strong></p>
<h2 id="练习-3"><a href="#练习-3" class="headerlink" title="练习"></a>练习</h2><p>题目：</p>
<p>#1. 创建 students 数据表，如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> students(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">student <span class="type">VARCHAR</span>(<span class="number">15</span>),</span><br><span class="line">points TINYINT</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>#2. 向表中添加数据如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> students(student,points)</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;张三&#x27;</span>,<span class="number">89</span>),</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;李四&#x27;</span>,<span class="number">77</span>),</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;王五&#x27;</span>,<span class="number">88</span>),</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;赵六&#x27;</span>,<span class="number">90</span>),</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;孙七&#x27;</span>,<span class="number">90</span>),</span><br><span class="line"></span><br><span class="line">(<span class="string">&#x27;周八&#x27;</span>,<span class="number">88</span>);</span><br></pre></td></tr></table></figure>

<p>#3. 分别使用 RANK() 、 DENSE_RANK() 和 ROW_NUMBER() 函数对学生成绩降序排列情况进行显示</p>
<p>答案：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">3.</span> 分别使用<span class="built_in">RANK</span>()、<span class="built_in">DENSE_RANK</span>() 和 <span class="built_in">ROW_NUMBER</span>()函数对学生成绩降序排列情况进行显示</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">RANK</span>() <span class="keyword">OVER</span> w 排序<span class="number">1</span>,</span><br><span class="line">			 <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span> w 排序<span class="number">2</span>,</span><br><span class="line">			 <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> w 排序<span class="number">3</span>,</span><br><span class="line">			 id,student,points</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">WINDOW</span> w <span class="keyword">AS</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> points <span class="keyword">DESC</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/mysql(%E4%B8%8B)/202210071239415508.png" alt="img"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="http://dreamerlearner.github.io">Dreamer Blog</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://dreamerlearner.github.io/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/">http://dreamerlearner.github.io/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AF%BC%E8%88%AA/">导航</a><a class="post-meta__tags" href="/tags/%E5%88%86%E4%BA%AB/">分享</a></div><div class="post_share"><div class="social-share" data-image="/img/responsive-web-site-screenshot.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/10/07/MySQL%E9%AB%98%E7%BA%A7%E7%AF%87/"><img class="prev-cover" src="/img/om10.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">MySQL高级篇</div></div></a></div><div class="next-post pull-right"><a href="/2022/10/06/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%AD)/"><img class="next-cover" src="/img/gears1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">MySQL基础篇(中)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/09/23/springboot%E5%89%8D%E8%A8%80/" title="springboot前言"><img class="cover" src="/img/golden.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-23</div><div class="title">springboot前言</div></div></a></div><div><a href="/2022/09/23/springboot%E8%BF%90%E7%BB%B4%E5%AE%9E%E7%94%A8%E7%AF%87/" title="springboot运维实用篇"><img class="cover" src="/img/nearby.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-23</div><div class="title">springboot运维实用篇</div></div></a></div><div><a href="/2022/09/23/springboot%E5%8E%9F%E7%90%86%E7%AF%87/" title="springboot原理篇"><img class="cover" src="/img/strings.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-23</div><div class="title">springboot原理篇</div></div></a></div><div><a href="/2022/09/23/springboot%E5%9F%BA%E7%A1%80%E7%AF%87/" title="springboot基础篇"><img class="cover" src="/img/responsive-web-site-screenshot.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-23</div><div class="title">springboot基础篇</div></div></a></div><div><a href="/2022/09/24/redis%E5%85%A5%E9%97%A8%E7%AF%87/" title="redis入门篇"><img class="cover" src="/img/coding.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-24</div><div class="title">redis入门篇</div></div></a></div><div><a href="/2022/09/24/redis%E5%AE%9E%E6%88%98%E7%AF%87/" title="redis实战篇"><img class="cover" src="/img/coding.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-24</div><div class="title">redis实战篇</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Dreamer Blog</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/dreamerLearner"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/dreamerlearner/dreamerlearner.github.io" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:2107603134@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.</span> <span class="toc-text">MySQL 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F-constraint-%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">约束(constraint)概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E7%BA%A6%E6%9D%9F-%E2%80%93-%E4%B8%BA%E4%BA%86%E4%BF%9D%E8%AF%81%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">1.1.1.</span> <span class="toc-text">为什么需要约束 – 为了保证数据的完整性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%A6%E6%9D%9F-%E2%80%93-%E5%AF%B9%E8%A1%A8%E4%B8%AD%E5%AD%97%E6%AE%B5%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">1.1.2.</span> <span class="toc-text">什么是约束 – 对表中字段的限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.1.3.</span> <span class="toc-text">约束的分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F%EF%BC%88NOT-NULL%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">非空约束（NOT NULL）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">1.2.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.2.2.</span> <span class="toc-text">关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">1.2.3.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.2.4.</span> <span class="toc-text">添加非空约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8CREATE-TABLE-%E6%97%B6%E6%B7%BB%E5%8A%A0%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">在CREATE TABLE 时添加非空约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8ALTER-TABLE-%E6%97%B6%E6%B7%BB%E5%8A%A0%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">在ALTER TABLE 时添加非空约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.2.5.</span> <span class="toc-text">删除非空约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E6%80%A7%E7%BA%A6%E6%9D%9F-UNIQUE-%E6%88%96-UNIQUE-KEY"><span class="toc-number">1.3.</span> <span class="toc-text">唯一性约束(UNIQUE 或 UNIQUE KEY)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-1"><span class="toc-number">1.3.3.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.3.4.</span> <span class="toc-text">添加唯一约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8CREATE-TABLE-%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">在CREATE TABLE 时添加唯一约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8ALTER-TABLE-%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">在ALTER TABLE 时添加唯一约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%A4%8D%E5%90%88%E5%94%AF%E4%B8%80%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">添加复合唯一性约束</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PRIMARY-KEY-%E7%BA%A6%E6%9D%9F%EF%BC%88%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">PRIMARY KEY 约束（主键约束）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-2"><span class="toc-number">1.4.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-2"><span class="toc-number">1.4.2.</span> <span class="toc-text">关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-2"><span class="toc-number">1.4.3.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.4.4.</span> <span class="toc-text">添加主键约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8CREATE-TABLE-%E6%97%B6%E6%B7%BB%E5%8A%A0%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">在CREATE TABLE 时添加主键约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8CREATE-TABLE-%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%A4%8D%E5%90%88%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">在CREATE TABLE 时添加复合主键约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-ALTER-TABLE-%E6%97%B6%E6%B7%BB%E5%8A%A0%EF%BC%88%E5%A4%8D%E5%90%88%EF%BC%89%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">在 ALTER TABLE 时添加（复合）主键约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.4.5.</span> <span class="toc-text">删除主键约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%A2%9E%E5%88%97%EF%BC%9AAUTO-INCREMENT"><span class="toc-number">1.5.</span> <span class="toc-text">自增列：AUTO_INCREMENT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-3"><span class="toc-number">1.5.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-3"><span class="toc-number">1.5.2.</span> <span class="toc-text">关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9%E5%92%8C%E8%A6%81%E6%B1%82"><span class="toc-number">1.5.3.</span> <span class="toc-text">特点和要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%A2%9E%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.4.</span> <span class="toc-text">添加自增约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8CREATE-TABLE-%E6%97%B6%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%A2%9E%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">在CREATE TABLE 时添加自增约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-ALTER-TABLE-%E6%97%B6%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%A2%9E%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">在 ALTER TABLE 时添加自增约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%87%AA%E5%A2%9E%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.5.5.</span> <span class="toc-text">删除自增约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-8-0%E6%96%B0%E7%89%B9%E6%80%A7%E2%80%94%E8%87%AA%E5%A2%9E%E5%8F%98%E9%87%8F%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">1.5.6.</span> <span class="toc-text">MySQL 8.0新特性—自增变量的持久化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FOREIGN-KEY-%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.6.</span> <span class="toc-text">FOREIGN KEY 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-4"><span class="toc-number">1.6.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-4"><span class="toc-number">1.6.2.</span> <span class="toc-text">关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A1%A8%E5%92%8C%E4%BB%8E%E8%A1%A8-x2F-%E7%88%B6%E8%A1%A8%E5%92%8C%E5%AD%90%E8%A1%A8"><span class="toc-number">1.6.3.</span> <span class="toc-text">主表和从表&#x2F;父表和子表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-3"><span class="toc-number">1.6.4.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.6.5.</span> <span class="toc-text">添加外键约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-create-table-%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">在 create table 时添加外键约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8ALTER-TABLE-%E6%97%B6%E6%B7%BB%E5%8A%A0%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">在ALTER TABLE 时添加外键约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E7%AD%89%E7%BA%A7%EF%BC%88%E7%BA%A7%E8%81%94%EF%BC%89"><span class="toc-number">1.6.6.</span> <span class="toc-text">约束等级（级联）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.6.7.</span> <span class="toc-text">删除外键约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%9C%BA%E6%99%AF"><span class="toc-number">1.6.8.</span> <span class="toc-text">开发场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83"><span class="toc-number">1.6.9.</span> <span class="toc-text">阿里开发规范</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CHECK-%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.7.</span> <span class="toc-text">CHECK 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-5"><span class="toc-number">1.7.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-5"><span class="toc-number">1.7.2.</span> <span class="toc-text">关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E%EF%BC%9AMySQL-5-7-%E4%B8%8D%E6%94%AF%E6%8C%81"><span class="toc-number">1.7.3.</span> <span class="toc-text">说明：MySQL 5.7 不支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0CHECK-%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.7.4.</span> <span class="toc-text">添加CHECK 约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DEFAULT%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.8.</span> <span class="toc-text">DEFAULT约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8-6"><span class="toc-number">1.8.1.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97-6"><span class="toc-number">1.8.2.</span> <span class="toc-text">关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%BB%98%E8%AE%A4%E5%80%BC%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.8.3.</span> <span class="toc-text">添加默认值约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-CREATE-TABLE%E6%97%B6%E6%B7%BB%E5%8A%A0%E9%BB%98%E8%AE%A4%E5%80%BC%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">在 CREATE TABLE时添加默认值约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-ALTER-TABLE%E6%97%B6%E6%B7%BB%E5%8A%A0%E9%BB%98%E8%AE%A4%E5%80%BC%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">在 ALTER TABLE时添加默认值约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%BB%98%E8%AE%A4%E5%80%BC%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.8.4.</span> <span class="toc-text">删除默认值约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95"><span class="toc-number">1.9.</span> <span class="toc-text">面试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E7%BA%A6%E6%9D%9F%E7%BB%83%E4%B9%A0"><span class="toc-number">2.</span> <span class="toc-text">MySQL 约束练习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A01"><span class="toc-number">2.1.</span> <span class="toc-text">练习1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E8%A1%A8emp2%E7%9A%84id%E5%88%97%E4%B8%AD%E6%B7%BB%E5%8A%A0PRIMARY-KEY%E7%BA%A6%E6%9D%9F"><span class="toc-number">2.1.1.</span> <span class="toc-text">向表emp2的id列中添加PRIMARY KEY约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E8%A1%A8dept2%E7%9A%84id%E5%88%97%E4%B8%AD%E6%B7%BB%E5%8A%A0PRIMARY-KEY%E7%BA%A6%E6%9D%9F"><span class="toc-number">2.1.2.</span> <span class="toc-text">向表dept2的id列中添加PRIMARY KEY约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E8%A1%A8emp2%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%88%97dept-id%EF%BC%8C%E5%B9%B6%E5%9C%A8%E5%85%B6%E4%B8%AD%E5%AE%9A%E4%B9%89FOREIGN-KEY%E7%BA%A6%E6%9D%9F%EF%BC%8C%E4%B8%8E%E4%B9%8B%E7%9B%B8%E5%85%B3%E8%81%94%E7%9A%84%E5%88%97%E6%98%AFdept2%E8%A1%A8%E4%B8%AD%E7%9A%84id%E5%88%97%E3%80%82"><span class="toc-number">2.1.3.</span> <span class="toc-text">向表emp2中添加列dept_id，并在其中定义FOREIGN KEY约束，与之相关联的列是dept2表中的id列。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A02"><span class="toc-number">2.2.</span> <span class="toc-text">练习2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93test01-library2"><span class="toc-number">2.2.1.</span> <span class="toc-text">创建数据库test01_library2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8-books%EF%BC%8C%E8%A1%A8%E7%BB%93%E6%9E%84%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">2.2.2.</span> <span class="toc-text">创建表 books，表结构如下：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ALTER%E8%AF%AD%E5%8F%A5%E7%BB%99books%E6%8C%89%E5%A6%82%E4%B8%8B%E8%A6%81%E6%B1%82%E5%A2%9E%E5%8A%A0%E7%9B%B8%E5%BA%94%E7%9A%84%E7%BA%A6%E6%9D%9F"><span class="toc-number">2.2.3.</span> <span class="toc-text">使用ALTER语句给books按如下要求增加相应的约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">2.2.4.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A03"><span class="toc-number">2.3.</span> <span class="toc-text">练习3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93test04-company"><span class="toc-number">2.3.1.</span> <span class="toc-text">创建数据库test04_company  </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1"><span class="toc-number">2.3.2.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E4%B8%8B%E8%A1%A8%E7%BB%99%E5%87%BA%E7%9A%84%E8%A1%A8%E7%BB%93%E6%9E%84%E5%9C%A8test04-company%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%A4%E4%B8%AA%E6%95%B0%E6%8D%AE%E8%A1%A8offices%E5%92%8Cemployees"><span class="toc-number">2.3.3.</span> <span class="toc-text">按照下表给出的表结构在test04_company数据库中创建两个数据表offices和employees  </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%A1%A8employees%E7%9A%84mobile%E5%AD%97%E6%AE%B5%E4%BF%AE%E6%94%B9%E5%88%B0officeCode%E5%AD%97%E6%AE%B5%E5%90%8E%E9%9D%A2"><span class="toc-number">2.3.4.</span> <span class="toc-text">将表employees的mobile字段修改到officeCode字段后面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%A1%A8employees%E7%9A%84birth%E5%AD%97%E6%AE%B5%E6%94%B9%E5%90%8D%E4%B8%BAemployee-birth"><span class="toc-number">2.3.5.</span> <span class="toc-text">将表employees的birth字段改名为employee_birth</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9sex%E5%AD%97%E6%AE%B5%EF%BC%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%BACHAR-1-%EF%BC%8C%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">2.3.6.</span> <span class="toc-text">修改sex字段，数据类型为CHAR(1)，非空约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%AD%97%E6%AE%B5note"><span class="toc-number">2.3.7.</span> <span class="toc-text">删除字段note</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%AD%97%E6%AE%B5%E5%90%8Dfavoriate-activity%EF%BC%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%BAVARCHAR-100"><span class="toc-number">2.3.8.</span> <span class="toc-text">增加字段名favoriate_activity，数据类型为VARCHAR(100)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E8%A1%A8employees%E5%90%8D%E7%A7%B0%E4%BF%AE%E6%94%B9%E4%B8%BAemployees-info"><span class="toc-number">2.3.9.</span> <span class="toc-text">将表employees名称修改为employees_info</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%8B%93%E5%B1%95%E7%BB%83%E4%B9%A0"><span class="toc-number">2.4.</span> <span class="toc-text">2.拓展练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%9Atest-company"><span class="toc-number">2.4.1.</span> <span class="toc-text">创建数据库：test_company</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%AD%A4%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8B%E5%88%9B%E5%BB%BA%E5%A6%82%E4%B8%8B3%E8%A1%A8%EF%BC%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%AE%BD%E5%BA%A6%EF%BC%8C%E6%98%AF%E5%90%A6%E4%B8%BA%E7%A9%BA%E6%A0%B9%E6%8D%AE%E5%AE%9E%E9%99%85%E6%83%85%E5%86%B5%E8%87%AA%E5%B7%B1%E5%AE%9A%E4%B9%89%E3%80%82"><span class="toc-number">2.4.2.</span> <span class="toc-text">在此数据库下创建如下3表，数据类型，宽度，是否为空根据实际情况自己定义。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%99%E5%B7%A5%E8%B5%84%E8%A1%A8%EF%BC%88salary%EF%BC%89%E7%9A%84%E9%9B%87%E5%91%98%E7%BC%96%E5%8F%B7%EF%BC%88empid%EF%BC%89%E5%A2%9E%E5%8A%A0%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F%EF%BC%8C%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F%E7%AD%89%E7%BA%A7%E4%B8%BA%EF%BC%88on-update-cascade-%E5%92%8Con-delete-cascade%EF%BC%89"><span class="toc-number">2.4.3.</span> <span class="toc-text">给工资表（salary）的雇员编号（empid）增加外键约束，外键约束等级为（on update cascade 和on delete cascade）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-number">2.4.4.</span> <span class="toc-text">添加数据如下：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%87%BA%E6%AF%8F%E4%B8%AA%E9%9B%87%E5%91%98%E7%9A%84%E9%9B%87%E5%91%98%E7%BC%96%E5%8F%B7%EF%BC%8C%E5%A7%93%E5%90%8D%EF%BC%8C%E8%81%8C%E7%A7%B0%EF%BC%8C%E6%89%80%E5%9C%A8%E9%83%A8%E9%97%A8%E5%90%8D%E7%A7%B0%EF%BC%8C%E5%BA%94%E5%8F%91%E5%B7%A5%E8%B5%84%EF%BC%88%E5%9F%BA%E6%9C%AC%E5%B7%A5%E8%B5%84-%E8%81%8C%E5%8A%A1%E5%B7%A5%E8%B5%84%EF%BC%89%EF%BC%8C%E5%AE%9E%E5%8F%91%E5%B7%A5%E8%B5%84%EF%BC%88%E5%9F%BA%E6%9C%AC%E5%B7%A5%E8%B5%84-%E8%81%8C%E5%8A%A1%E5%B7%A5%E8%B5%84-%E6%89%A3%E9%99%A4%EF%BC%89%E3%80%82"><span class="toc-number">2.4.5.</span> <span class="toc-text">查询出每个雇员的雇员编号，姓名，职称，所在部门名称，应发工资（基本工资+职务工资），实发工资（基本工资+职务工资-扣除）。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E9%94%80%E5%94%AE%E9%83%A8%E9%97%A8%E7%9A%84%E9%9B%87%E5%91%98%E5%A7%93%E5%90%8D%E5%8F%8A%E5%85%B6%E5%9F%BA%E6%9C%AC%E5%B7%A5%E8%B5%84"><span class="toc-number">2.4.6.</span> <span class="toc-text">查询销售部门的雇员姓名及其基本工资</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%A7%93%E2%80%9C%E5%BC%A0%E2%80%9D%E4%B8%94%E5%B9%B4%E9%BE%84%E5%B0%8F%E4%BA%8E40%E7%9A%84%E5%91%98%E5%B7%A5%E7%9A%84%E5%85%A8%E9%83%A8%E4%BF%A1%E6%81%AF%E5%92%8C%E5%B9%B4%E9%BE%84"><span class="toc-number">2.4.7.</span> <span class="toc-text">查询姓“张”且年龄小于40的员工的全部信息和年龄</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E7%94%B7%E5%91%98%E5%B7%A5%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B7%A5%E8%B5%84%E5%92%8C%E8%81%8C%E5%8A%A1%E5%B7%A5%E8%B5%84"><span class="toc-number">2.4.8.</span> <span class="toc-text">查询所有男员工的基本工资和职务工资</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%9F%BA%E6%9C%AC%E5%B7%A5%E8%B5%84%E4%BD%8E%E4%BA%8E2000%E7%9A%84%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%E5%92%8C%E8%81%8C%E7%A7%B0%E3%80%81%E6%89%80%E5%9C%A8%E9%83%A8%E9%97%A8%E5%90%8D%E7%A7%B0"><span class="toc-number">2.4.9.</span> <span class="toc-text">查询基本工资低于2000的员工姓名和职称、所在部门名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%91%98%E5%B7%A5%E6%80%BB%E6%95%B0"><span class="toc-number">2.4.10.</span> <span class="toc-text">查询员工总数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E9%83%A8%E9%97%A8%E6%80%BB%E6%95%B0"><span class="toc-number">2.4.11.</span> <span class="toc-text">查询部门总数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%BA%94%E5%8F%91%E5%B7%A5%E8%B5%84%E7%9A%84%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E5%92%8C%E6%9C%80%E9%AB%98%E5%B7%A5%E8%B5%84%E3%80%81%E6%9C%80%E4%BD%8E%E5%B7%A5%E8%B5%84"><span class="toc-number">2.4.12.</span> <span class="toc-text">查询应发工资的平均工资和最高工资、最低工资</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E9%83%A8%E9%97%A8%E7%BB%9F%E8%AE%A1%E5%BA%94%E5%8F%91%E5%B7%A5%E8%B5%84%E7%9A%84%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84"><span class="toc-number">2.4.13.</span> <span class="toc-text">按照部门统计应发工资的平均工资</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%BE%E5%87%BA%E9%83%A8%E9%97%A8%E5%9F%BA%E6%9C%AC%E5%B7%A5%E8%B5%84%E7%9A%84%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84%E4%BD%8E%E4%BA%8E2000%E7%9A%84"><span class="toc-number">2.4.14.</span> <span class="toc-text">找出部门基本工资的平均工资低于2000的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E5%91%98%E5%B7%A5%E7%BC%96%E5%8F%B7%E3%80%81%E5%A7%93%E5%90%8D%E3%80%81%E5%9F%BA%E6%9C%AC%E5%B7%A5%E8%B5%84%E3%80%81%E8%81%8C%E5%8A%A1%E5%B7%A5%E8%B5%84%E3%80%81%E6%89%A3%E9%99%A4%EF%BC%8C%E5%B9%B6%E6%8C%89%E7%85%A7%E8%81%8C%E5%8A%A1%E5%8D%87%E5%BA%8F%E6%8E%92%E5%88%97%EF%BC%8C%E5%A6%82%E6%9E%9C%E8%81%8C%E5%8A%A1%E5%B7%A5%E8%B5%84%E7%9B%B8%E5%90%8C%EF%BC%8C%E5%86%8D%E6%8C%89%E7%85%A7%E5%9F%BA%E6%9C%AC%E5%B7%A5%E8%B5%84%E5%8D%87%E5%BA%8F%E6%8E%92%E5%88%97"><span class="toc-number">2.4.15.</span> <span class="toc-text">按照员工编号、姓名、基本工资、职务工资、扣除，并按照职务升序排列，如果职务工资相同，再按照基本工资升序排列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%91%98%E5%B7%A5%E7%BC%96%E5%8F%B7%E3%80%81%E5%A7%93%E5%90%8D%EF%BC%8C%E5%87%BA%E7%94%9F%E6%97%A5%E6%9C%9F%EF%BC%8C%E5%8F%8A%E5%B9%B4%E9%BE%84%E6%AE%B5%E3%80%82%E5%85%B6%E4%B8%AD%EF%BC%8C%E5%A6%82%E6%9E%9C80%E5%B9%B4%E4%B9%8B%E5%89%8D%E5%87%BA%E7%94%9F%E7%9A%84%EF%BC%8C%E5%AE%9A%E4%B8%BA%E2%80%9D%E8%80%81%E5%B9%B4%E2%80%9C%EF%BC%9B80%E5%90%8E%E5%AE%9A%E4%B8%BA%E2%80%9D%E4%B8%AD%E5%B9%B4%E2%80%9C%EF%BC%8C90%E5%90%8E%E5%AE%9A%E4%B8%BA%E2%80%9D%E9%9D%92%E5%A3%AE%E5%B9%B4%E2%80%9C"><span class="toc-number">2.4.16.</span> <span class="toc-text">查询员工编号、姓名，出生日期，及年龄段。其中，如果80年之前出生的，定为”老年“；80后定为”中年“，90后定为”青壮年“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E7%9A%84%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%92%8C%E4%BB%96%E6%89%80%E5%9C%A8%E7%9A%84%E9%83%A8%E9%97%A8%E5%90%8D%E7%A7%B0"><span class="toc-number">2.4.17.</span> <span class="toc-text">查询所有的员工信息，和他所在的部门名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E9%83%A8%E9%97%A8%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%92%8C%E8%AF%A5%E9%83%A8%E9%97%A8%E7%9A%84%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.18.</span> <span class="toc-text">查询所有部门信息，和该部门的员工信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E8%81%8C%E4%BD%8D%E4%B8%AD%E5%90%AB%E2%80%9C%E5%B7%A5%E7%A8%8B%E5%B8%88%E2%80%9D%E7%9A%84%E7%94%B7%E5%91%98%E5%B7%A5%E7%9A%84%E4%BA%BA%E6%95%B0"><span class="toc-number">2.4.19.</span> <span class="toc-text">查询所有职位中含“工程师”的男员工的人数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%AF%8F%E4%B8%AA%E9%83%A8%E9%97%A8%E7%9A%84%E7%94%B7%E7%94%9F%E5%92%8C%E5%A5%B3%E7%94%9F%E7%9A%84%E4%BA%BA%E6%95%B0%E5%92%8C%E5%B9%B3%E5%9D%87%E5%9F%BA%E6%9C%AC%E5%B7%A5%E8%B5%84"><span class="toc-number">2.4.20.</span> <span class="toc-text">查询每个部门的男生和女生的人数和平均基本工资</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E8%A7%86%E5%9B%BE"><span class="toc-number">3.</span> <span class="toc-text">MySQL 视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.1.</span> <span class="toc-text">常见的数据库对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E6%A6%82%E8%BF%B0"><span class="toc-number">3.2.</span> <span class="toc-text">视图概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE%EF%BC%9F"><span class="toc-number">3.2.1.</span> <span class="toc-text">为什么使用视图？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">3.2.2.</span> <span class="toc-text">视图的理解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="toc-number">3.3.</span> <span class="toc-text">创建视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8D%95%E8%A1%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">3.3.1.</span> <span class="toc-text">创建单表视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%83%85%E5%86%B51%EF%BC%9A%E8%A7%86%E5%9B%BE%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AE%B5%E4%B8%8E%E5%9F%BA%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AE%B5%E6%9C%89%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="toc-number">3.3.2.</span> <span class="toc-text">情况1：视图中的字段与基表中的字段有对应关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%83%85%E5%86%B5%E4%BA%8C%EF%BC%9A%E8%A7%86%E5%9B%BE%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AE%B5%E5%9C%A8%E5%9F%BA%E8%A1%A8%E4%B8%AD%E5%8F%AF%E8%83%BD%E6%B2%A1%E6%9C%89%E5%AF%B9%E5%BA%94%E7%9A%84%E5%AD%97%E6%AE%B5"><span class="toc-number">3.3.3.</span> <span class="toc-text">情况二：视图中的字段在基表中可能没有对应的字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%9A%E8%A1%A8%E8%81%94%E5%90%88%E8%A7%86%E5%9B%BE"><span class="toc-number">3.3.4.</span> <span class="toc-text">创建多表联合视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%A7%86%E5%9B%BE%E5%AF%B9%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">3.3.5.</span> <span class="toc-text">利用视图对数据进行格式化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%A7%86%E5%9B%BE%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="toc-number">3.3.6.</span> <span class="toc-text">基于视图创建视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A7%86%E5%9B%BE"><span class="toc-number">3.4.</span> <span class="toc-text">查看视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%A1%A8%E5%AF%B9%E8%B1%A1%E3%80%81%E8%A7%86%E5%9B%BE%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.4.1.</span> <span class="toc-text">查看数据库的表对象、视图对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A7%86%E5%9B%BE%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">3.4.2.</span> <span class="toc-text">查看视图的结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A7%86%E5%9B%BE%E7%9A%84%E5%B1%9E%E6%80%A7%E4%BF%A1%E6%81%AF"><span class="toc-number">3.4.3.</span> <span class="toc-text">查看视图的属性信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A7%86%E5%9B%BE%E7%9A%84%E8%AF%A6%E7%BB%86%E5%AE%9A%E4%B9%89%E4%BF%A1%E6%81%AF"><span class="toc-number">3.4.4.</span> <span class="toc-text">查看视图的详细定义信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">3.5.</span> <span class="toc-text">更新视图的数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E6%83%85%E5%86%B5%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%9B%B4%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">3.5.1.</span> <span class="toc-text">一般情况，可以更新的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E6%9B%B4%E6%96%B0%E7%9A%84%E8%A7%86%E5%9B%BE"><span class="toc-number">3.5.2.</span> <span class="toc-text">不可更新的视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E3%80%81%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE"><span class="toc-number">3.6.</span> <span class="toc-text">修改、删除视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE"><span class="toc-number">3.6.1.</span> <span class="toc-text">修改视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE"><span class="toc-number">3.6.2.</span> <span class="toc-text">删除视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.7.</span> <span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E4%BC%98%E7%82%B9"><span class="toc-number">3.7.1.</span> <span class="toc-text">视图优点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AE%80%E5%8D%95"><span class="toc-number">3.7.1.1.</span> <span class="toc-text">操作简单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%8F%E5%B0%91%E6%95%B0%E6%8D%AE%E5%86%97%E4%BD%99"><span class="toc-number">3.7.1.2.</span> <span class="toc-text">减少数据冗余</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8"><span class="toc-number">3.7.1.3.</span> <span class="toc-text">数据安全</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%82%E5%BA%94%E7%81%B5%E6%B4%BB%E5%A4%9A%E5%8F%98%E7%9A%84%E9%9C%80%E6%B1%82"><span class="toc-number">3.7.1.4.</span> <span class="toc-text">适应灵活多变的需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%BD%E5%A4%9F%E5%88%86%E8%A7%A3%E5%A4%8D%E6%9D%82%E7%9A%84%E6%9F%A5%E8%AF%A2%E9%80%BB%E8%BE%91"><span class="toc-number">3.7.1.5.</span> <span class="toc-text">能够分解复杂的查询逻辑</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E4%B8%8D%E8%B6%B3"><span class="toc-number">3.7.2.</span> <span class="toc-text">视图不足</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">3.8.</span> <span class="toc-text">练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A01-1"><span class="toc-number">3.8.1.</span> <span class="toc-text">练习1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%A1%A8employees%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BEemployee-vu%EF%BC%8C%E5%85%B6%E4%B8%AD%E5%8C%85%E6%8B%AC%E5%A7%93%E5%90%8D%EF%BC%88LAST-NAME%EF%BC%89%EF%BC%8C%E5%91%98%E5%B7%A5%E5%8F%B7%EF%BC%88EMPLOYEE-ID%EF%BC%89%EF%BC%8C%E9%83%A8%E9%97%A8-%E5%8F%B7-DEPARTMENT-ID"><span class="toc-number">3.8.1.1.</span> <span class="toc-text">使用表employees创建视图employee_vu，其中包括姓名（LAST_NAME），员工号（EMPLOYEE_ID），部门 号(DEPARTMENT_ID)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E8%A7%86%E5%9B%BE%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">3.8.1.2.</span> <span class="toc-text">显示视图的结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A7%86%E5%9B%BE%E4%B8%AD%E7%9A%84%E5%85%A8%E9%83%A8%E5%86%85%E5%AE%B9"><span class="toc-number">3.8.1.3.</span> <span class="toc-text">查询视图中的全部内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E8%A7%86%E5%9B%BE%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E9%99%90%E5%AE%9A%E5%9C%A8%E9%83%A8%E9%97%A8%E5%8F%B7%E6%98%AF80%E7%9A%84%E8%8C%83%E5%9B%B4%E5%86%85"><span class="toc-number">3.8.1.4.</span> <span class="toc-text">将视图中的数据限定在部门号是80的范围内</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A02-1"><span class="toc-number">3.8.2.</span> <span class="toc-text">练习2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BEemp-v1-%E8%A6%81%E6%B1%82%E6%9F%A5%E8%AF%A2%E7%94%B5%E8%AF%9D%E5%8F%B7%E7%A0%81%E4%BB%A5%E2%80%98011%E2%80%99%E5%BC%80%E5%A4%B4%E7%9A%84%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%E5%92%8C%E5%B7%A5%E8%B5%84%E3%80%81%E9%82%AE%E7%AE%B1"><span class="toc-number">3.8.2.1.</span> <span class="toc-text">创建视图emp_v1,要求查询电话号码以‘011’开头的员工姓名和工资、邮箱</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A6%81%E6%B1%82%E5%B0%86%E8%A7%86%E5%9B%BE-emp-v1-%E4%BF%AE%E6%94%B9%E4%B8%BA%E6%9F%A5%E8%AF%A2%E7%94%B5%E8%AF%9D%E5%8F%B7%E7%A0%81%E4%BB%A5%E2%80%98011%E2%80%99%E5%BC%80%E5%A4%B4%E7%9A%84%E5%B9%B6%E4%B8%94%E9%82%AE%E7%AE%B1%E4%B8%AD%E5%8C%85%E5%90%AB-e-%E5%AD%97%E7%AC%A6%E7%9A%84%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%E5%92%8C%E9%82%AE%E7%AE%B1%E3%80%81%E7%94%B5%E8%AF%9D%E5%8F%B7%E7%A0%81"><span class="toc-number">3.8.2.2.</span> <span class="toc-text">要求将视图 emp_v1 修改为查询电话号码以‘011’开头的并且邮箱中包含 e 字符的员工姓名和邮箱、电话号码 </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%91-emp-v1-%E6%8F%92%E5%85%A5%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95%EF%BC%8C%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%EF%BC%9F"><span class="toc-number">3.8.2.3.</span> <span class="toc-text">向 emp_v1 插入一条记录，是否可以？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9emp-v1%E4%B8%AD%E5%91%98%E5%B7%A5%E7%9A%84%E5%B7%A5%E8%B5%84%EF%BC%8C%E6%AF%8F%E4%BA%BA%E6%B6%A8%E8%96%AA1000"><span class="toc-number">3.8.2.4.</span> <span class="toc-text">修改emp_v1中员工的工资，每人涨薪1000</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4emp-v1%E4%B8%AD%E5%A7%93%E5%90%8D%E4%B8%BAOlsen%E7%9A%84%E5%91%98%E5%B7%A5"><span class="toc-number">3.8.2.5.</span> <span class="toc-text">删除emp_v1中姓名为Olsen的员工</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BEemp-v2%EF%BC%8C%E8%A6%81%E6%B1%82%E6%9F%A5%E8%AF%A2%E9%83%A8%E9%97%A8%E7%9A%84%E6%9C%80%E9%AB%98%E5%B7%A5%E8%B5%84%E9%AB%98%E4%BA%8E-12000-%E7%9A%84%E9%83%A8%E9%97%A8id%E5%92%8C%E5%85%B6%E6%9C%80%E9%AB%98%E5%B7%A5%E8%B5%84"><span class="toc-number">3.8.2.6.</span> <span class="toc-text">创建视图emp_v2，要求查询部门的最高工资高于 12000 的部门id和其最高工资</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%91-emp-v2-%E4%B8%AD%E6%8F%92%E5%85%A5%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95%EF%BC%8C%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%EF%BC%9F"><span class="toc-number">3.8.2.7.</span> <span class="toc-text">向 emp_v2 中插入一条记录，是否可以？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%88%9A%E6%89%8D%E7%9A%84emp-v2-%E5%92%8C-emp-v1"><span class="toc-number">3.8.2.8.</span> <span class="toc-text">删除刚才的emp_v2 和 emp_v1</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%8E%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">MySQL 存储过程与函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">存储过程概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%A7%A3"><span class="toc-number">4.1.1.</span> <span class="toc-text">理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">4.1.2.</span> <span class="toc-text">分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">4.2.</span> <span class="toc-text">创建与调用存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E8%AF%AD%E6%B3%95%E5%8F%8A%E5%85%B6%E5%88%86%E6%9E%90"><span class="toc-number">4.2.1.</span> <span class="toc-text">创建存储过程语法及其分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E8%AF%AD%E6%B3%95"><span class="toc-number">4.2.2.</span> <span class="toc-text">调用存储过程语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B"><span class="toc-number">4.2.3.</span> <span class="toc-text">代码举例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B-1-%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-select-all-emps-%EF%BC%8C%E6%9F%A5%E7%9C%8B-emps-%E8%A1%A8%E7%9A%84%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">**举例**1**：创建存储过程**select_all_emps()**，查看* *emps* *表的所有数据**</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B3-%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-show-max-salary-%EF%BC%8C%E7%94%A8%E6%9D%A5%E6%9F%A5%E7%9C%8B-%E2%80%9Cemps%E2%80%9D%E8%A1%A8%E7%9A%84%E6%9C%80%E9%AB%98%E8%96%AA%E8%B5%84%E5%80%BC%E3%80%82"><span class="toc-number">4.2.3.2.</span> <span class="toc-text">**举例3**：创建存储过程**show_max_salary()**，用来查看**“emps”表的最高薪资值。**</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B-4-%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-show-min-salary-%EF%BC%8C%E6%9F%A5%E7%9C%8B-%E2%80%9Cemps%E2%80%9D-%E8%A1%A8%E7%9A%84%E6%9C%80%E4%BD%8E%E8%96%AA%E8%B5%84%E5%80%BC%E3%80%82%E5%B9%B6%E5%B0%86%E6%9C%80%E4%BD%8E%E8%96%AA%E8%B5%84%E9%80%9A%E8%BF%87-OUT-%E5%8F%82%E6%95%B0-%E2%80%9Cms%E2%80%9D-%E8%BE%93%E5%87%BA"><span class="toc-number">4.2.3.3.</span> <span class="toc-text">**举例**4**：创建存储过程**show_min_salary()**，查看**“emps”**表的最低薪资值。并将最低薪资通过**OUT**参数**“ms” 输出:**</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B-5-%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-show-someone-salary-%EF%BC%8C%E6%9F%A5%E7%9C%8B-%E2%80%9Cemps%E2%80%9D-%E8%A1%A8%E7%9A%84%E6%9F%90%E4%B8%AA%E5%91%98%E5%B7%A5%E7%9A%84%E8%96%AA%E8%B5%84%EF%BC%8C%E5%B9%B6%E7%94%A8-IN-%E5%8F%82%E6%95%B0-empname%E8%BE%93%E5%85%A5%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%E3%80%82"><span class="toc-number">4.2.3.4.</span> <span class="toc-text">**举例**5**：创建存储过程**show_someone_salary()**，查看**“emps”**表的某个员工的薪资，并用**IN**参数**empname输入员工姓名。**</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B-6-%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-show-someone-salary2-%EF%BC%8C%E6%9F%A5%E7%9C%8B-%E2%80%9Cemps%E2%80%9D-%E8%A1%A8%E7%9A%84%E6%9F%90%E4%B8%AA%E5%91%98%E5%B7%A5%E7%9A%84%E8%96%AA%E8%B5%84%EF%BC%8C%E5%B9%B6%E7%94%A8-IN-%E5%8F%82%E6%95%B0-empname%E8%BE%93%E5%85%A5%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%EF%BC%8C%E7%94%A8OUT-%E5%8F%82%E6%95%B0-empsalary-%E8%BE%93%E5%87%BA%E5%91%98%E5%B7%A5%E8%96%AA%E8%B5%84%E3%80%82"><span class="toc-number">4.2.3.5.</span> <span class="toc-text">**举例**6**：创建存储过程**show_someone_salary2()**，查看**“emps”**表的某个员工的薪资，并用**IN**参数**empname输入员工姓名，用OUT**参数**empsalary**输出员工薪资。**</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B-7-%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-show-mgr-name-%EF%BC%8C%E6%9F%A5%E8%AF%A2%E6%9F%90%E4%B8%AA%E5%91%98%E5%B7%A5%E9%A2%86%E5%AF%BC%E7%9A%84%E5%A7%93%E5%90%8D%EF%BC%8C%E5%B9%B6%E7%94%A8-INOUT-%E5%8F%82%E6%95%B0-%E2%80%9Cempname%E2%80%9D-%E8%BE%93%E5%85%A5%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%EF%BC%8C%E8%BE%93%E5%87%BA%E9%A2%86%E5%AF%BC%E7%9A%84%E5%A7%93%E5%90%8D%E3%80%82"><span class="toc-number">4.2.3.6.</span> <span class="toc-text">**举例**7**：创建存储过程**show_mgr_name()**，查询某个员工领导的姓名，并用**INOUT**参数**“empname”**输入员工姓名，输出领导的姓名。**</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95"><span class="toc-number">4.2.4.</span> <span class="toc-text">如何调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.3.</span> <span class="toc-text">存储函数的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%E7%9A%84%E8%AF%AD%E6%B3%95%E5%8F%8A%E5%85%B6%E5%88%86%E6%9E%90"><span class="toc-number">4.3.1.</span> <span class="toc-text">创建存储函数的语法及其分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.2.</span> <span class="toc-text">调用存储函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B-1"><span class="toc-number">4.3.3.</span> <span class="toc-text">代码举例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B-1-%EF%BC%9A-%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%EF%BC%8C%E5%90%8D%E7%A7%B0%E4%B8%BAemail-by-name-%EF%BC%8C%E5%8F%82%E6%95%B0%E5%AE%9A%E4%B9%89%E4%B8%BA%E7%A9%BA%EF%BC%8C%E8%AF%A5%E5%87%BD%E6%95%B0%E6%9F%A5%E8%AF%A2-Abel-%E7%9A%84-email-%EF%BC%8C%E5%B9%B6%E8%BF%94%E5%9B%9E%EF%BC%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9E%8B%E3%80%82"><span class="toc-number">4.3.3.1.</span> <span class="toc-text">**举例**1**：* *创建存储函数，名称为email_by_name()**，参数定义为空，该函数查询**Abel**的**email**，并返回，数据类型为字符串型。**</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B2%EF%BC%9A-%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%EF%BC%8C%E5%90%8D%E7%A7%B0%E4%B8%BAemail-by-id-%EF%BC%8C%E5%8F%82%E6%95%B0%E4%BC%A0%E5%85%A5emp-id%EF%BC%8C%E8%AF%A5%E5%87%BD%E6%95%B0%E6%9F%A5%E8%AF%A2emp-id%E7%9A%84email%EF%BC%8C%E5%B9%B6%E8%BF%94%E5%9B%9E%EF%BC%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9E%8B%E3%80%82"><span class="toc-number">4.3.3.2.</span> <span class="toc-text">举例2： 创建存储函数，名称为email_by_id()，参数传入emp_id，该函数查询emp_id的email，并返回，数据类型为字符串型。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B3%EF%BC%9A-%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0count-by-id-%EF%BC%8C%E5%8F%82%E6%95%B0%E4%BC%A0%E5%85%A5dept-id%EF%BC%8C%E8%AF%A5%E5%87%BD%E6%95%B0%E6%9F%A5%E8%AF%A2dept-id%E9%83%A8%E9%97%A8%E7%9A%84%E5%91%98%E5%B7%A5%E4%BA%BA%E6%95%B0%EF%BC%8C%E5%B9%B6%E8%BF%94%E5%9B%9E%EF%BC%8C%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%BA%E6%95%B4%E5%9E%8B%E3%80%82"><span class="toc-number">4.3.3.3.</span> <span class="toc-text">举例3： 创建存储函数count_by_id()，参数传入dept_id，该函数查询dept_id部门的员工人数，并返回，数据类型为整型。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%E5%92%8C%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">4.3.4.</span> <span class="toc-text">对比存储函数和存储过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0%E7%9A%84%E6%9F%A5%E7%9C%8B%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%81%E5%88%A0%E9%99%A4"><span class="toc-number">4.4.</span> <span class="toc-text">存储过程和函数的查看、修改、删除</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B"><span class="toc-number">4.4.1.</span> <span class="toc-text">查看</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8SHOW-CREATE%E8%AF%AD%E5%8F%A5%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0%E7%9A%84%E5%88%9B%E5%BB%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">4.4.1.1.</span> <span class="toc-text">使用SHOW CREATE语句查看存储过程和函数的创建信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8SHOW-STATUS%E8%AF%AD%E5%8F%A5%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0%E7%9A%84%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF"><span class="toc-number">4.4.1.2.</span> <span class="toc-text">使用SHOW STATUS语句查看存储过程和函数的状态信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8Einformation-schema-Routines%E8%A1%A8%E4%B8%AD%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-number">4.4.1.3.</span> <span class="toc-text">从information_schema.Routines表中查看存储过程和函数的信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-number">4.4.2.</span> <span class="toc-text">修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">4.4.3.</span> <span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%BD%BF%E7%94%A8%E7%9A%84%E4%BA%89%E8%AE%AE"><span class="toc-number">4.5.</span> <span class="toc-text">关于存储过程使用的争议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">4.5.1.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">4.5.2.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">4.5.3.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0-1"><span class="toc-number">4.6.</span> <span class="toc-text">练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%BB%83%E4%B9%A0"><span class="toc-number">4.6.1.</span> <span class="toc-text">存储过程练习</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8Binsert-user-%E5%AE%9E%E7%8E%B0%E4%BC%A0%E5%85%A5%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81%EF%BC%8C%E6%8F%92%E5%85%A5%E5%88%B0admin%E8%A1%A8%E4%B8%AD"><span class="toc-number">4.6.1.1.</span> <span class="toc-text">创建存储过程insert_user(),实现传入用户名和密码，插入到admin表中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8Bget-phone-%E5%AE%9E%E7%8E%B0%E4%BC%A0%E5%85%A5%E5%A5%B3%E7%A5%9E%E7%BC%96%E5%8F%B7%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%A5%B3%E7%A5%9E%E5%A7%93%E5%90%8D%E5%92%8C%E5%A5%B3%E7%A5%9E%E7%94%B5%E8%AF%9D"><span class="toc-number">4.6.1.2.</span> <span class="toc-text">创建存储过程get_phone(),实现传入女神编号，返回女神姓名和女神电话</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8Bdate-diff-%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BC%A0%E5%85%A5%E4%B8%A4%E4%B8%AA%E5%A5%B3%E7%A5%9E%E7%94%9F%E6%97%A5%EF%BC%8C%E8%BF%94%E5%9B%9E%E6%97%A5%E6%9C%9F%E9%97%B4%E9%9A%94%E5%A4%A7%E5%B0%8F"><span class="toc-number">4.6.1.3.</span> <span class="toc-text">创建存储过程date_diff()，实现传入两个女神生日，返回日期间隔大小</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8Bformat-date-%E5%AE%9E%E7%8E%B0%E4%BC%A0%E5%85%A5%E4%B8%80%E4%B8%AA%E6%97%A5%E6%9C%9F%EF%BC%8C%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%88%90xx%E5%B9%B4xx%E6%9C%88xx%E6%97%A5%E5%B9%B6"><span class="toc-number">4.6.1.4.</span> <span class="toc-text">创建存储过程format_date(),实现传入一个日期，格式化成xx年xx月xx日并</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8Bbeauty-limit-%EF%BC%8C%E6%A0%B9%E6%8D%AE%E4%BC%A0%E5%85%A5%E7%9A%84%E8%B5%B7%E5%A7%8B%E7%B4%A2%E5%BC%95%E5%92%8C%E6%9D%A1%E7%9B%AE%E6%95%B0%EF%BC%8C%E6%9F%A5%E8%AF%A2%E5%A5%B3%E7%A5%9E%E8%A1%A8%E7%9A%84%E8%AE%B0%E5%BD%95"><span class="toc-number">4.6.1.5.</span> <span class="toc-text">创建存储过程beauty_limit()，根据传入的起始索引和条目数，查询女神表的记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E5%85%A5a%E5%92%8Cb%E4%B8%A4%E4%B8%AA%E5%80%BC%EF%BC%8C%E6%9C%80%E7%BB%88a%E5%92%8Cb%E9%83%BD%E7%BF%BB%E5%80%8D%E5%B9%B6%E8%BF%94%E5%9B%9E"><span class="toc-number">4.6.1.6.</span> <span class="toc-text">传入a和b两个值，最终a和b都翻倍并返回</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%A2%98%E7%9B%AE5%E7%9A%84%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">4.6.1.7.</span> <span class="toc-text">删除题目5的存储过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%A2%98%E7%9B%AE6%E4%B8%AD%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-number">4.6.1.8.</span> <span class="toc-text">查看题目6中存储过程的信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%E7%BB%83%E4%B9%A0"><span class="toc-number">4.6.2.</span> <span class="toc-text">存储函数练习</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0get-count-%E8%BF%94%E5%9B%9E%E5%85%AC%E5%8F%B8%E7%9A%84%E5%91%98%E5%B7%A5%E4%B8%AA%E6%95%B0"><span class="toc-number">4.6.2.1.</span> <span class="toc-text">创建函数get_count(),返回公司的员工个数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0ename-salary-%E6%A0%B9%E6%8D%AE%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%AE%83%E7%9A%84%E5%B7%A5%E8%B5%84"><span class="toc-number">4.6.2.2.</span> <span class="toc-text">创建函数ename_salary(),根据员工姓名，返回它的工资</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0dept-sal-%E6%A0%B9%E6%8D%AE%E9%83%A8%E9%97%A8%E5%90%8D%EF%BC%8C%E8%BF%94%E5%9B%9E%E8%AF%A5%E9%83%A8%E9%97%A8%E7%9A%84%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84"><span class="toc-number">4.6.2.3.</span> <span class="toc-text">创建函数dept_sal() ,根据部门名，返回该部门的平均工资</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0add-float-%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BC%A0%E5%85%A5%E4%B8%A4%E4%B8%AAfloat%EF%BC%8C%E8%BF%94%E5%9B%9E%E4%BA%8C%E8%80%85%E4%B9%8B%E5%92%8C"><span class="toc-number">4.6.2.4.</span> <span class="toc-text">创建函数add_float()，实现传入两个float，返回二者之和</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E5%8F%98%E9%87%8F%E3%80%81%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E4%B8%8E%E6%B8%B8%E6%A0%87%E7%BB%83%E4%B9%A0"><span class="toc-number">5.</span> <span class="toc-text">MySQL 变量、流程控制与游标练习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">5.1.</span> <span class="toc-text">变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0get-count-%E8%BF%94%E5%9B%9E%E5%85%AC%E5%8F%B8%E7%9A%84%E5%91%98%E5%B7%A5%E4%B8%AA%E6%95%B0-1"><span class="toc-number">5.1.1.</span> <span class="toc-text">创建函数get_count(),返回公司的员工个数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0ename-salary-%E6%A0%B9%E6%8D%AE%E5%91%98%E5%B7%A5%E5%A7%93%E5%90%8D%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%AE%83%E7%9A%84%E5%B7%A5%E8%B5%84-1"><span class="toc-number">5.1.2.</span> <span class="toc-text">创建函数ename_salary(),根据员工姓名，返回它的工资</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0dept-sal-%E6%A0%B9%E6%8D%AE%E9%83%A8%E9%97%A8%E5%90%8D%EF%BC%8C%E8%BF%94%E5%9B%9E%E8%AF%A5%E9%83%A8%E9%97%A8%E7%9A%84%E5%B9%B3%E5%9D%87%E5%B7%A5%E8%B5%84-1"><span class="toc-number">5.1.3.</span> <span class="toc-text">创建函数dept_sal() ,根据部门名，返回该部门的平均工资</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0add-float-%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BC%A0%E5%85%A5%E4%B8%A4%E4%B8%AAfloat%EF%BC%8C%E8%BF%94%E5%9B%9E%E4%BA%8C%E8%80%85%E4%B9%8B%E5%92%8C-1"><span class="toc-number">5.1.4.</span> <span class="toc-text">创建函数add_float()，实现传入两个float，返回二者之和</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">5.2.</span> <span class="toc-text">流程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0test-if-case-%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BC%A0%E5%85%A5%E6%88%90%E7%BB%A9%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%88%90%E7%BB%A9-gt-90-%E8%BF%94%E5%9B%9EA%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%88%90%E7%BB%A9-gt-80-%E8%BF%94%E5%9B%9EB%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%88%90%E7%BB%A9-gt-60-%E8%BF%94%E5%9B%9E-C%EF%BC%8C%E5%90%A6%E5%88%99%E8%BF%94%E5%9B%9ED-%E8%A6%81%E6%B1%82%EF%BC%9A%E5%88%86%E5%88%AB%E4%BD%BF%E7%94%A8if%E7%BB%93%E6%9E%84%E5%92%8Ccase%E7%BB%93%E6%9E%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.2.1.</span> <span class="toc-text">创建函数test_if_case()，实现传入成绩，如果成绩&gt;90,返回A，如果成绩&gt;80,返回B，如果成绩&gt;60,返回 C，否则返回D ,要求：分别使用if结构和case结构实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8Btest-if-pro-%EF%BC%8C%E4%BC%A0%E5%85%A5%E5%B7%A5%E8%B5%84%E5%80%BC%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%B7%A5%E8%B5%84%E5%80%BC-lt-3000-%E5%88%99%E5%88%A0%E9%99%A4%E5%B7%A5%E8%B5%84%E4%B8%BA%E6%AD%A4%E5%80%BC%E7%9A%84%E5%91%98%E5%B7%A5%EF%BC%8C%E5%A6%82%E6%9E%9C3000-lt-x3D-%E5%B7%A5-%E8%B5%84%E5%80%BC-lt-x3D-5000-%E5%88%99%E4%BF%AE%E6%94%B9%E6%AD%A4%E5%B7%A5%E8%B5%84%E5%80%BC%E7%9A%84%E5%91%98%E5%B7%A5%E8%96%AA%E8%B5%84%E6%B6%A81000%EF%BC%8C%E5%90%A6%E5%88%99%E6%B6%A8%E5%B7%A5%E8%B5%84500"><span class="toc-number">5.2.2.</span> <span class="toc-text">创建存储过程test_if_pro()，传入工资值，如果工资值&lt;3000,则删除工资为此值的员工，如果3000 &lt;&#x3D; 工 资值 &lt;&#x3D; 5000,则修改此工资值的员工薪资涨1000，否则涨工资500</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8Binsert-data-%E4%BC%A0%E5%85%A5%E5%8F%82%E6%95%B0%E4%B8%BA-IN-%E7%9A%84-INT-%E7%B1%BB%E5%9E%8B%E5%8F%98%E9%87%8F-insert-count-%E5%AE%9E%E7%8E%B0%E5%90%91admin%E8%A1%A8%E4%B8%AD%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5insert-count%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="toc-number">5.2.3.</span> <span class="toc-text">创建存储过程insert_data(),传入参数为 IN 的 INT 类型变量 insert_count,实现向admin表中批量插入insert_count条记录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.3.</span> <span class="toc-text">游标的使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">MySQL 触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E6%A6%82%E8%BF%B0"><span class="toc-number">6.1.</span> <span class="toc-text">触发器概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">6.2.</span> <span class="toc-text">触发器的创建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8%E8%AF%AD%E6%B3%95"><span class="toc-number">6.2.1.</span> <span class="toc-text">创建触发器语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%BE%E4%BE%8B-2"><span class="toc-number">6.2.2.</span> <span class="toc-text">代码举例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E3%80%81%E5%88%A0%E9%99%A4%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">6.3.</span> <span class="toc-text">查看、删除触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">6.3.1.</span> <span class="toc-text">查看触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F1%EF%BC%9A%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%89%80%E6%9C%89%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">6.3.2.</span> <span class="toc-text">方式1：查看当前数据库的所有触发器的定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F2%EF%BC%9A%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%9F%90%E4%B8%AA%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">6.3.3.</span> <span class="toc-text">方式2：查看当前数据库中某个触发器的定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F3%EF%BC%9A%E4%BB%8E%E7%B3%BB%E7%BB%9F%E5%BA%93information-schema%E7%9A%84TRIGGERS%E8%A1%A8%E4%B8%AD%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.3.4.</span> <span class="toc-text">*方式3：从系统库information_schema的TRIGGERS表中查询*</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">6.3.5.</span> <span class="toc-text">删除触发器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">6.4.</span> <span class="toc-text">触发器的优缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-1"><span class="toc-number">6.4.1.</span> <span class="toc-text">优点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E5%8F%AF%E4%BB%A5%E7%A1%AE%E4%BF%9D%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7%E3%80%82"><span class="toc-number">6.4.1.1.</span> <span class="toc-text">触发器可以确保数据的完整性。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E5%8F%AF%E4%BB%A5%E5%B8%AE%E5%8A%A9%E6%88%91%E4%BB%AC%E8%AE%B0%E5%BD%95%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97%E3%80%82"><span class="toc-number">6.4.1.2.</span> <span class="toc-text">触发器可以帮助我们记录操作日志。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E8%BF%98%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%9C%A8%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%89%8D%EF%BC%8C%E5%AF%B9%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%90%88%E6%B3%95%E6%80%A7%E6%A3%80%E6%9F%A5%E3%80%82"><span class="toc-number">6.4.1.3.</span> <span class="toc-text">触发器还可以用在操作数据前，对数据进行合法性检查。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-1"><span class="toc-number">6.4.2.</span> <span class="toc-text">缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8%E6%9C%80%E5%A4%A7%E7%9A%84%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98%E5%B0%B1%E6%98%AF%E5%8F%AF%E8%AF%BB%E6%80%A7%E5%B7%AE%E3%80%82"><span class="toc-number">6.4.2.1.</span> <span class="toc-text">触发器最大的一个问题就是可读性差。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8F%98%E6%9B%B4%EF%BC%8C%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%AF%BC%E8%87%B4%E8%A7%A6%E5%8F%91%E5%99%A8%E5%87%BA%E9%94%99%E3%80%82"><span class="toc-number">6.4.2.2.</span> <span class="toc-text">相关数据的变更，可能会导致触发器出错。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">6.4.3.</span> <span class="toc-text">注意点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0-2"><span class="toc-number">6.5.</span> <span class="toc-text">练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A01-2"><span class="toc-number">6.5.1.</span> <span class="toc-text">练习1</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E4%B8%80%E5%BC%A0emps%E8%A1%A8%E7%9A%84%E7%A9%BA%E8%A1%A8emps-back%EF%BC%8C%E5%8F%AA%E6%9C%89%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%8C%E4%B8%8D%E5%8C%85%E5%90%AB%E4%BB%BB%E4%BD%95%E6%95%B0%E6%8D%AE"><span class="toc-number">6.5.1.1.</span> <span class="toc-text">复制一张emps表的空表emps_back，只有表结构，不包含任何数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2emps-back%E8%A1%A8%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">6.5.1.2.</span> <span class="toc-text">查询emps_back表中的数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8emps-insert-trigger%EF%BC%8C%E6%AF%8F%E5%BD%93%E5%90%91emps%E8%A1%A8%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95%E6%97%B6%EF%BC%8C%E5%90%8C%E6%AD%A5%E5%B0%86%E8%BF%99%E6%9D%A1%E8%AE%B0%E5%BD%95%E6%B7%BB%E5%8A%A0%E5%88%B0emps-back%E8%A1%A8%E4%B8%AD"><span class="toc-number">6.5.1.3.</span> <span class="toc-text">创建触发器emps_insert_trigger，每当向emps表中添加一条记录时，同步将这条记录添加到emps_back表中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E8%A7%A6%E5%8F%91%E5%99%A8%E6%98%AF%E5%90%A6%E8%B5%B7%E4%BD%9C%E7%94%A8"><span class="toc-number">6.5.1.4.</span> <span class="toc-text">验证触发器是否起作用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A02-2"><span class="toc-number">6.5.2.</span> <span class="toc-text">练习2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E4%B8%80%E5%BC%A0emps%E8%A1%A8%E7%9A%84%E7%A9%BA%E8%A1%A8emps-back1%EF%BC%8C%E5%8F%AA%E6%9C%89%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%8C%E4%B8%8D%E5%8C%85%E5%90%AB%E4%BB%BB%E4%BD%95%E6%95%B0%E6%8D%AE"><span class="toc-number">6.5.2.1.</span> <span class="toc-text">复制一张emps表的空表emps_back1，只有表结构，不包含任何数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2emps-back1%E8%A1%A8%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">6.5.2.2.</span> <span class="toc-text">查询emps_back1表中的数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8emps-del-trigger%EF%BC%8C%E6%AF%8F%E5%BD%93%E5%90%91emps%E8%A1%A8%E4%B8%AD%E5%88%A0%E9%99%A4%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95%E6%97%B6%EF%BC%8C%E5%90%8C%E6%AD%A5%E5%B0%86%E5%88%A0%E9%99%A4%E7%9A%84%E8%BF%99%E6%9D%A1%E8%AE%B0%E5%BD%95%E6%B7%BB%E5%8A%A0%E5%88%B0emps-back1%E8%A1%A8%E4%B8%AD"><span class="toc-number">6.5.2.3.</span> <span class="toc-text">创建触发器emps_del_trigger，每当向emps表中删除一条记录时，同步将删除的这条记录添加到emps_back1表中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E8%A7%A6%E5%8F%91%E5%99%A8%E6%98%AF%E5%90%A6%E8%B5%B7%E4%BD%9C%E7%94%A8-1"><span class="toc-number">6.5.2.4.</span> <span class="toc-text">验证触发器是否起作用</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL8%E6%96%B0%E7%89%B9%E6%80%A7%E6%A6%82%E8%BF%B0"><span class="toc-number">7.</span> <span class="toc-text">MySQL8新特性概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL8-0-%E6%96%B0%E5%A2%9E%E7%89%B9%E6%80%A7"><span class="toc-number">7.1.</span> <span class="toc-text">MySQL8.0 新增特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E7%AE%80%E4%BE%BF%E7%9A%84NoSQL%E6%94%AF%E6%8C%81"><span class="toc-number">7.1.1.</span> <span class="toc-text">更简便的NoSQL支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A5%BD%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="toc-number">7.1.2.</span> <span class="toc-text">更好的索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%AE%8C%E5%96%84%E7%9A%84JSON%E6%94%AF%E6%8C%81"><span class="toc-number">7.1.3.</span> <span class="toc-text">更完善的JSON支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E5%92%8C%E8%B4%A6%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">7.1.4.</span> <span class="toc-text">安全和账户管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#InnoDB%E7%9A%84%E5%8F%98%E5%8C%96"><span class="toc-number">7.1.5.</span> <span class="toc-text">InnoDB的变化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8"><span class="toc-number">7.1.6.</span> <span class="toc-text">数据字典</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%AD%90%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E5%8F%A5"><span class="toc-number">7.1.7.</span> <span class="toc-text">原子数据定义语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86"><span class="toc-number">7.1.8.</span> <span class="toc-text">资源管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E6%94%AF%E6%8C%81"><span class="toc-number">7.1.9.</span> <span class="toc-text">字符集支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E5%99%A8%E5%A2%9E%E5%BC%BA"><span class="toc-number">7.1.10.</span> <span class="toc-text">优化器增强</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E7%94%A8%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">7.1.11.</span> <span class="toc-text">公用表表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">7.1.12.</span> <span class="toc-text">窗口函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%94%AF%E6%8C%81"><span class="toc-number">7.1.13.</span> <span class="toc-text">正则表达式支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E4%B8%B4%E6%97%B6%E8%A1%A8"><span class="toc-number">7.1.14.</span> <span class="toc-text">内部临时表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-number">7.1.15.</span> <span class="toc-text">日志记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E9%94%81"><span class="toc-number">7.1.16.</span> <span class="toc-text">备份锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%BC%BA%E7%9A%84MySQL%E5%A4%8D%E5%88%B6"><span class="toc-number">7.1.17.</span> <span class="toc-text">增强的MySQL复制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL8-0%E7%A7%BB%E9%99%A4%E7%9A%84%E6%97%A7%E7%89%B9%E6%80%A7"><span class="toc-number">7.2.</span> <span class="toc-text">MySQL8.0移除的旧特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98"><span class="toc-number">7.2.1.</span> <span class="toc-text">查询缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E7%9B%B8%E5%85%B3"><span class="toc-number">7.2.2.</span> <span class="toc-text">加密相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E5%87%BD%E6%95%B0%E7%9B%B8%E5%85%B3"><span class="toc-number">7.2.3.</span> <span class="toc-text">空间函数相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#N%E5%92%8CNULL"><span class="toc-number">7.2.4.</span> <span class="toc-text">\N和NULL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql-install-db"><span class="toc-number">7.2.5.</span> <span class="toc-text">mysql_install_db</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%88%86%E5%8C%BA%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="toc-number">7.2.6.</span> <span class="toc-text">通用分区处理程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%92%8C%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F%E4%BF%A1%E6%81%AF"><span class="toc-number">7.2.7.</span> <span class="toc-text">系统和状态变量信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql-plugin%E5%B7%A5%E5%85%B7"><span class="toc-number">7.2.8.</span> <span class="toc-text">mysql_plugin工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E7%89%B9%E6%80%A71%EF%BC%9A%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.</span> <span class="toc-text">新特性1：窗口函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E5%89%8D%E5%90%8E%E5%AF%B9%E6%AF%94"><span class="toc-number">7.3.1.</span> <span class="toc-text">使用窗口函数前后对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E5%88%86%E7%B1%BB"><span class="toc-number">7.3.2.</span> <span class="toc-text">窗口函数分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84"><span class="toc-number">7.3.3.</span> <span class="toc-text">语法结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%E8%AE%B2%E8%A7%A3"><span class="toc-number">7.3.4.</span> <span class="toc-text">分类讲解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%8F%B7%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.5.</span> <span class="toc-text">序号函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.6.</span> <span class="toc-text">分布函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.7.</span> <span class="toc-text">前后函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%B0%BE%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.8.</span> <span class="toc-text">首尾函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="toc-number">7.3.9.</span> <span class="toc-text">其他函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F-%E7%BB%93"><span class="toc-number">7.3.10.</span> <span class="toc-text">小 结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E7%89%B9%E6%80%A72%EF%BC%9A%E5%85%AC%E7%94%A8%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">7.4.</span> <span class="toc-text">新特性2：公用表表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%85%AC%E7%94%A8%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">7.4.1.</span> <span class="toc-text">普通公用表表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E5%85%AC%E7%94%A8%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">7.4.2.</span> <span class="toc-text">递归公用表表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F-%E7%BB%93-1"><span class="toc-number">7.4.3.</span> <span class="toc-text">小 结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0-3"><span class="toc-number">7.5.</span> <span class="toc-text">练习</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/10/07/MySQL%E9%AB%98%E7%BA%A7%E7%AF%87/" title="MySQL高级篇"><img src="/img/om10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL高级篇"/></a><div class="content"><a class="title" href="/2022/10/07/MySQL%E9%AB%98%E7%BA%A7%E7%AF%87/" title="MySQL高级篇">MySQL高级篇</a><time datetime="2022-10-07T04:52:12.000Z" title="Created 2022-10-07 12:52:12">2022-10-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/" title="MySQL基础篇(下)"><img src="/img/responsive-web-site-screenshot.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL基础篇(下)"/></a><div class="content"><a class="title" href="/2022/10/07/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8B)/" title="MySQL基础篇(下)">MySQL基础篇(下)</a><time datetime="2022-10-07T04:41:28.000Z" title="Created 2022-10-07 12:41:28">2022-10-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/06/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%AD)/" title="MySQL基础篇(中)"><img src="/img/gears1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL基础篇(中)"/></a><div class="content"><a class="title" href="/2022/10/06/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%AD)/" title="MySQL基础篇(中)">MySQL基础篇(中)</a><time datetime="2022-10-06T04:52:03.000Z" title="Created 2022-10-06 12:52:03">2022-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/28/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8A)/" title="MySQL基础篇(上)"><img src="/img/grid-book.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL基础篇(上)"/></a><div class="content"><a class="title" href="/2022/09/28/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87(%E4%B8%8A)/" title="MySQL基础篇(上)">MySQL基础篇(上)</a><time datetime="2022-09-28T13:49:17.000Z" title="Created 2022-09-28 21:49:17">2022-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/26/ssm%E5%AD%A6%E4%B9%A0/" title="SSM学习"><img src="/img/grid-book.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SSM学习"/></a><div class="content"><a class="title" href="/2022/09/26/ssm%E5%AD%A6%E4%B9%A0/" title="SSM学习">SSM学习</a><time datetime="2022-09-26T12:38:19.000Z" title="Created 2022-09-26 20:38:19">2022-09-26</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/responsive-web-site-screenshot.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Dreamer Blog</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="60198" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>